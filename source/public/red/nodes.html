<script type="text/x-red" data-template-name="scan ble"><!-- data-template-name identifies the node type this is for              -->

   <!-- Each of the following divs creates a field in the edit dialog.       -->
   <!-- Generally, there should be an input for each property of the node.   -->
   <!-- The for and id attributes identify the corresponding property        -->
   <!-- (with the 'node-input-' prefix).                                     -->
   <!-- The available icon classes are defined Twitter Bootstrap glyphicons  -->

    <!-- Limit to list of UUIDs -->
    <div class="form-row">
        <label for="node-input-uuids"><i class="fa fa-tasks"></i> Restrict by Service UUID</label>
        <input type="text" id="node-input-uuids" placeholder="Comma separated list">
    </div>
    <div class="form-tips">Leave empty for scanning all devices offering any service.</div>

    <!-- Allow duplicates -->
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-duplicates" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-duplicates" style="width: 70%;">Allow duplicates?</label>
    </div>

    <!-- By convention, most nodes have a 'name' property. The following div -->
    <!-- provides the necessary field. Should always be the last option      -->

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="read ble"><!-- Limit to list of UUIDs -->
    <div class="form-row">
        <label for="node-input-ids"><i class="fa fa-tasks"></i> Restrict by Name</label>
        <input type="text" id="node-input-ids" placeholder="Comma separated list">
    </div>
    <div class="form-row">
        <label for="node-input-addresses"><i class="fa fa-tasks"></i> Restrict by UUID</label>
        <input type="text" id="node-input-addresses" placeholder="Comma separated list">
    </div>
    <div class="form-row">
        <label for="node-input-service"><i class="fa fa-tasks"></i> Service</label>
        <input type="text" id="node-input-service" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-characteristic"><i class="fa fa-tasks"></i> Characteristic</label>
        <input type="text" id="node-input-characteristic" placeholder="">
    </div>

    <div class="form-row">
        <label for="node-input-datatype"><i class="fa fa-tasks"></i> Data Type</label>
        <select type="text" id="node-input-datatype" style="width:72%;">
            <option value="string">Text (string)</option>
            <option value="uint8">8 Bit Unsigned Integer</option>
            <option value="int8">8 Bit Signed Integer</option>
            <option value="uint16">16 Bit Unsigned Integer</option>
            <option value="int16">16 Bit Signed Integer</option>
            <option value="uint32">32 Bit Unsigned Integer</option>
            <option value="int32">32 Bit Signed Integer</option>
            <option value="float">32 Bit Float</option>
        </select>
    </div>

    <!-- By convention, most nodes have a 'name' property. The following div -->
    <!-- provides the necessary field. Should always be the last option      -->

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="notify ble"><!-- Limit to list of UUIDs -->
    <div class="form-row">
        <label for="node-input-ids"><i class="fa fa-tasks"></i> Restrict by Name</label>
        <input type="text" id="node-input-ids" placeholder="Comma separated list">
    </div>
    <div class="form-row">
        <label for="node-input-addresses"><i class="fa fa-tasks"></i> Restrict by UUID</label>
        <input type="text" id="node-input-addresses" placeholder="Comma separated list">
    </div>
    <div class="form-row">
        <label for="node-input-service"><i class="fa fa-tasks"></i> Service</label>
        <input type="text" id="node-input-service" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-characteristic"><i class="fa fa-tasks"></i> Characteristic</label>
        <input type="text" id="node-input-characteristic" placeholder="">
    </div>

    <div class="form-row">
        <label for="node-input-datatype"><i class="fa fa-tasks"></i> Data Type</label>
        <select type="text" id="node-input-datatype" style="width:72%;">
            <option value="string">Text (string)</option>
            <option value="uint8">8 Bit Unsigned Integer</option>
            <option value="int8">8 Bit Signed Integer</option>
            <option value="uint16">16 Bit Unsigned Integer</option>
            <option value="int16">16 Bit Signed Integer</option>
            <option value="uint32">32 Bit Unsigned Integer</option>
            <option value="int32">32 Bit Signed Integer</option>
            <option value="float">32 Bit Float</option>
        </select>
    </div>

    <!-- By convention, most nodes have a 'name' property. The following div -->
    <!-- provides the necessary field. Should always be the last option      -->

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="write ble"><!-- Limit to list of UUIDs -->
    <div class="form-row">
        <label for="node-input-ids"><i class="fa fa-tasks"></i> Restrict by Name</label>
        <input type="text" id="node-input-ids" placeholder="Comma separated list">
    </div>
    <div class="form-row">
        <label for="node-input-addresses"><i class="fa fa-tasks"></i> Restrict by UUID</label>
        <input type="text" id="node-input-addresses" placeholder="Comma separated list">
    </div>
    <div class="form-row">
        <label for="node-input-service"><i class="fa fa-tasks"></i> Service</label>
        <input type="text" id="node-input-service" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-characteristic"><i class="fa fa-tasks"></i> Characteristic</label>
        <input type="text" id="node-input-characteristic" placeholder="">
    </div>

    <div class="form-row">
        <label for="node-input-datatype"><i class="fa fa-tasks"></i> Data Type</label>
        <select type="text" id="node-input-datatype" style="width:72%;">
            <option value="string">Text (string)</option>
            <option value="uint8">8 Bit Unsigned Integer</option>
            <option value="int8">8 Bit Signed Integer</option>
            <option value="uint16">16 Bit Unsigned Integer</option>
            <option value="int16">16 Bit Signed Integer</option>
            <option value="uint32">32 Bit Unsigned Integer</option>
            <option value="int32">32 Bit Signed Integer</option>
            <option value="float">32 Bit Float</option>
        </select>
    </div>

    <!-- By convention, most nodes have a 'name' property. The following div -->
    <!-- provides the necessary field. Should always be the last option      -->

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('scan ble',{
        category: 'Bluetooth',      // the palette category
        color:"#207FC3",
        defaults: {             // defines the editable properties of the node
            uuids: {value:"", validate:RED.validators.regex(/^([a-fA-F0-9]{32}){0,1}(?:,[a-fA-F0-9]{32})*$/)},
            duplicates: {value:false},
            name: {value:""}
        },
        inputs:0,               // set the number of inputs - only 0 or 1
        outputs:1,              // set the number of outputs - 0 to n
        // set the icon (held in icons dir below where you save the node)
        icon: "bluetooth.png",     // saved in  icons/myicon.png
        label: function() {     // sets the default label contents
            if (this.name) {
                return this.name;
            } else {
                return "Scan BLEs";
            }
        },
        labelStyle: function() { // sets the class to apply to the label
            return this.name ? "node_label_italic" : "";
        }
    });

RED.nodes.registerType('read ble',{
        category: 'Bluetooth',      // the palette category
        color:"#207FC3",
        defaults: {             // defines the editable properties of the node
            ids: {value:""},
            addresses: {value:""},
            // duplicates: {value:false},
            service: {value:""},
            characteristic: {value:""},
            datatype: {value:"string"},
            name: {value:""}
        },
        inputs:1,               // set the number of inputs - only 0 or 1
        outputs:1,              // set the number of outputs - 0 to n
        // set the icon (held in icons dir below where you save the node)
        icon: "bluetooth.png",     // saved in  icons/myicon.png
        label: function() {     // sets the default label contents
            if (this.name) {
                return this.name;
            } else {
                return "Read BLEs";
            }
        },
        labelStyle: function() { // sets the class to apply to the label
            return this.name ? "node_label_italic" : "";
        }
    });

RED.nodes.registerType('notify ble',{
        category: 'Bluetooth',      // the palette category
        color:"#207FC3",
        defaults: {             // defines the editable properties of the node
            ids: {value:""},
            addresses: {value:""},
            // duplicates: {value:false},
            service: {value:""},
            characteristic: {value:""},
            datatype: {value:"string"},
            name: {value:""}
        },
        inputs:1,               // set the number of inputs - only 0 or 1
        outputs:1,              // set the number of outputs - 0 to n
        // set the icon (held in icons dir below where you save the node)
        icon: "bluetooth.png",     // saved in  icons/myicon.png
        label: function() {     // sets the default label contents
            if (this.name) {
                return this.name;
            } else {
                return "Notify BLEs";
            }
        },
        labelStyle: function() { // sets the class to apply to the label
            return this.name ? "node_label_italic" : "";
        }
    });

RED.nodes.registerType('write ble',{
        category: 'Bluetooth',      // the palette category
        color:"#207FC3",
        defaults: {             // defines the editable properties of the node
            ids: {value:""},
            addresses: {value:""},
            // duplicates: {value:false},
            service: {value:""},
            characteristic: {value:""},
            datatype: {value:"string"},
            name: {value:""}
        },
        inputs:1,               // set the number of inputs - only 0 or 1
        outputs:1,              // set the number of outputs - 0 to n
        // set the icon (held in icons dir below where you save the node)
        icon: "bluetooth.png",     // saved in  icons/myicon.png
        label: function() {     // sets the default label contents
            if (this.name) {
                return this.name;
            } else {
                return "Write BLEs";
            }
        },
        labelStyle: function() { // sets the class to apply to the label
            return this.name ? "node_label_italic" : "";
        }
    });</script><script type="text/x-red" data-template-name="ble in"><div class="form-row">
        <label for="node-input-arduino"><i class="fa fa-tasks"></i> Arduino</label>
        <input type="text" id="node-input-arduino">
    </div>
    <div class="form-row">
        <label for="node-input-pin"><i class="fa fa-circle"></i> Pin</label>
        <input type="text" id="node-input-pin" placeholder="2">
    </div>
    <div class="form-row">
        <label for="node-input-state"><i class="fa fa-wrench"></i> Type</label>
        <select type="text" id="node-input-state" style="width: 150px;">
            <option value="INPUT">Digital pin</option>
            <option value="ANALOG">Analogue pin</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips"><b>Note:</b> You cannot use the same pin for both output and input.</div></script><script type="text/javascript">RED.nodes.registerType('ble in',{
        category: 'Bluetooth',
        color:"#3fadb5",
        defaults: {
            name: {value:""},
            pin: {value:"",required:true},
            state: {value:"INPUT",required:true},
            arduino: {type:"ble-board"}
        },
        inputs:0,
        outputs:1,
        icon: "bluetooth.png",
        label: function() {
            var a = "";
            if (this.state == "ANALOG") a = "A";
            return this.name||"Pin: "+a+this.pin;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-template-name="ble out"><div class="form-row">
        <label for="node-input-arduino"><i class="fa fa-tasks"></i> Arduino</label>
        <input type="text" id="node-input-arduino">
    </div>
    <div class="form-row">
        <label for="node-input-pin"><i class="fa fa-circle"></i> Pin</label>
        <input type="text" id="node-input-pin" placeholder="13">
    </div>
    <div class="form-row">
        <label for="node-input-state"><i class="fa fa-wrench"></i> Type</label>
        <select type="text" id="node-input-state" style="width: 200px;">
            <option value="OUTPUT">Digital (0/1)</option>
            <option value="PWM">Analogue (0-255)</option>
            <option value="SERVO">Servo (0-180)</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips"><b>Note:</b> You cannot use the same pin for both output and input.</div></script><script type="text/javascript">RED.nodes.registerType('ble out',{
        category: 'Bluetooth',
        color:"#3fadb5",
        defaults: {
            name: {value:""},
            pin: {value:"",required:true},
            state: {value:"",required:true},
            arduino: {type:"ble-board"}
        },
        inputs:1,
        outputs:0,
        icon: "bluetooth.png",
        align: "right",
        label: function() {
            return this.name||"Pin: "+this.pin;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-template-name="ble-board"><div class="form-row">
        <label for="node-config-input-device"><i class="fa fa-random"></i> Name</label>
        <input type="text" id="node-config-input-device" style="width:60%;" placeholder=""/>
        <a id="node-config-lookup-serial" class="btn"><i id="node-config-lookup-serial-icon" class="fa fa-search"></i></a>
    </div>
    <div class="form-tips"><b>Tip:</b> Use search to try to auto-detect serial port.</div></script><script type="text/javascript">RED.nodes.registerType('ble-board',{
        category: 'config',
        defaults: {
            device: {value:"",required:true}
        },
        label: function() {
            return this.device||"arduino";
        },
        oneditprepare: function() {
            try {
                $("#node-config-input-device").autocomplete( "destroy" );
            } catch(err) { }
            $("#node-config-lookup-serial").click(function() {
                $("#node-config-lookup-serial-icon").removeClass('fa-search');
                $("#node-config-lookup-serial-icon").addClass('spinner');
                $("#node-config-lookup-serial").addClass('disabled');

                $.getJSON('arduinoports',function(data) {
                    $("#node-config-lookup-serial-icon").addClass('fa-search');
                    $("#node-config-lookup-serial-icon").removeClass('spinner');
                    $("#node-config-lookup-serial").removeClass('disabled');
                    var ports = [];
                    $.each(data, function(i, port){
                        ports.push(port);
                    });
                    $("#node-config-input-device").autocomplete({
                        source:ports,
                        minLength:0,
                        close: function( event, ui ) {
                            $("#node-config-input-device").autocomplete( "destroy" );
                        }
                    }).autocomplete("search","");
                });
            });
        }
    });</script><script type="text/x-red" data-help-name="scan ble"><p>This node allows scanning for BLE devices, restricted if necessary by the services they offer.</p>
    <p>This node will generate one message per BLE device detected according to the node configuration.</p>
    <p>The <b>msg.payload</b> will contain the <i>peripheral uuid</i> and the <i>local name</i> of the BLE device detected.</p>
    <p>Additionally it will set the following values:</p>
    <ul>
        <li>Sets the <b>msg.peripheralUuid</b> to the <i>peripheral uuid</i> of the BLE device detected.</li>
        <li>Sets the <b>msg.rssi</b> to the <i>received signal strength indicator (RSSI)</i> of the BLE device detected.</li>
        <li>Sets <b>msg.localName</b> to the name of the device if any.</li>
        <li>Sets <b>msg.detectedAt</b> to the moment the device was detected on milliseconds since 1 Jan 1970.</li>
        <li>Sets <b>msg.detectedBy</b> to the name of the machine that detected the BLE device.</li>
        <li>Sets <b>msg.advertisement</b> to the full advertisement of the BLE device (see Noble documentation).</li>
    </ul>
    <p>If the device follows the iBeacon specification, the message will also contain the following properties</p>
    <ul>
        <li>Sets the <b>msg.manufacturerUuid</b> to the <i>uuid</i> of the manufacturer of the BLE device detected.</li>
        <li>Sets the <b>msg.major</b> to the <i>major number</i> of the manufacturer of the BLE device detected.</li>
        <li>Sets the <b>msg.minor</b> to the <i>minor number</i> of the manufacturer of the BLE device detected.</li>
        <li>Sets the <b>msg.measuredPower</b> to the <i>measured power at one meter</i> of the BLE device detected.</li>
        <li>Sets the <b>msg.accuracy</b> to the <i>accuracy</i> estimated for this measurement.</li>
        <li>Sets the <b>msg.proximity</b> to the <i>proximity</i> guessed for this device. The value will be one of: 'unknown', 'immediate', 'near', 'far' </li>
    </ul></script><script type="text/x-red" data-help-name="ble in"><p>Arduino input node. Connects to local Arduino and monitors the selected pin for changes. Uses <a href="http://firmata.org/" target="_new"><i>Firmata</i>.</a></p>
    <p>The Arduino must be loaded with the Standard Firmata sketch available in the Arduino examples.</p>
    <p>You can select either Digital or Analogue input. Outputs the value read as <b>msg.payload</b> and the pin number as <b>msg.topic</b>.</p>
    <p>It only outputs on a change of value - fine for digital inputs, but you can get a lot of data from analogue pins which you must then handle.</p>
    <p>You can set the sample rate in ms from 20 to 65535.</p></script><script type="text/x-red" data-help-name="ble out"><p>Arduino output node. Connects to local Arduino and writes to the selected digital pin. Uses <a href="http://firmata.org/" target="_new"><i>Firmata</i>.</a></p>
    <p>The Arduino must be loaded with the Standard Firmata sketch available in the Arduino examples.</p>
    <p>You can select Digital, Analogue (PWM) or Servo type outputs. Expects a numeric value in <b>msg.payload</b>. The pin number is set in the properties panel.</p></script><script type="text/x-red" data-template-name="buffer"><div class="form-row" id="node-send">
        <label for="node-input-send"><i class="fa fa-tasks"></i> Send </label>
        <select id="node-input-send" style="width:270px !important">
          <option value="full">when buffer is full</option>
          <option value="event">when event received</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-sendarray"><i class="fa fa-tasks"></i> Store </label>
        <select id="node-input-sendarray" style="width:270px !important">
          <option value="array">array</option>
          <option value="value">value</option>
        </select>
    </div>
    <div id="node-size" class="form-row">
        <label for="node-input-size"><i class="fa fa-tag"></i> Size</label>
        <input type="spinner" id="node-input-size" placeholder="1000">
    </div>
    <div class="form-row">
        <label for="node-input-shift"><i class="fa fa-tasks"></i> If buffer is full </label>
        <select id="node-input-shift" style="width:270px !important">
          <option value="drop">drop messages</option>
          <option value="shift">shift messages</option>
        </select>
    </div>
    <div class="form-row" id="node-window">
        <input style="width: 30px;" type="checkbox" id="node-input-window"><label style="width: 250px;" for="node-input-window">Use a sliding window</label>
    </div>
    <div class="form-row" id="node-size_of_size_of_window">
        <label style="width: 250px;" for="node-input-size_of_window">Size of sliding window</label>
        <input style="width: 30px;" type="number" id="node-input-size_of_window">
    </div>
    <div class="form-row" id="node-mix_messages">
        <input style="width: 30px;" type="checkbox" id="node-input-mix_messages"><label style="width: 250px;" for="node-input-mix_messages">Mix multiple message types</label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="set event"><div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('buffer',{
        category: 'function',      // the palette category
        color:"#E6E0F8",
        defaults: {             // defines the editable properties of the node
            name: {value:""},   //  along with default values.
            send: {value:"full", required:true},
            sendarray: {value: "array"},
            size: {value:1000, required:true, validate:RED.validators.number()},
            window: {value: false},
            size_of_window: {value: 1, required:true, validate:RED.validators.number()},
            shift: {value:"shift"},
            mix_messages: {value:false}
        },
        inputs:1,                // set the number of inputs - only 0 or 1
        outputs:1,               // set the number of outputs - 0 to n
        icon: "buffer-icon.png",    // set the icon (held in public/icons)
        label: function() {      // sets the default label contents
            return this.name || (this.sendarray=="array"?"Send array of "+this.size+" when "+this.send:"Store value");
        },
        labelStyle: function() { // sets the class to apply to the label
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {

          var updateproperties = function (value)
          {
            if (value == "array")
            {
              $("#node-mix_messages").hide ();
              $("#node-window").show ();
              $("#node-size_of_window").show ();
              $("#node-send").show ();
              $("#node-size").show ();
            }
            else if (value == "value")
            {
              $("#node-mix_messages").show ();
              $("#node-size_of_window").hide ();
              $("#node-send").hide ();
              $("#node-size").hide (); 
            }
          };

          updateproperties ();

          $("#node-input-sendarray").on ("change", function ()
          {
            updateproperties (this.value);
          });
        },
    });

    RED.nodes.registerType('set event',{
        category: 'function',      // the palette category
        color:"#E6E0F8",
        defaults: {             // defines the editable properties of the node
            name: {value:""},   //  along with default values.
        },
        inputs:1,                // set the number of inputs - only 0 or 1
        outputs:1,               // set the number of outputs - 0 to n
        icon: "setevent-icon.png",    // set the icon (held in public/icons)
        label: function() {      // sets the default label contents
            return this.name || "Set event";
        },
        labelStyle: function() { // sets the class to apply to the label
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {



        },
    });</script><script type="text/x-red" data-help-name="buffer"><p>Store an array and sends it when it is full or when it receives a message with <b>event</b>. It stores as arrays all the components of the message and mixes them.</p>
    <p>If a value is stored, it knows how to mix the messages. Sends the value when a messages is received with <b>event</b>.</p>
    <p>If use sliding window is selected, the array wil delete one element at a time.</p></script><script type="text/x-red" data-help-name="set event"><p>Sets the <b>event</b> porperty for msg. Useful for buffer.</p></script><script type="text/x-red" data-template-name="say"><div class="form-row">
        <label for="node-input-complete"><i class="fa fa-list"></i> Language</label>
        <select type="text" id="node-input-language" style="display: inline-block; width: 250px; vertical-align: top;">
            <option value="en">English</option>
            <option value="fr">French</option>
            <option value="de">German</option>
            <option value="nl">Dutch</option>
            <option value="hu">Hungarian</option>
            <option value="ro">Romanian</option>
            <option value="zh">Chinese</option>
            <option value="jp">Japonese</option>
            <option value="ru">Russian</option>
            <option value="es">Spanish</option>
            <option value="">msg.topic</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('say',{
        category: 'multimedia',
        defaults: {
            name: {value:""},
            language: {value:"en"},
        },
        label: function() {
            return this.name||"Say msg.payload";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        color:"#87a980",
        inputs:1,
        outputs:0,
        icon: "bridge.png",
        align: "right"
    });</script><script type="text/x-red" data-help-name="say"><p>Says the <b>payload</b> in a specific lanuage.</b></script><script type="text/x-red" data-template-name="print"><div class="form-row">
        <label for="node-input-complete"><i class="fa fa-list"></i> Output</label>
        <select type="text" id="node-input-complete" style="display: inline-block; width: 250px; vertical-align: top;">
            <option value="false">payload only</option>
            <option value="true">complete msg object</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-field"><i class="fa fa-tag"></i> Field</label>
        <input type="text" id="node-input-field" placeholder="field">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('print',{
        category: 'output',
        defaults: {
            name: {value:""},
            active: {value:true},
            field: {value:""},
            complete: {value:"false"}
        },
        label: function() {
            return this.name||"print "+((this.complete=="true")?"msg":("msg."+((this.field && this.field.length>0)?this.field:"payload")));
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        color:"#87a980",
        inputs:1,
        outputs:0,
        icon: "debug.png",
        align: "right",
        button: {
            toggle: "active",
            onclick: function() {
                RED.nodes.dirty (true);
            }
        }
    });</script><script type="text/x-red" data-help-name="print"><p>The print node can be connected to the output of any node. It will display <b>msg.payload</b> field of any messages it receives.
    <p>The button to the right of the node will toggle it's output on and off so you can de-clutter the console window.</p>
    <p>If the payload is an object it will be stringified first for display and indicate that by saying "(Object) ".</p>
    <p>If the payload is a buffer it will be stringified first for display and indicate that by saying "(Buffer) ".</p>
    <p>Optionally can show the complete msg object - but the screen can get messy.</p>
    <p>If a <b>field</b> is specified, it will display msg[<b>field</b>].</p></script><script type="text/x-red" data-template-name="playstation"><div class="form-row" id="node-config">
        <label for="node-input-config"><i class="fa fa-tasks"></i> Controller </label>
        <select id="node-input-config" style="width:270px !important">
          <option value="dualShock3">Playstation 3</option>
          <option value="dualShock4-generic-driver">Playstation 4</option>
        </select>
    </div>
    <div class="form-row" id="node-accelerometerSmooting">
        <input style="width: 30px;" type="checkbox" id="node-input-accelerometerSmooting"><label style="width: 250px;" for="node-input-accelerometerSmooting">Smooth  acelerometers data</label>
    </div>
    <div class="form-row" id="node-analogStickSmoothing">
        <input style="width: 30px;" type="checkbox" id="node-input-analogStickSmoothing"><label style="width: 250px;" for="node-input-analogStickSmoothing">Smooth  joysticks data</label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('playstation',{
        category: 'input',      // the palette category
        color:"#3d99d8",
        defaults: {             // defines the editable properties of the node
            name: {value:""},   //  along with default values.
            config: {value:"dualShock3"},
            accelerometerSmooting: {value: true},
            analogStickSmoothing: {value: true}
        },
        inputs:0,                // set the number of inputs - only 0 or 1
        outputs:1,               // set the number of outputs - 0 to n
        icon: "ps-controller.png",    // set the icon (held in public/icons)
        label: function() {      // sets the default label contents
            return this.name?this.name:(this.config == "dualShock3"?"PS3 Controller":"PS4 Controller");
        },
        labelStyle: function() { // sets the class to apply to the label
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {

        },
    });</script><script type="text/x-red" data-help-name="playstation"><p>Get input from a playstation controller.</p>
    <p>The values are:
    <ul>
      <li><b>msg.payload</b> - button</li>
      <li><b>msg.topic</b> - action</li>
    </ul>
    </p></script><script type="text/x-red" data-template-name="run"><div class="form-row node-input-payload">
        <label for="node-input-payloadType"><i class="icon-envelope"></i> Payload</label>
        <select id="node-input-payloadType" style="width:125px !important">
          <option value="date">timestamp</option>
          <option value="none">blank</option>
          <option value="string">string</option>
          <option value="times">times</option>
        </select>
    </div>

    <div class="form-row" id="node-input-row-payload">
        <label for="node-input-payload"></label>
        <input type="text" id="node-input-payload" placeholder="payload">
    </div>

    <div class="form-row">
        <label for="node-input-topic"><i class="icon-tasks"></i> Topic</label>
        <input type="text" id="node-input-topic" placeholder="topic">
    </div>

    <div class="form-row">
        <label for=""><i class="icon-repeat"></i> Repeat</label>
        <select id="run-time-type-select"  style="width: 288px"><option value="interval">interval</option><option value="interval-time">interval between times</option><option value="time">at a specific time</option></select>
        <input type="hidden" id="node-input-repeat" placeholder="payload">
        <input type="hidden" id="node-input-crontab" placeholder="payload">
    </div>

    <div class="form-row run-time-row hidden" id="run-time-row-interval">
        every <input id="run-time-interval-count" class="run-time-count" value="1"></input>
              <select style="width: 100px" id="run-time-interval-units"><option value="s">seconds</option><option value="m">minutes</option><option value="h">hours</option></select><br/>
        <!-- on <select disabled id="run-time-interval-days" class="run-time-days"></select> -->
    </div>

    <div class="form-row run-time-row hidden" id="run-time-row-interval-time">
        at every <select style="width: 90px" id="run-time-interval-time-units" class="run-time-int-count" value="1">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="10">10</option>
            <option value="12">12</option>
            <option value="15">15</option>
            <option value="20">20</option>
            <option value="30">30</option>
        </select> minutes<br/>
        between <select id="run-time-interval-time-start" class="run-time-times"></select>
        and <select id="run-time-interval-time-end" class="run-time-times"></select><br/>
        on <select id="run-time-interval-time-days" class="run-time-days"></select>
    </div>

    <div class="form-row run-time-row hidden" id="run-time-row-time">
        at <input id="run-time-time" value="12:00"></input><br/>
        on <select id="run-time-time-days" class="run-time-days"></select>
    </div>

    <div class="form-row" id="node-once">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-once" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-once" style="width: 70%;">Fire once at start ?</label>
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="name">
    </div>

    <div class="form-tips"><b>Note:</b> "interval between times" and "at a specific time" will use cron.<br/>See info box for details.</div>
    <script>
    {
        $("#run-time-type-select").change(function() {
            $("#node-input-crontab").val('');
            var id = $("#run-time-type-select option:selected").val();
            $(".run-time-row").hide();
            $("#run-time-row-"+id).show();
            if ((id == "none") || (id == "interval")) {
                $("#node-once").show();
            }
            else {
                $("#node-once").hide();
                $("#node-input-once").prop('checked', false);
            }
        });

        var days = [
            {v:"*",t:"every day"},
            {v:"1-5",t:"Mondays to Fridays"},
            {v:"0,6",t:"Saturdays and Sundays"},
            {v:"1",t:"Mondays"},
            {v:"2",t:"Tuesdays"},
            {v:"3",t:"Wednesdays"},
            {v:"4",t:"Thursdays"},
            {v:"5",t:"Fridays"},
            {v:"6",t:"Saturdays"},
            {v:"0",t:"Sundays"}
        ];

        $(".run-time-days").each(function() {
            for (var d in days) {
                $(this).append($("<option></option>").val(days[d].v).text(days[d].t));
            }
        });

        $(".run-time-times").each(function() {
            for (var i=0;i<24;i++) {
                var l = (i<10?"0":"")+i+":00";
                $(this).append($("<option></option>").val(i).text(l));
            }
        });

        $(".run-time-count").spinner({
            //max:60,
            min:1
        });

        $("#run-time-interval-units").change(function() {
            var units = $("#run-time-interval-units option:selected").val();
            //$("#run-time-interval-days").prop("disabled",(units == "s")?"disabled":false);
            //$(".run-time-count").spinner("option","max",(units == "h")?24:60);
        });

        $.widget( "ui.injecttimespinner", $.ui.spinner, {
            options: {
                // seconds
                step: 60 * 1000,
                // hours
                page: 60
            },
            _parse: function( value ) {
                if ( typeof value === "string" ) {
                    // already a timestamp
                    if ( Number( value ) == value ) {
                        return Number( value );
                    }
                    var p = value.split(":");
                    var offset = new Date().getTimezoneOffset();
                    return (((Number(p[0])+1)*60)+Number(p[1])+offset)*60*1000;
                }
                return value;
            },
            _format: function( value ) {
                var d = new Date(value);
                var h = d.getHours();
                var m = d.getMinutes();
                return ((h<10)?"0":"")+h+":"+((m<10)?"0":"")+m;
            }
        });

        $("#run-time-time").injecttimespinner();
    };</script><style>.run-time-row{padding-left:110px;}.run-time-row select{margin:3px 0;}.run-time-days{width:262px;}.run-time-times{width:90px;}.run-time-row>.ui-spinner{height:28px;margin:3px 0;border-color:rgb(204,204,204);}#run-time-time{margin-top:3px;width:75px;}.run-time-count{width:40px!important;}</style><script type="text/javascript">RED.nodes.registerType('run',{
        category: 'input',
        color:"#a6bbcf",
        defaults: {
            name: {value:""},
            topic: {value:""},
            payload: {value:""},
            payloadType: {value:"date"},
            repeat: {value:"1"},
            crontab: {value:""},
            once: {value:false}
        },
        inputs:0,
        outputs:1,
        icon: "inject.png",
        label: function() {
            if (this.payloadType == "string") {
                return this.name||this.topic||this.payload||"run";
            }
            else { return this.name||"run"; }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var repeattype = "none";
            if (this.repeat != "" && this.repeat != 0) {
                repeattype = "interval";
                var r = "s";
                var c = this.repeat;
                if (this.repeat % 60 === 0) { r = "m"; c = c/60; }
                if (this.repeat % 1440 === 0) { r = "h"; c = c/24; }
                $("#run-time-interval-count").val(c);
                $("#run-time-interval-units").val(r);
                //$("#run-time-interval-units option").filter(function() {return $(this).val() == "s";}).attr('selected',true);
                $("#run-time-interval-days").prop("disabled","disabled");
            } else if (this.crontab) {
                var cronparts = this.crontab.split(" ");
                var days = cronparts[4];
                if (!isNaN(cronparts[0]) && !isNaN(cronparts[1])) {
                    repeattype = "time";
                    // Fixed time
                    var time = cronparts[1]+":"+cronparts[0];
                    $("#run-time-time").val(time);
                    $("#run-time-type-select option").filter(function() {return $(this).val() == "s";}).attr('selected',true);
                    $("#run-time-time-days option").filter(function() {return $(this).val() == days;}).attr('selected',true);

                } else if (cronparts[0] == "0") {
                    // interval - hours
                    var hours = cronparts[1].slice(2);
                    repeattype = "interval";
                    $("#run-time-interval-days").prop("disabled",false);
                    $("#run-time-interval-days option").filter(function() {return $(this).val() == days;}).attr('selected',true);
                    $("#run-time-interval-count").val(hours)
                    $("#run-time-interval-units option").filter(function() {return $(this).val() == "h";}).attr('selected',true);
                } else if (cronparts[1] == "*") {
                    // interval - minutes
                    var minutes = cronparts[0].slice(2);
                    repeattype = "interval";
                    $("#run-time-interval-days").prop("disabled",false);
                    $("#run-time-interval-days option").filter(function() {return $(this).val() == days;}).attr('selected',true);
                    $("#run-time-interval-count").val(minutes)
                    $("#run-time-interval-units option").filter(function() {return $(this).val() == "m";}).attr('selected',true);
                } else {
                    repeattype = "interval-time";
                    // interval - time period
                    var minutes = cronparts[0].slice(2);
                    $("#run-time-interval-time-units").val(minutes);
                    $("#run-time-interval-time-days option").filter(function() {return $(this).val() == days;}).attr('selected',true);
                    var time = cronparts[1];
                    var timeparts = time.split(",");
                    var start;
                    var end;
                    if (timeparts.length == 1) {
                        // 0 or 0-10
                        var hours = timeparts[0].split("-");
                        if (hours.length == 1) {
                            start = hours[0];
                            end = Number(hours[0])+1;
                        } else {
                            start = hours[0];
                            end = (Number(hours[1])+1)%24;
                        }
                    } else {
                        // 23,0 or 17-23,0-10 or 23,0-2 or 17-23,0
                        var startparts = timeparts[0].split("-");
                        start = startparts[0];

                        var endparts = timeparts[1].split("-");
                        if (endparts.length == 1) {
                            end = Number(endparts[0])+1;
                        } else {
                            end = Number(endparts[1])+1;
                        }
                    }
                    $("#run-time-interval-time-start option").filter(function() {return $(this).val() == start;}).attr('selected',true);
                    $("#run-time-interval-time-end option").filter(function() {return $(this).val() == end;}).attr('selected',true);

                }
            } else {
                $("#run-time-type-select option").filter(function() {return $(this).val() == "none";}).attr('selected',true);
            }

            $(".run-time-row").hide();
            $("#run-time-type-select option").filter(function() {return $(this).val() == repeattype;}).attr('selected',true);
            $("#run-time-row-"+repeattype).show();

            if (this.payloadType == null) {
                if (this.payload == "") {
                    this.payloadType = "date";
                } else {
                    this.payloadType = "string";
                }
            }

            $("#node-input-payloadType").change(function() {
                var id = $("#node-input-payloadType option:selected").val();
                if (id == "string") {
                    $("#node-input-row-payload").show();
                } else {
                    $("#node-input-row-payload").hide();
                }
            });
            $("#node-input-payloadType").val(this.payloadType);
            $("#node-input-payloadType").change();
            $("#run-time-type-select").change();

        },
        oneditsave: function() {
            var repeat = "";
            var crontab = "";
            var type = $("#run-time-type-select option:selected").val();
            if (type == "none") {
                // nothing
            } else if (type == "interval") {
                var count = $("#run-time-interval-count").val();
                var units = $("#run-time-interval-units option:selected").val();
                var days = $("#run-time-interval-days option:selected").val();
                if (units == "s") {
                    repeat = count;
                } else {
                    if (units == "m") {
                        //crontab = "*/"+count+" * * * "+days;
                        repeat = count * 60;
                    } else if (units == "h") {
                        //crontab = "0 */"+count+" * * "+days;
                        repeat = count * 60 * 24;
                    }
                }
            } else if (type == "interval-time") {
                var count = $("#run-time-interval-time-units").val();
                var startTime = Number($("#run-time-interval-time-start option:selected").val());
                var endTime = Number($("#run-time-interval-time-end option:selected").val());
                var days = $("#run-time-interval-time-days option:selected").val();
                var timerange = "";
                if (startTime == endTime) {
                    //TODO: invalid
                    repeat = "";
                    crontab = "";
                } else if (endTime == 0) {
                    timerange = startTime+"-23";
                } else if (startTime+1 < endTime) {
                    timerange = startTime+"-"+(endTime-1);
                } else if (startTime+1 == endTime) {
                    timerange = startTime;
                } else {
                    var startpart = "";
                    var endpart = "";
                    if (startTime == 23) {
                        startpart = "23";
                    } else {
                        startpart = startTime+"-23";
                    }
                    if (endTime == 1) {
                        endpart = "0";
                    } else {
                        endpart = "0-"+(endTime-1);
                    }
                    timerange = startpart+","+endpart;
                }
                repeat = "";
                crontab = "*/"+count+" "+timerange+" * * "+days;
            } else if (type == "time") {
                var time = $("#run-time-time").val();
                var days = $("#run-time-time-days option:selected").val();
                var parts = time.split(":");
                repeat = "";
                crontab = parts[1]+" "+parts[0]+" * * "+days;
            }

            $("#node-input-repeat").val(repeat);
            $("#node-input-crontab").val(crontab);

        },
    });</script><script type="text/x-red" data-help-name="run"><p>If no payload is specified the payload is set to the current time in millisecs since 1970. This allows subsequent functions to perform time based actions.</p>
    <p>The repeat function does what it says on the tin and continuously sends the payload every x seconds.</p>
    <p>The Fire once at start option actually waits 50mS before firing to give other nodes a chance to instantiate properly.</p>
    <p><b>Note: </b>"Interval between times" and "at a specific time" will use cron. This means that 20 mins will be at the next hour, 20 mins past and 40 mins past - not in 20 minutes time.
    If you want every 20 mins from now - use the basic "interval" option.</p></script><script type="text/x-red" data-template-name="octave"><div class="form-row" style="margin-bottom: 0px;">
            <label for="node-input-func"><i class="fa fa-wrench"></i> Function</label>
            <input type="hidden" id="node-input-func" autofocus="autofocus">
    </div>
    <div class="form-row node-text-editor-row">
        <div style="height: 250px;" class="node-text-editor" id="node-input-func-editor" ></div>
    </div>
    <div class="form-row" id="node-stdout">
        <input style="width: 30px;" type="checkbox" id="node-input-stdout"><label style="width: 250px;" for="node-input-stdout">Show output</label>
    </div>
    <div class="form-row" id="node-stderr">
        <input style="width: 30px;" type="checkbox" id="node-input-stderr"><label style="width: 250px;" for="node-input-stderr">Show errors</label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="python"><div class="form-row" style="margin-bottom: 0px;">
            <label for="node-input-func"><i class="fa fa-wrench"></i> Function</label>
            <input type="hidden" id="node-input-func" autofocus="autofocus">
    </div>
    <div class="form-row node-text-editor-row">
        <div style="height: 250px;" class="node-text-editor" id="node-input-func-editor" ></div>
    </div>
    <div class="form-row" id="node-stdout">
        <input style="width: 30px;" type="checkbox" id="node-input-stdout"><label style="width: 250px;" for="node-input-stdout">Show output</label>
    </div>
    <div class="form-row" id="node-stderr">
        <input style="width: 30px;" type="checkbox" id="node-input-stderr"><label style="width: 250px;" for="node-input-stderr">Show errors</label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="r language"><div class="form-row" style="margin-bottom: 0px;">
            <label for="node-input-func"><i class="fa fa-wrench"></i> Function</label>
            <input type="hidden" id="node-input-func" autofocus="autofocus">
    </div>
    <div class="form-row node-text-editor-row">
        <div style="height: 250px;" class="node-text-editor" id="node-input-func-editor" ></div>
    </div>
    <div class="form-row" id="node-stdout">
        <input style="width: 30px;" type="checkbox" id="node-input-stdout"><label style="width: 250px;" for="node-input-stdout">Show output</label>
    </div>
    <div class="form-row" id="node-stderr">
        <input style="width: 30px;" type="checkbox" id="node-input-stderr"><label style="width: 250px;" for="node-input-stderr">Show errors</label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="fourier"><div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row" id="node-inverse">
        <input style="width: 30px;" type="checkbox" id="node-input-inverse"><label style="width: 250px;" for="node-input-inverse">Inverse</label>
    </div>
    <div class="form-row" id="node-window_function">
        <label for="node-input-window_function"><i class="fa fa-tasks"></i> Window Function </label>
        <select id="node-input-window_function" style="width:270px !important">
          <option value="bartlettHann">Bartlett Hann</option>
          <option value="bartlett">Bartlett</option>
          <option value="blackman">Blackman</option>
          <option value="blackmanHarris">Blackman Harris</option>
          <option value="blackmanNuttall">Blckman Nuttall</option>
          <option value="cosine">Cosine</option>
          <option value="exactBlackman">Exact Blackman</option>
          <option value="flatTop">Flat top</option>
          <option value="gaussian">Gaussian</option>
          <option value="hamming">Hamming</option>
          <option value="hann">Hann</option>
          <option value="lanczos">Lanczos</option>
          <option value="nuttall">Nuttall</option>
          <option value="rectangular">Rectangular</option>
          <option value="triangular">Triangular</option>
          <option value="tukey">Turkey</option>
          <option value="welch">Welch</option>
        </select>
    </div></script><script type="text/javascript">RED.nodes.registerType('octave',{
        color:"#e6e0e8",
        category: 'signal processing',
        defaults: {
            name: {value:""},
            func: {value:"\nwarning (\"off\");\nmsg"},
            stdout: {value:true},
            stderr: {value:true}
            // outputs: {value:1}
        },
        inputs:1,
        outputs:1,
        icon: "foctave.png",
        label: function() {
            return this.name;
        },
        oneditprepare: function() {
            var that = this;
            // $( "#node-input-outputs" ).spinner({
            //     min:1
            // });
            function functionDialogResize() {
                var rows = $("#dialog-form>div:not(.node-text-editor-row)");
                var height = $("#dialog-form").height();
                for (var i=0;i<rows.size();i++) {
                    height -= $(rows[i]).outerHeight(true);
                }
                var editorRow = $("#dialog-form>div.node-text-editor-row");
                height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
                $(".node-text-editor").css("height",height+"px");
                that.editor.resize();
            }
            $( "#dialog" ).on("dialogresize", functionDialogResize);
            $( "#dialog" ).one("dialogopen", function(ev) {
                var size = $( "#dialog" ).dialog('option','sizeCache-function');
                if (size) {
                    $("#dialog").dialog('option','width',size.width);
                    $("#dialog").dialog('option','height',size.height);
                    functionDialogResize();
                }
            });
            $( "#dialog" ).one("dialogclose", function(ev,ui) {
                var height = $( "#dialog" ).dialog('option','height');
                $( "#dialog" ).off("dialogresize",functionDialogResize);
            });
            this.editor = RED.editor.createEditor({
                id: 'node-input-func-editor',
                mode: 'ace/mode/matlab',
                theme: 'ace/mode/chrome',
                value: $("#node-input-func").val()
            });
            RED.library.create({
                url:"functions", // where to get the data from
                type:"function", // the type of object the library is for
                editor:this.editor, // the field name the main text body goes to
                mode:"ace/mode/matlab",
                fields:['name','outputs']
            });
            this.editor.focus();
        },
        oneditsave: function() {
            var annot = this.editor.getSession().getAnnotations();
            this.noerr = 0;
            $("#node-input-noerr").val(0);
            for (var k=0; k < annot.length; k++) {
                if (annot[k].type === "error") {
                    $("#node-input-noerr").val(annot.length);
                    this.noerr = annot.length;
                }
            }
            $("#node-input-func").val(this.editor.getValue());
            delete this.editor;
        }
      });
    
    RED.nodes.registerType('python',{
        color:"#e6e0e8",
        category: 'signal processing',
        defaults: {
            name: {value:""},
            func: {value:"print msg\n"},
            stdout: {value:true},
            stderr: {value:true}
        },
        inputs:1,
        outputs:1,
        icon: "fpython.png",
        label: function() {
            return this.name;
        },
        oneditprepare: function() {
            var that = this;
            function functionDialogResize() {
                var rows = $("#dialog-form>div:not(.node-text-editor-row)");
                var height = $("#dialog-form").height();
                for (var i=0;i<rows.size();i++) {
                    height -= $(rows[i]).outerHeight(true);
                }
                var editorRow = $("#dialog-form>div.node-text-editor-row");
                height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
                $(".node-text-editor").css("height",height+"px");
                that.editor.resize();
            }
            $( "#dialog" ).on("dialogresize", functionDialogResize);
            $( "#dialog" ).one("dialogopen", function(ev) {
                var size = $( "#dialog" ).dialog('option','sizeCache-function');
                if (size) {
                    $("#dialog").dialog('option','width',size.width);
                    $("#dialog").dialog('option','height',size.height);
                    functionDialogResize();
                }
            });
            $( "#dialog" ).one("dialogclose", function(ev,ui) {
                var height = $( "#dialog" ).dialog('option','height');
                $( "#dialog" ).off("dialogresize",functionDialogResize);
            });
            this.editor = RED.editor.createEditor({
                id: 'node-input-func-editor',
                mode: 'ace/mode/python',
                theme: 'ace/mode/chrome',
                value: $("#node-input-func").val()
            });
            RED.library.create({
                url:"functions", // where to get the data from
                type:"function", // the type of object the library is for
                editor:this.editor, // the field name the main text body goes to
                mode:"ace/mode/python",
                fields:['name','outputs']
            });
            this.editor.focus();
        },
        oneditsave: function() {
            var annot = this.editor.getSession().getAnnotations();
            this.noerr = 0;
            $("#node-input-noerr").val(0);
            for (var k=0; k < annot.length; k++) {
                //console.log(annot[k].type,":",annot[k].text, "on line", annot[k].row);
                if (annot[k].type === "error") {
                    $("#node-input-noerr").val(annot.length);
                    this.noerr = annot.length;
                }
            }
            $("#node-input-func").val(this.editor.getValue());
            delete this.editor;
        }
      });

      RED.nodes.registerType('r language',{
        color:"#e6e0e8",
        category: 'signal processing',
        defaults: {
            name: {value:""},
            func: {value:"\nmsg"},
            stdout: {value:true},
            stderr: {value:true}
            // outputs: {value:1}
        },
        inputs:1,
        outputs:1,
        icon: "frlanguage.png",
        label: function() {
            return this.name;
        },
        oneditprepare: function() {
            var that = this;
            // $( "#node-input-outputs" ).spinner({
            //     min:1
            // });
            function functionDialogResize() {
                var rows = $("#dialog-form>div:not(.node-text-editor-row)");
                var height = $("#dialog-form").height();
                for (var i=0;i<rows.size();i++) {
                    height -= $(rows[i]).outerHeight(true);
                }
                var editorRow = $("#dialog-form>div.node-text-editor-row");
                height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
                $(".node-text-editor").css("height",height+"px");
                that.editor.resize();
            }
            $( "#dialog" ).on("dialogresize", functionDialogResize);
            $( "#dialog" ).one("dialogopen", function(ev) {
                var size = $( "#dialog" ).dialog('option','sizeCache-function');
                if (size) {
                    $("#dialog").dialog('option','width',size.width);
                    $("#dialog").dialog('option','height',size.height);
                    functionDialogResize();
                }
            });
            $( "#dialog" ).one("dialogclose", function(ev,ui) {
                var height = $( "#dialog" ).dialog('option','height');
                $( "#dialog" ).off("dialogresize",functionDialogResize);
            });
            this.editor = RED.editor.createEditor({
                id: 'node-input-func-editor',
                mode: 'ace/mode/r',
                theme: 'ace/mode/chrome',
                value: $("#node-input-func").val()
            });
            RED.library.create({
                url:"functions", // where to get the data from
                type:"function", // the type of object the library is for
                editor:this.editor, // the field name the main text body goes to
                mode:"ace/mode/r",
                fields:['name','outputs']
            });
            this.editor.focus();
        },
        oneditsave: function() {
            var annot = this.editor.getSession().getAnnotations();
            this.noerr = 0;
            $("#node-input-noerr").val(0);
            for (var k=0; k < annot.length; k++) {
                //console.log(annot[k].type,":",annot[k].text, "on line", annot[k].row);
                if (annot[k].type === "error") {
                    $("#node-input-noerr").val(annot.length);
                    this.noerr = annot.length;
                }
            }
            $("#node-input-func").val(this.editor.getValue());
            delete this.editor;
        }
      });

    RED.nodes.registerType('fourier',{
        category: 'signal processing',      // the palette category
        color:"#E6E0F8",
        defaults: {             // defines the editable properties of the node
            name: {value:""},   //  along with default values.
            inverse: {value:false},
            window_function: {value: "rectangular"}
        },
        inputs:1,                // set the number of inputs - only 0 or 1
        outputs:1,               // set the number of outputs - 0 to n
        icon: "serial.png",    // set the icon (held in public/icons)
        label: function() {      // sets the default label contents
          console.log (this.inverse);
            return this.name || ((this.inverse?"inverse":"")+" FFT");
        },
        labelStyle: function() { // sets the class to apply to the label
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {

          var updateproperties = function (value)
          {
            console.log (value);
            if (value == true)
            {
              $("#node-window_function").hide ();
            }
            else if (value == false)
            {
              $("#node-window_function").show ();
            }
          };

          updateproperties ();

          $("#node-input-inverse").on ("change", function ()
          {
            updateproperties ($(this).is(":checked"));
          });
        },
    });</script><script type="text/x-red" data-help-name="octave"><p>A function block where you can write <b>Octave</b> code.</p>
  <p>The message is passed in as an` object called <code>msg</code>.</p>
  <p>By convention it will have a <code>msg.payload</code> property containing
     the body of the message.</p>
  <p>The function will return the <b>msg</b> object.</p></script><script type="text/x-red" data-help-name="python"><p>A function block where you can write <b>Python</b> code.</p>
  <p>The message is passed in as an` object called <code>msg</code>.</p>
  <p>By convention it will have a <code>msg.payload</code> property containing
     the body of the message.</p>
  <p>The function will return the <b>msg</b> object.</p></script><script type="text/x-red" data-help-name="r language"><p>A function block where you can write <b>R Language</b> code.</p>
  <p>The message is passed in as an` object called <code>msg</code>.</p>
  <p>By convention it will have a <code>msg.payload</code> property containing
     the body of the message.</p>
  <p>The function will return the <b>msg</b> object.</p></script><script type="text/x-red" data-help-name="fft"><p>Computes FFT or iFFT. The signal is in the <b>payload</b>.</p>
    <p>The real part is <b>payload</b> or <b>payload[0]</b></p>
    <p>The imaginary part is <b>payload[1]</b></p>
    <p>The fields <b>r</b> and <b><i</b> may also memorize the signal.</p></script><script type="text/x-red" data-template-name="value"><div class="form-row">
        <label for="node-input-value"><i class="fa fa-tag"></i> Variable Name</label>
        <input type="text" id="node-input-value" placeholder="Variable name">
    </div>
    <div class="form-row" id="node-publish">
        <input style="width: 30px;" type="checkbox" id="node-input-publish"><label style="width: 250px;" for="node-input-publish">Publish to the websocket</label>
    </div>
    <div class="form-row">
        <label for="node-input-initial"><i class="fa fa-tag"></i> Initial</label>
        <input type="text" id="node-input-initial" placeholder="Initialize with value">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="message callback"><div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="set x value"><div class="form-row">
        <label for="node-input-value"><i class="fa fa-tag"></i> Variable Name</label>
        <input type="text" id="node-input-value" placeholder="Variable name">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('value',{
        color:"#e6e0f8",
        category: 'function',
        defaults: {
            name: {value:""},
            value: {value:""},
            publish: {value: true},
            initial: {value: ""}
        },
        inputs:1,
        outputs:0,
        icon: "arrow-in.png",
        label: function() {
            return this.value || this.name;
        },
        oneditprepare: function() {
            
        },
        oneditsave: function() {
            
        }
    });

    RED.nodes.registerType('message callback',{
        color:"#e6e0f8",
        category: 'function',
        defaults: {
            name: {value:""},
        },
        inputs:1,
        outputs:2,
        icon: "storage.png",
        label: function() {
            return this.value || this.name;
        },
        oneditprepare: function() {
            
        },
        oneditsave: function() {
            
        }
    });

    RED.nodes.registerType('set x value',{
        color:"#e6e0f8",
        category: 'signal processing',
        defaults: {
            name: {value:""},
            value: {value:""},
        },
        inputs:1,
        outputs:1,
        icon: "arrow-in.png",
        label: function() {
            return 'Set x for '+this.value || this.name;
        },
        oneditprepare: function() {
            
        },
        oneditsave: function() {
            
        }
    });</script><script type="text/x-red" data-help-name="value"><p>Loads the <b>payload</b> into a variable</p>.</script><script type="text/x-red" data-help-name="message callback"><p>Store a message, attaches an id and sends the message. When a message with an attached id is recived, the stored message is extended with the recived message.</p>.</script><script type="text/x-red" data-help-name="set x value"><p>Loads the <b>value</b> into msg.x</p>.</script><script type="text/x-red" data-template-name="visual"><div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row" style="margin-bottom: 0px;">
            <label for="node-input-func"><i class="fa fa-wrench"></i> Function</label>
            <input type="hidden" id="node-input-func" autofocus="autofocus">
            <input type="hidden" id="node-input-xmlvisual" autofocus="autofocus">
    </div>
    <div class="form-row node-text-editor-row">
        <div style="height: 250px;" class="node-text-editor" id="node-input-func-editor" ></div>
    </div>
    <div class="form-row">
        <label for="node-input-outputs"><i class="fa fa-random"></i> Outputs</label>
        <input id="node-input-outputs" style="width: 60px; height: 1.7em;" value="1">
    </div>
    <div class="form-tips">See the Info tab for help writing functions.</div></script><script type="text/javascript">RED.nodes.registerType('visual',{
        color:"#fdd0a2",
        category: 'function',
        defaults: {
            name: {value:""},
            func: {value:"\nreturn msg;"},
            xmlvisual: {value: "<xml xmlns=\"http://www.w3.org/1999/xhtml\"><block type=\"variables_set\" id=\"1\" inline=\"true\" x=\"61\" y=\"43\"><field name=\"VAR\">new message</field><value name=\"VALUE\"><block type=\"visual_new_message\" id=\"2\"></block></value><next><block type=\"visual_msg_set\" id=\"27\" inline=\"true\"><value name=\"payload\"><block type=\"text\" id=\"28\"><field name=\"TEXT\">payload</field></block></value><value name=\"val\"><block type=\"text\" id=\"29\"><field name=\"TEXT\">value</field></block></value><next><block type=\"visual_ret\" id=\"3\" inline=\"true\"><value name=\"msg\"><block type=\"variables_get\" id=\"4\"><field name=\"VAR\">new message</field></block></value></block></next></block></next></block></xml>"},
            outputs: {value:1}
        },
        inputs:1,
        outputs:1,
        icon: "fvisual.png",
        label: function() {
            return this.name;
        },
        oneditprepare: function() {
            $( "#node-input-outputs" ).spinner({
                min:1
            });

            this.xmlvisualsource = $('#node-input-xmlvisual').val();
            this.source = "";

            function functionDialogResize(ev, ui) {
                $("#node-input-func-editor").css("height",(ui.size.height-300)+"px");
            };

            $( "#dialog" ).on("dialogresize", functionDialogResize);
            $( "#dialog" ).one("dialogopen", function(ev, ui) {
                var size = {
                    width: $(window).width()-35,
                    height: $(window).height()-35
                };
                if (size) {
                    $("#dialog").dialog('option','width',size.width);
                    $("#dialog").dialog('option','height',size.height);
                    functionDialogResize(ev, {size:size});
                }
            });
            $( "#dialog" ).one("dialogclose", function(ev,ui) {
                var height = $( "#dialog" ).dialog('option','height');
                $( "#dialog" ).off("dialogresize",functionDialogResize);
            });
            var that = this;

            var div = $("#node-input-func-editor");
            div.append ('<iframe id="fvisualiframe" src="/visual2/html/blockly_frame.html?nrfile=toolbox&blocks=&readonly=false" style="width:100%; height:100%; float:left;"></iframe>');

            var loadText = function (blockly, text)
            {
              try
              {
                var xml = blockly.Xml.textToDom(text);
                blockly.mainWorkspace.clear ();
                blockly.Xml.domToWorkspace(blockly.mainWorkspace, xml);
                return text;
              }
              catch (e)
              {
                var xml = blockly.Xml.textToDom('<xml></xml>');
                blockly.Xml.domToWorkspace(blockly.mainWorkspace, xml);
                return '<xml></xml>';
              }
              return text;
            };

            window.showHideCode = function (nrfile)
            {
                alert (that.source);

                return 'show';
            };

            window.blocklyLoaded = function  (blockly)
            {
                this.blockly = blockly;
                loadText (blockly, that.xmlvisual);
                this.blockly.addChangeListener (function ()
                    {
                        var xml = blockly.Xml.workspaceToDom (blockly.mainWorkspace);
                        that.xmlvisualsource = blockly.Xml.domToText(xml);
                        that.source = blockly.JavaScript.workspaceToCode ();




                    });
            };

            window.undo = function (from)
            {
                alert ('undo');
            };
        },
        oneditsave: function() {
            $("#node-input-func").val(this.source);
            $("#node-input-xmlvisual").val(this.xmlvisualsource);
            // delete this.editor;
        }
    });</script><script type="text/x-red" data-help-name="visual"><p>A function block where you can write code to do more interesting things.</p>
    <p>The message is passed in as a JavaScript object called <code>msg</code>.</p>
    <p>By convention it will have a <code>msg.payload</code> property containing
       the body of the message.</p>
    <p>The function should return the messages it wants to pass on to the next nodes
    in the flow. It can return:</p>
    <ul>
      <li>a single message object - passed to nodes connected to the first output</li>
      <li>an array of message objects - passed to nodes connected to the corresponding outputs</li>
    </ul>
    <p>If any element of the array is itself an array of messages, multiple
          messages are sent to the corresponding output.</p>
    <p>If null is returned, either by itself or as an element of the array, no
          message is passed on.</p>
    <p>See the <a target="_new" href="http://nodered.org/docs/writing-functions.html">online documentation</a> for more help.</p></script><script type="text/javascript">RED.nodes.registerType('http request',{
        category: 'function',
        color:"rgb(231, 231, 174)",
        defaults: {
            name: {value:""},
            method:{value:"GET"},
            url:{value:""},
            user: {value:""},
            password: {value: ""}
            //user -> credentials
            //pass -> credentials
        },
        inputs:1,
        outputs:1,
        align: "right",
        icon: "white-globe.png",
        label: function() {
            return this.name||"http request";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            if ((this.user && this.user.length>0) || (this.password && this.password.length>0)) {
                $('#node-input-useAuth').prop('checked', true);
                $(".node-input-useAuth-row").show();
            } else {
                $('#node-input-useAuth').prop('checked', false);
                $(".node-input-useAuth-row").hide();
            }
            $("#node-input-useAuth").change(function() {
                if ($(this).is(":checked")) {
                    $(".node-input-useAuth-row").show();
                } else {
                    $(".node-input-useAuth-row").hide();
                    $('#node-input-user').val('');
                    $('#node-input-password').val('');
                }
            });
        },
    });

    RED.nodes.registerType('web route',{
        color:"rgb(215, 215, 180)",
        category: 'input',
        defaults: {
            name: {value:""},
            server: {type:"webserver", required: true},
            route: {value:"/"},
            method: {value: 'GET'},
            cors: {value: false},
            allow: {value: "*"}
        },
        inputs:0,
        outputs:1,
        icon: "white-globe.png",
        label: function() {
            return 'Web '+this.route;
        },
        oneditprepare: function() {

          var updateproperties = function (value)
          {
            if (value === true)
            {
              $("#node-allow").show ();
            }
            else
            {
              $("#node-allow").hide ();
            }
          };

          updateproperties ();

          $("#node-input-cors").on ("change", function ()
          {
            updateproperties ($(this).is(":checked"));
          });
        },
    });

    RED.nodes.registerType('webserver',{
        category: 'config',
        defaults: {
            name: {value:""},
            port: {value:5000, validator:RED.validators.number ()},
            websocket: {value: true}
        },
        label: function() {
            this.port = this.port || 5000;
            return (this.name && this.name.length>0)?this.name:'Web Server on port '+this.port;
        },
    });

    RED.nodes.registerType('web response',{
        color:"rgb(215, 215, 180)",
        category: 'output',
        defaults: {
            name: {value:""},
            error: {value: 200, validator: RED.validators.number ()},
            redirect: {value: ""}
        },
        inputs:1,
        outputs:0,
        icon: "white-globe.png",
        align: 'right',
        label: function() {
            return (this.name.length>0)?this.name:'Web Response';
        },
    });

    var html = window.atob ('PCFET0NUWVBFIGh0bWw+DQo8aHRtbCBuZy1hcHA9Im15QXBwIj4NCiAgPGhlYWQ+DQogICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vYWpheC5nb29nbGVhcGlzLmNvbS9hamF4L2xpYnMvYW5ndWxhcmpzLzEuMy4xNC9hbmd1bGFyLm1pbi5qcyI+PC9zY3JpcHQ+DQogICAgPHNjcmlwdCBzcmM9Ii9zb2NrZXQuaW8vc29ja2V0LmlvLmpzIj48L3NjcmlwdD4NCiAgICA8c2NyaXB0Pg0KICAgICAgICBhbmd1bGFyLm1vZHVsZSgnbXlBcHAnLFtdKS5jb250cm9sbGVyICgnV3lsaW9kcmluQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsICR0aW1lb3V0KQ0KICAgICAgICB7DQogICAgICAgICAgICB2YXIgc29ja2V0ID0gaW8oKTsNCiAgICAgICAgICAgIHNvY2tldC5vbigndmFsdWUnLCBmdW5jdGlvbiAoZGF0YSkgew0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nIChkYXRhKTsNCiAgICAgICAgICAgICAgICAkdGltZW91dCAoZnVuY3Rpb24gKCkNCiAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICRzY29wZVtkYXRhLnZhcmlhYmxlXSA9IGRhdGEudmFsdWU7ICAgICAgDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB3eWxpb2RyaW4ub25VcGRhdGUgPT09ICJmdW5jdGlvbiIpDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICB3eWxpb2RyaW4ub25VcGRhdGUgKGRhdGEudmFyaWFibGUsIGRhdGEudmFsdWUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICAgICAgDQogICAgICAgIHZhciB3eWxpb2RyaW4gPSB7DQogICAgICAgICAgb25VcGRhdGU6IG51bGwsDQogICAgICAgIH07DQogICAgPC9zY3JpcHQ+DQogIDwvaGVhZD4NCiAgPGJvZHkgbmctY29udHJvbGxlcj0iV3lsaW9kcmluQ3RybCI+DQogICAgVmFsdWUge3sgdmFsdWUgfX0NCiAgICA8c2NyaXB0Pg0KICAgICAgLy8gVGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgZXZlcnl0aW1lIGEgdmFyaWFibGUgaXMgdXBkYXRlZA0KICAgICAgd3lsaW9kcmluLm9uVXBkYXRlID0gZnVuY3Rpb24gKHZhcmlhYmxlLCBkYXRhKQ0KICAgICAgew0KICAgICAgICBjb25zb2xlLmxvZyAodmFyaWFibGUrJyAnK2RhdGEpOw0KICAgICAgfQ0KICAgIDwvc2NyaXB0Pg0KICA8L2JvZHk+DQo8L2h0bWw+').toString();

    RED.nodes.registerType('web html',{
        color:"rgb(215, 215, 180)",
        category: 'output',
        defaults: {
            name: {value:''},
            template: {value:html},
            replace: {value: false}
        },
        inputs:1,
        outputs:0,
        icon: "white-globe.png",
        label: function() {
            return (this.name.length>0)?this.name:'Web Html';
        },
        oneditprepare: function() {
            var that = this;
            function functionDialogResize() {
                var rows = $("#dialog-form>div:not(.node-text-editor-row)");
                var height = $("#dialog-form").height();
                for (var i=0;i<rows.size();i++) {
                    height -= $(rows[i]).outerHeight(true);
                }
                var editorRow = $("#dialog-form>div.node-text-editor-row");
                height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
                $(".node-text-editor").css("height",height+"px");
                that.editor.resize();
            }
            $( "#dialog" ).on("dialogresize", functionDialogResize);
            $( "#dialog" ).one("dialogopen", function(ev) {
                var size = $( "#dialog" ).dialog('option','sizeCache-function');
                if (size) {
                    $("#dialog").dialog('option','width',size.width);
                    $("#dialog").dialog('option','height',size.height);
                    functionDialogResize();
                }
            });
            $( "#dialog" ).one("dialogclose", function(ev,ui) {
                var height = $( "#dialog" ).dialog('option','height');
                $( "#dialog" ).off("dialogresize",functionDialogResize);
            });
            this.editor = RED.editor.createEditor({
                id: 'node-input-template-editor',
                mode: 'ace/mode/html',
                theme: 'ace/mode/chrome',
                value: $("#node-input-template").val()
            });
            RED.library.create({
                url:"functions", // where to get the data from
                type:"function", // the type of object the library is for
                editor:this.editor, // the field name the main text body goes to
                mode:"ace/mode/html",
                fields:['name','outputs']
            });
            this.editor.focus();
        },
        oneditsave: function() {
            var annot = this.editor.getSession().getAnnotations();
            this.noerr = 0;
            $("#node-input-noerr").val(0);
            for (var k=0; k < annot.length; k++) {
                if (annot[k].type === "error") {
                    $("#node-input-noerr").val(annot.length);
                    this.noerr = annot.length;
                }
            }
            $("#node-input-template").val(this.editor.getValue());
            delete this.editor;
        }
      });

    RED.nodes.registerType('web template',{
        color:"rgb(215, 215, 180)",
        category: 'output',
        defaults: {
            name: {value:""},
            template: {value: ""}
        },
        inputs:1,
        outputs:0,
        icon: "white-globe.png",
        align: 'right',
        label: function() {
            return (this.name.length>0)?this.name:'Web '+this.template;
        },
    });</script><script type="text/x-red" data-template-name="http request"><div class="form-row">
        <label for="node-input-method"><i class="fa fa-tasks"></i> Method</label>
        <select type="text" id="node-input-method" style="width:72%;">
        <option value="GET">GET</option>
        <option value="POST">POST</option>
        <option value="PUT">PUT</option>
        <option value="DELETE">DELETE</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-url"><i class="fa fa-globe"></i> URL</label>
        <input type="text" id="node-input-url" placeholder="http://">
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-useAuth" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-useAuth" style="width: 70%;">Use basic authentication?</label>
    </div>
    <div class="form-row node-input-useAuth-row">
        <label for="node-input-user"><i class="fa fa-user"></i> Username</label>
        <input type="text" id="node-input-user">
    </div>
    <div class="form-row node-input-useAuth-row">
        <label for="node-input-password"><i class="fa fa-lock"></i> Password</label>
        <input type="password" id="node-input-password">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="web route"><div class="form-row">
        <label for="node-input-server"><i class="fa fa-tag"></i> Server</label>
        <input type="text" id="node-input-server" placeholder="/">
    </div>
    <div class="form-row">
        <label for="node-input-route"><i class="fa fa-tag"></i> Route</label>
        <input type="text" id="node-input-route" placeholder="/">
    </div>
    <div class="form-row">
        <label for="node-input-method"><i class="fa fa-arrow-up"></i> Method</label>
        <select id="node-input-method" style="width:73% !important">
            <option value="GET">GET</option>
            <option value="POST">POST</option>
            <option value="PUT">PUT</option>
            <option value="DELETE">DELETE</option>
        </select>
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-cors" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-cors" style="width: 70%;">Allow cross origin requests</label>
    </div>
    <div class="form-row" id="node-allow">
        <label for="node-input-allow"><i class="fa fa-tag"></i> Allow from</label>
        <input type="text" id="node-input-allow" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="webserver"><div class="form-row">
        <label for="node-config-input-port"><i class="fa fa-random"></i> Port</label>
        <input id="node-config-input-port" style="width: 60px; height: 1.7em;" value="5000">
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-config-input-websocket" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-config-input-websocket" style="width: 70%;">Use web socket for values</label>
    </div>
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-config-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="web response"><div class="form-row">
        <label for="node-input-error"><i class="fa fa-tag"></i> Status/Error</label>
        <input type="text" id="node-input-error" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-redirect"><i class="fa fa-tag"></i> Redirect</label>
        <input type="text" id="node-input-redirect" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="web html"><div class="form-row" style="margin-bottom: 0px;">
            <label for="node-input-template"><i class="fa fa-wrench"></i> HTML Template</label>
            <input type="hidden" id="node-input-template" autofocus="autofocus">
    </div>
    <div class="form-row node-text-editor-row">
        <div style="height: 250px;" class="node-text-editor" id="node-input-template-editor" ></div>
    </div>
    <div class="form-row" id="node-replace">
        <input style="width: 30px;" type="checkbox" id="node-input-replace"><label style="width: 250px;" for="node-input-replace">Replace Variables</label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="web template"><div class="form-row">
        <label for="node-input-template"><i class="fa fa-tag"></i> Template</label>
        <input type="text" id="node-input-template" placeholder="template.html">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-help-name="http request"><p>Provides a node for making http requests.</p>
    <p>The URL and HTTP method can be configured in the node, if they are left blank they should be set in an incoming message on <code>msg.url</code> and <code>msg.method</code>:</p>
    <ul>
        <li><code>url</code>, if set, is used as the url of the request. Must start with http: or https:</li>
        <li><code>method</code>, if set, is used as the HTTP method of the request.
        Must be one of <code>GET</code>, <code>PUT</code>, <code>POST</code> or <code>DELETE</code> (default: GET)</li>
        <li><code>headers</code>, if set, should be an object containing field/value
        pairs to be added as request headers</li>
        <li><code>payload</code> is sent as the body of the request</li>
    </ul>
    <p>When configured within the node, the URL property can contain <a href="http://mustache.github.io/mustache.5.html" target="_new">mustache-style</a> tags. These allow the
    url to be constructed using values of the incoming message. For example, if the url is set to
    <code>example.com/{{topic}}</code>, it will have the value of <code>msg.topic</code> automatically inserted.</p>
    <p>
    The output message contains the following properties:
    <ul>
        <li><code>payload</code> is the body of the response</li>
        <li><code>statusCode</code> is the status code of the response, or the error code if the request could not be completed</li>
        <li><code>headers</code> is an object containing the response headers</li>
    </ul></script><script type="text/x-red" data-help-name="web route">Runs a web server listening on <b>port</b> and registers and registers the <b>route</b> for <b>method</b>. This uses expressjs.
    Whenever a request is made to <b>route</b>, msg will contain the following:
    <ul>
        <li><b>payload</b> requests data
            <ul>
                <li>GET/DELETE - query string</li>
                <li>POST/PUT</li> - request body
            </ul>
        </li>
        <li> <b>req</b> - request </li>
        <li> <b>res</b> - response </li>
        <li> <b>next</b> - next </li>
    </ul></script><script type="text/x-red" data-help-name="webserver">Web server</script><script type="text/x-red" data-help-name="web response">Send a response for a web request. This must be the message returned from a web route.
    The <b>payload</b> is sent back.</script><script type="text/x-red" data-help-name="web html"><p>A template where you can write <b>HTML</b> code.</p>
  <p>If Replace variables is checked, the {{variable}} will be replaced from msg.payload.</p></script><script type="text/x-red" data-help-name="web template">Send a template as response for a web request. It uses jinja templates lecated in the <b>templates</b> folder. Items in the template are replaced by <b>payload</b>.

    This must be the message returned from a web route.</script><script type="text/javascript">RED.nodes.registerType('digitalwrite',{
        category: 'IO Pins',
        color: '#a6bbcf',
        defaults: {
            name: {value:""},
            pin: {
                value: "0"
            }
        },
        inputs:1,
        outputs:0,
        icon: "digital.png",
        align: 'right',
        label: function() {
            return this.name||"Digital Write "+(this.pin.length>0?this.pin:"msg.topic");
        }
    });

    RED.nodes.registerType('digitalread',{
        category: 'IO Pins',
        color: '#a6bbcf',
        defaults: {
            name: {value:""},
            pin: {
                value: "0"
            }
        },
        inputs:1,
        outputs:1,
        icon: "digital.png",
        label: function() {
            return this.name||"Digital Read "+(this.pin.length>0?this.pin:"msg.topic");
        }
    });

    RED.nodes.registerType('shift out',{
        category: 'IO Pins',
        color: '#a6bbcf',
        defaults: {
            name: {value:""},
            pin: {
                value: "0"
            },
            clock: {
                value: "1"
            },
            msblsb: {
                value: "0",
                required: true
            },
            register: {
                value: "none",
                required: true
            },
            register_pin: {
                value: "2",
            }
        },
        inputs:1,
        outputs:0,
        icon: "serial.png",
        align: 'right',
        label: function() {
            return this.name||"Shift out "+(this.pin.length>0?this.pin:"msg.topic");
        },
        oneditprepare: function() {

          var updateproperties = function (value)
          {
            if (value === "none")
            {
              $("#node-register_pin").hide ();
            }
            else
            {
              $("#node-register_pin").show ();
            }
          };

          updateproperties ();

          $("#node-input-register").on ("change", function ()
          {
            updateproperties ($(this).val());
          });
        },
    });

    RED.nodes.registerType('shift in',{
        category: 'IO Pins',
        color: '#a6bbcf',
        defaults: {
            name: {value:""},
            pin: {
                value: "0"
            },
            clock: {
                value: "1"
            },
            msblsb: {
                value: "0",
                required: true
            }
        },
        inputs:1,
        outputs:1,
        icon: "serial.png",
        label: function() {
            return this.name||"Shift in "+(this.pin.length>0?this.pin:"msg.topic");
        }
    });

    RED.nodes.registerType('analogwrite',{
        category: 'IO Pins',
        color: '#a6bbcf',
        defaults: {
            name: {value:""},
            pin: {
                value: "0",
            }
        },
        inputs:1,
        outputs:0,
        icon: "analog-write.png",
        align: 'right',
        label: function() {
            return this.name||"Analog Write "+(this.pin.length>0?this.pin:"msg.topic");
        }
    });

    RED.nodes.registerType('analogread',{
        category: 'IO Pins',
        color: '#a6bbcf',
        defaults: {
            name: {value:""},
            pin: {
                value: "0",
            },
            average: {
                value: "1",
                validate: RED.validators.number()
            },
            readarray: {
                value: "1",
                validate: RED.validators.number()
            }
        },
        inputs:1,
        outputs:1,
        icon: "analog-read.png",
        label: function() {
            return this.name||"Analog Read "+(this.pin.length>0?this.pin:"msg.topic");
        }
    });
    
    RED.nodes.registerType('sendsignal',{
        category: 'Signals',
        color: '#a6bbcf',
        defaults: {
            name: {value:""},
            signal: {
                value: "signal", 
                required: true, 
                validate: RED.validators.regex(/[A-Za-z]+/)
            },
            to: {value: 'dashboard'},
            deviceid: {value: ''}
        },
        inputs:1,
        outputs:0,
        icon: "serial.png",
        align: 'right',
        label: function() {
            return this.name||"Send signal "+this.signal;
        },

        oneditprepare: function() {

          var updateproperties = function (value)
          {
            if (value == "dashboard")
            {
              $("#node-deviceid").hide ();
            }
            else if (value == "device")
            {
              $("#node-deviceid").show ();
            }
          };

          updateproperties ();

          $("#node-input-to").on ("change", function ()
          {
            updateproperties (this.value);
          });
        },
    });</script><script type="text/x-red" data-template-name="digitalwrite"><div class="form-row">
        <label for="node-input-pin"><i class="fa fa-circle"></i> Pin Number</label>
        <input type="text" id="node-input-pin" placeholder="0">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="digitalread"><div class="form-row">
        <label for="node-input-pin"><i class="fa fa-circle"></i> Pin Number</label>
        <input type="number" id="node-input-pin" placeholder="0">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="shift out"><div class="form-row">
        <label for="node-input-pin"><i class="fa fa-circle"></i> Data Pin Number</label>
        <input type="text" id="node-input-pin" placeholder="0">
    </div>
    <div class="form-row">
        <label for="node-input-pin"><i class="fa fa-circle"></i> Clock Pin Number</label>
        <input type="number" id="node-input-clock" placeholder="0">
    </div>
    <div class="form-row">
        <label for="node-input-complete"><i class="fa fa-list"></i> Direction</label>
        <select type="text" id="node-input-msblsb" style="display: inline-block; width: 250px; vertical-align: top;">
            <option value="0">LSB first</option>
            <option value="1">MSB first</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-register"><i class="fa fa-list"></i> Latch Register</label>
        <select type="text" id="node-input-register" style="display: inline-block; width: 250px; vertical-align: top;">
            <option value="none">Without</option>
            <option value="rising_edge">Rising Edge</option>
            <option value="falling_edge">Falling Edge</option>
        </select>
    </div>
    <div class="form-row" id="node-register_pin">
        <label for="node-input-register_pin"><i class="fa fa-circle"></i> Register Clock Pin Number</label>
        <input type="text" id="node-input-register_pin" placeholder="0">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="shift in"><div class="form-row">
        <label for="node-input-pin"><i class="fa fa-circle"></i> Data Pin Number</label>
        <input type="number" id="node-input-pin" placeholder="0">
    </div>
    <div class="form-row">
        <label for="node-input-pin"><i class="fa fa-circle"></i> Clock Pin Number</label>
        <input type="number" id="node-input-clock" placeholder="0">
    </div>
    <div class="form-row">
        <label for="node-input-complete"><i class="fa fa-list"></i> Direction</label>
        <select type="text" id="node-input-msblsb" style="display: inline-block; width: 250px; vertical-align: top;">
            <option value="0">LSB first</option>
            <option value="1">MSB first</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="analogwrite"><div class="form-row">
        <label for="node-input-pin"><i class="fa fa-circle"></i> Pin Number</label>
        <input type="number" id="node-input-pin" placeholder="0">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="analogread"><div class="form-row">
        <label for="node-input-pin"><i class="fa fa-circle"></i> Pin Number</label>
        <input type="number" id="node-input-pin" placeholder="0">
    </div>
    <div class="form-row">
        <label for="node-input-average"><i class="fa fa-circle"></i> Average out of </label>
        <input type="number" id="node-input-average" placeholder="1">
    </div>
    <div class="form-row">
        <label for="node-input-readarray"><i class="fa fa-circle"></i> Elements to read </label>
        <input type="number" id="node-input-readarray" placeholder="1">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="sendsignal"><div class="form-row">
        <label for="node-input-to"><i class="fa fa-list"></i> To</label>
        <select type="text" id="node-input-to" style="display: inline-block; width: 250px; vertical-align: tops;">
            <option value="dashboard">Dashboard</option>
            <option value="device">Device</option>
        </select>
    </div>
    <div class="form-row" id="node-deviceid">
        <label for="node-input-deviceid"><i class="icon-tag"></i> Device ID</label>
        <input type="text" id="node-input-deviceid" placeholder="deviceid">
    </div>
    <div class="form-row">
        <label for="node-input-pin"><i class="icon-tag"></i> Signal</label>
        <input type="text" id="node-input-signal" placeholder="signal">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <!--<div class="form-row">
        <label for="node-input-address"><i class="icon-tag"></i> Address</label>
        <input type="text" id="node-input-address" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-dashboarduuid"><i class="icon-tag"></i> Dashboard UUID</label>
        <input type="text" id="node-input-dashboarduuid" placeholder="">
    </div>--></script><script type="text/x-red" data-help-name="digitalwrite"><p>Write a digital value on a pin. The value written is in <b>payload</b> and should be is HIGH (1) or LOW (0).</p>

    <p>If no pin is specified, the pin number is the <b>topic</b> field of msg.</p></script><script type="text/x-red" data-help-name="digitalread"><p>When it receives an input, reads a digital value from a pin. The value read is in <b>payload</b> and is HIGH (1) or LOW (0).</p>

    <p>If no pin is specified, the pin number is the <b>topic</b> field of msg.</p></script><script type="text/x-red" data-help-name="shift out"><p>Shifts out a byte value on a pin using the clock pin as clock. The value written is in <b>payload</b>.</p>

    <p>If no data pin is specified, the pin number is the <b>topic</b> field of msg.</p>
    <p>If no clock pin is specified, the pin number is the <b>clock</b> field of msg.</p></script><script type="text/x-red" data-help-name="shift in"><p>When it receives an input, shifts in a byte value from a pin using the clock pin as clock. The value read is in <b>payload</b>.</p>

    <p>If no data pin is specified, the pin number is the <b>topic</b> field of msg.</p>
    <p>If no clock pin is specified, the pin number is the <b>clock</b> field of msg.</p></script><script type="text/x-red" data-help-name="analogwrite"><p>Write a PWM value on a pin. The value written is in [0, 255].</p>

    <p>If no pin is specified, the pin number is the <b>topic</b> field of msg.</p></script><script type="text/x-red" data-help-name="analogread"><p>When it receives an input, reads an analog value from a pin. The value read is in [0, 1023].</p>

    <p>If no pin is specified, the pin number is the <b>topic</b> field of msg.</p></script><script type="text/x-red" data-help-name="button"><p>Sends the value of a signal, puts a flag if <b>flag</b> is set.</p></script><script type="text/x-red" data-help-name="sendsignal"><p>Sends the value of a signal, puts a flag if <b>flag</b> is set.</p></script><script type="text/javascript">RED.nodes.registerType('send',{
        category: 'social',
        color: '#a6bbcf',
        defaults: {
            name: {value:""},
            label: {value:"", required: true},
            boardid: {value:""},
            message: {value:false}
        },
        inputs:1,
        outputs:0,
        icon: "bridge.png",
        align: 'right',
        label: function() {
            return this.name||"Send Message "+this.boardid;
        }
    });

    RED.nodes.registerType('receivesignal',{
        category: 'Signals',
        color: '#a6bbcf',
        defaults: {
            name: {value:""},
            signal: {value:"*"}
        },
        inputs:0,
        outputs:1,
        icon: "serial.png",
        label: function() {
            return this.name||"Receive Signal "+this.signal;
        }
    });

    RED.nodes.registerType('receive',{
        category: 'social',
        color: '#a6bbcf',
        defaults: {
            name: {value:""},
            label: {value:"*"}
        },
        inputs:0,
        outputs:1,
        icon: "bridge.png",
        label: function() {
            return this.name||"Receive Message "+this.label;
        }
    });

    RED.nodes.registerType('mobile sensors',{
        category: 'Sensors',
        color: '#a6bbcf',
        defaults: {
            name: {value:""},
            mobile: {value:"phone_id"}
        },
        inputs:0,
        outputs:1,
        icon: "serial.png",
        label: function() {
            return this.name||"Mobile senors "+this.mobile;
        }
    });</script><script type="text/x-red" data-template-name="send"><div class="form-row">
        <label for="node-input-label"><i class="icon-tag"></i> Label</label>
        <input type="text" id="node-input-label" placeholder="label">
    </div>
    <div class="form-row">
        <label for="node-input-boardid"><i class="icon-tag"></i> Board ID </label>
        <input type="text" id="node-input-boardid" placeholder="boardid@wyliodrin.com">
    </div>
    <div class="form-row" id="node-message">
        <input style="width: 30px;" type="checkbox" id="node-input-message"><label style="width: 250px;" for="node-input-message">Send whole message</label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="receive"><div class="form-row">
        <label for="node-input-label"><i class="icon-tag"></i> Label</label>
        <input type="text" id="node-input-label" placeholder="*">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="receivesignal"><div class="form-row">
        <label for="node-input-signal"><i class="icon-tag"></i> Signal</label>
        <input type="text" id="node-input-signal" placeholder="*">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="mobile sensors"><div class="form-row">
        <label for="node-input-mobile"><i class="icon-tag"></i> Mobile</label>
        <input type="text" id="node-input-mobile" placeholder="mobile">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-help-name="send"><p>Send message with a specified <b>label</b> to a board or boards. The message to send is <b>payload</b>. It will be serialized as string. You may send the whole message by checking "Send whole message"</p>

    <p>The message will be sent to the board with <b>boardid</b>. This has to be one id or more ids separated with commas. If this is missing, the <b>Board ID</b> part of the message has to be filled.
    </p></script><script type="text/x-red" data-help-name="receive"><p>Receive message from a board with label <b>Label</b>. If label is <b>*</b>, it will receive all the messages.</p>

    <p>Message will be filled with:
    <ul>
        <li> <b>label</b> - the label of the message
        <li> <b>sender</b> - the board id of the sender of the message</li>
        <li> <b>payload</b> - the message
    </ul>
    </p></script><script type="text/x-red" data-help-name="receivesignal"><p>Receive a signal from a board. If signal is <b>*</b>, it will receive all the signals.</p>

    <p>Message will be filled with:
    <ul>
        <li> <b>signal</b> - the signal
        <li> <b>sender</b> - the board id of the sender of the message</li>
        <li> <b>payload</b> - the signal value
    </ul>
    </p></script><script type="text/x-red" data-help-name="mobile sensors"><p>Receive sensors from a mobile.</p>

    <p>Message will be filled with:
    <ul>
        <li> <b>sender</b> - the mobile</li>
        <li> <b>payload</b> - the sensors, a key data store, key is the senosr type, data is usually an array 
        </li>
    </ul>
    </p></script><script type="text/x-red" data-template-name="catch"><div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="name">
    </div></script><script type="text/javascript">RED.nodes.registerType('catch',{
        category: 'input',
        color:"#e49191",
        defaults: {
            name: {value:""}
        },
        inputs:0,
        outputs:1,
        icon: "alert.png",
        label: function() {
            return this.name||"catch";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-help-name="catch"><p>Catch errors thrown by nodes on the same tab.</p>
    <p>If a node throws a error whilst handling a message, the flow will typically
       halt. This node can be used to catch those errors and handle them with a
       dedicated flow.</p>
    <p>The node will catch errors thrown by any node on the same tab. If there
       are multiple catch nodes on a tab, they will all get triggered.</p>
    <p>If an error is thrown within a subflow, the error will get handled by any
       catch nodes within the subflow. If none exists, the error is propagated
       up to the tab the subflow instance is on.</p>
    <p>The message sent by this node will be the original message if the node that
       threw the error provided it. The message will have an <code>error</code>
       property with the following attributes:
       <ul>
        <li><code>message</code> : the error message</li>
        <li><code>source.id</code> : the id of the node that threw the error</li>
        <li><code>source.type</code> : the type of the node that threw the error</li>
       </ul>
   </p>
   <p>If the message already had a <code>error</code> property, it is copied to <code>_error</code>.</p></script><script type="text/x-red" data-template-name="exec"><div class="form-row">
        <label for="node-input-command"><i class="fa fa-file"></i> Command</label>
        <input type="text" id="node-input-command" placeholder="command">
    </div>
    <div class="form-row">
        <label><i class="fa fa-plus"></i> Append</label>
        <input type="checkbox" id="node-input-addpay" style="display: inline-block; width: auto; vertical-align: top;">
        &nbsp;msg.payload
    </div>
    <div class="form-row">
        <label for="node-input-append"> </label>
        <input type="text" id="node-input-append" placeholder="extra input parameters">
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-useSpawn" placeholder="spawn" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-useSpawn" style="width: 70%;">Use spawn() instead of exec() ?</label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips" id="spawnTip">Tip: <i>spawn</i> expects only one command word - and appended args to be comma separated.</div></script><script type="text/javascript">RED.nodes.registerType('exec',{
        category: 'advanced-function',
        color:"darksalmon",
        defaults: {
            command: {value:"",required:true},
            addpay: {value:true},
            append: {value:""},
            useSpawn: {value:""},
            name: {value:""}
        },
        inputs:1,
        outputs:3,
        icon: "arrow-in.png",
        align: "right",
        label: function() {
            return this.name||this.command;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            $("#node-input-useSpawn").on("change",function() {
                if ($("#node-input-useSpawn").is(':checked')) {
                    $("#spawnTip").show();
                } else {
                    $("#spawnTip").hide();
                }
            });
        }
    });</script><script type="text/x-red" data-help-name="exec"><p>Calls out to a system command.<br/></p>
    <p>Provides 3 outputs... stdout, stderr, and return code.</p>
    <p>By default uses exec() which calls the command, blocks while waiting for completion, and then returns the complete result in one go, along with any errors.</p>
    <p>Optionally can use spawn() instead, which returns output from stdout and stderr as the command runs (ie one line at a time). On completion it then returns a return code (on the 3rd output).</p>
    <p>Spawn only expects one command word, with all extra parameters to be comma separated and passed as the append.</p>
    <p>The optional append gets added to the command after the <b>msg.payload</b> - so you can do things like pipe the result to another command.</p>
    <p>If stdout is binary a <i>buffer</i> is returned - otherwise returns a <i>string</i>.</p></script><script type="text/x-red" data-template-name="function"><div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row" style="margin-bottom: 0px;">
        <label for="node-input-func"><i class="fa fa-wrench"></i> Function</label>
        <input type="hidden" id="node-input-func" autofocus="autofocus">
        <input type="hidden" id="node-input-noerr">
    </div>
    <div class="form-row node-text-editor-row">
        <div style="height: 250px;" class="node-text-editor" id="node-input-func-editor" ></div>
    </div>
    <div class="form-row">
        <label for="node-input-outputs"><i class="fa fa-random"></i> Outputs</label>
        <input id="node-input-outputs" style="width: 60px; height: 1.7em;" value="1">
    </div>
    <div class="form-tips">See the Info tab for help writing functions.</div></script><script type="text/javascript">RED.nodes.registerType('function',{
        color:"#fdd0a2",
        category: 'function',
        defaults: {
            name: {value:""},
            func: {value:"\nreturn msg;"},
            outputs: {value:1},
            noerr: {value:0,required:true,validate:function(v){ return ((!v) || (v === 0)) ? true : false; }}
        },
        inputs:1,
        outputs:1,
        icon: "function.png",
        label: function() {
            return this.name;
        },
        oneditprepare: function() {
            var that = this;
            $( "#node-input-outputs" ).spinner({
                min:1
            });
            function functionDialogResize() {
                var rows = $("#dialog-form>div:not(.node-text-editor-row)");
                var height = $("#dialog-form").height();
                for (var i=0;i<rows.size();i++) {
                    height -= $(rows[i]).outerHeight(true);
                }
                var editorRow = $("#dialog-form>div.node-text-editor-row");
                height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
                $(".node-text-editor").css("height",height+"px");
                that.editor.resize();
            }
            $( "#dialog" ).on("dialogresize", functionDialogResize);
            $( "#dialog" ).one("dialogopen", function(ev) {
                var size = $( "#dialog" ).dialog('option','sizeCache-function');
                if (size) {
                    $("#dialog").dialog('option','width',size.width);
                    $("#dialog").dialog('option','height',size.height);
                    functionDialogResize();
                }
            });
            $( "#dialog" ).one("dialogclose", function(ev,ui) {
                var height = $( "#dialog" ).dialog('option','height');
                $( "#dialog" ).off("dialogresize",functionDialogResize);
            });
            this.editor = RED.editor.createEditor({
                id: 'node-input-func-editor',
                mode: 'ace/mode/javascript',
                value: $("#node-input-func").val()
            });
            RED.library.create({
                url:"functions", // where to get the data from
                type:"function", // the type of object the library is for
                editor:this.editor, // the field name the main text body goes to
                mode:"ace/mode/javascript",
                fields:['name','outputs']
            });
            this.editor.focus();
        },
        oneditsave: function() {
            var annot = this.editor.getSession().getAnnotations();
            this.noerr = 0;
            $("#node-input-noerr").val(0);
            for (var k=0; k < annot.length; k++) {
                if (annot[k].type === "error") {
                    $("#node-input-noerr").val(annot.length);
                    this.noerr = annot.length;
                }
            }
            $("#node-input-func").val(this.editor.getValue());
            delete this.editor;
        }
    });</script><script type="text/x-red" data-help-name="function"><p>A function block where you can write code to do more interesting things.</p>
    <p>The message is passed in as a JavaScript object called <code>msg</code>.</p>
    <p>By convention it will have a <code>msg.payload</code> property containing
       the body of the message.</p>
    <h4>Logging and Error Handling</h4>
    <p>To log any information, or report an error, the following functions are available:</p>
        <ul>
            <li><code>node.log("Log")</code></li>
            <li><code>node.warn("Warning")</code></li>
            <li><code>node.error("Error")</code></li>
        </ul>
    </p>
    <p>The Catch node can also be used to handle errors. To invoke a Catch node,
    pass <code>msg</code> as a second argument to <code>node.error</code>:</p>
    <pre>node.error("Error",msg)</pre>
    <h4>Sending messages</h4>
    <p>The function can either return the messages it wants to pass on to the next nodes
    in the flow, or can call <code>node.send(messages)</code>.</p>
    <p>It can return/send:</p>
    <ul>
      <li>a single message object - passed to nodes connected to the first output</li>
      <li>an array of message objects - passed to nodes connected to the corresponding outputs</li>
    </ul>
    <p>If any element of the array is itself an array of messages, multiple
          messages are sent to the corresponding output.</p>
    <p>If null is returned, either by itself or as an element of the array, no
          message is passed on.</p>
    <p>See the <a target="_new" href="http://nodered.org/docs/writing-functions.html">online documentation</a> for more help.</p></script><script type="text/x-red" data-template-name="template"><div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-template"><i class="fa fa-file-code-o"></i> Template</label>
        <input type="hidden" id="node-input-template" autofocus="autofocus">
        <div style="height: 250px;" class="node-text-editor" id="node-input-template-editor" ></div>
    </div>
    <div class="form-row">
        <label for="node-input-field"><i class="fa fa-edit"></i> Property</label>
        msg.<input type="text" id="node-input-field" placeholder="payload" style="width: 64%;">
    </div></script><script type="text/javascript">RED.nodes.registerType('template',{
        color:"rgb(243, 181, 103)",
        category: 'function',
        defaults: {
            name: {value:""},
            field: {value:"payload"},
            template: {value:"This is the payload: {{payload}}!"},
        },
        inputs:1,
        outputs:1,
        icon: "template.png",
        label: function() {
            return this.name;
        },
        oneditprepare: function() {

            function templateDialogResize(ev,ui) {
                $("#node-input-template-editor").css("height",(ui.size.height-200)+"px");
            };

            $( "#dialog" ).on("dialogresize", templateDialogResize);
            $( "#dialog" ).one("dialogopen", function(ev) {
                var size = $( "#dialog" ).dialog('option','sizeCache-template');
                if (size) {
                    templateDialogResize(null,{size:size});
                }
            });
            $( "#dialog" ).one("dialogclose", function(ev,ui) {
                var height = $( "#dialog" ).dialog('option','height');
                $( "#dialog" ).off("dialogresize",templateDialogResize);
            });

            var that = this;
            require(["orion/editor/edit"], function(edit) {
                that.editor = edit({
                    parent:document.getElementById('node-input-template-editor'),
                    lang:"html",
                    contents: $("#node-input-template").val()
                });
                RED.library.create({
                    url:"templates", // where to get the data from
                    type:"template", // the type of object the library is for
                    editor:that.editor, // the field name the main text body goes to
                    fields:['name','field']
                });
                $("#node-input-name").focus();
            });
        },
        oneditsave: function() {
            $("#node-input-template").val(this.editor.getText())
            delete this.editor;
        }
    });</script><script type="text/x-red" data-help-name="template"><p>Creates a new message based on the provided template.</p>
    <p>This uses the <i><a href="http://mustache.github.io/mustache.5.html" target="_new">mustache</a></i> format.</p>
    <p>For example, when a template of:
    <pre>Hello {{name}}. Today is {{date}}</pre>
    <p>receives a message containing:
    <pre>{
  name: "Fred",
  date: "Monday"
  payload: ...
}</pre>
    <p>The resulting payload will be:
    <pre>Hello Fred. Today is Monday</pre></script><script type="text/x-red" data-template-name="delay"><div class="form-row">
        <label for="node-input-pauseType"><i class="fa fa-tasks"></i> Action</label>
        <select id="node-input-pauseType" style="width:270px !important">
          <option value="delay">Delay message</option>
          <option value="random">Random delay</option>
          <option value="rate">Limit rate to</option>
          <option value="queue">Topic based fair queue</option>
        </select>
    </div>
    <div id="delay-details" class="form-row">
        <label for="node-input-timeout"><i class="fa fa-clock-o"></i> For</label>
        <input type="text" id="node-input-timeout" placeholder="Time" style="direction:rtl; width:50px !important">
        <select id="node-input-timeoutUnits" style="width:200px !important">
          <option value="milliseconds">Milliseconds</option>
          <option value="seconds">Seconds</option>
          <option value="minutes">Minutes</option>
          <option value="hours">Hours</option>
          <option value="days">Days</option>
        </select>
    </div>

    <div id="rate-details" class="form-row">
        <label for="node-input-rate"><i class="fa fa-clock-o"></i> Rate</label>
        <input type="text" id="node-input-rate" placeholder="1" style="direction:rtl; width:30px !important">
        <label for="node-input-rateUnits">msg(s) per</label>
        <select id="node-input-rateUnits" style="width:140px !important">
          <option value="second">Second</option>
          <option value="minute">Minute</option>
          <option value="hour">Hour</option>
          <option value="day">Day</option>
        </select>
        <br/>
        <div id="node-input-dr"><input style="margin: 20px 0 20px 100px; width: 30px;" type="checkbox" id="node-input-drop"><label style="width: 250px;" for="node-input-drop">drop intermediate messages</label></div>
    </div>


    <div id="random-details" class="form-row">
        <label for="node-input-randomFirst"><i class="fa fa-clock-o"></i> Between</label>
        <input type="text" id="node-input-randomFirst" placeholder="" style="directon:rtl; width:30px !important">
        <label for="node-input-randomLast" style="width:20px"> &amp; </label>
        <input type="text" id="node-input-randomLast" placeholder="" style="directon:rtl; width:30px !important">
        <select id="node-input-randomUnits" style="width:140px !important">
          <option value="milliseconds">Milliseconds</option>
          <option value="seconds">Seconds</option>
          <option value="minutes">Minutes</option>
          <option value="hours">Hours</option>
          <option value="days">Days</option>
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('delay',{
        category: 'function',      // the palette category
        color:"#E6E0F8",
        defaults: {             // defines the editable properties of the node
            name: {value:""},   //  along with default values.
            pauseType: {value:"delay", required:true},
            timeout: {value:"5", required:true, validate:RED.validators.number()},
            timeoutUnits: {value:"seconds"},
            rate: {value:"1", required:true, validate:RED.validators.number()},
            rateUnits: {value: "second"},
            randomFirst: {value:"1", required:true, validate:RED.validators.number()},
            randomLast: {value:"5", required:true, validate:RED.validators.number()},
            randomUnits: {value: "seconds"},
            drop: {value:false}
        },
        inputs:1,                // set the number of inputs - only 0 or 1
        outputs:1,               // set the number of outputs - 0 to n
        icon: "timer.png",    // set the icon (held in public/icons)
        label: function() {      // sets the default label contents
            if (this.pauseType == "delay") {
              var units = this.timeoutUnits ? this.timeoutUnits.charAt(0) : "s";
              if (this.timeoutUnits == "milliseconds") { units = "ms"; }
              return this.name||"delay "+this.timeout+" " + units;
            } else if (this.pauseType == "rate") {
              var units = this.rateUnits ? this.rateUnits.charAt(0) : "s";
              return this.name||"limit "+this.rate+" msg/"+ units;
            } else if (this.pauseType == "random") {
              return this.name || "random";
            }
            else {
                var units = this.rateUnits ? this.rateUnits.charAt(0) : "s";
                return this.name || "queue" +this.rate+" msg/"+ units;
            }
        },
        labelStyle: function() { // sets the class to apply to the label
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
          $( "#node-input-timeout" ).spinner({min:1,max:60});
          $( "#node-input-rate" ).spinner({min:1});
          $( "#node-input-randomFirst" ).spinner({min:0});
          $( "#node-input-randomLast" ).spinner({min:1});
          if (this.pauseType == "delay") {
            $("#delay-details").show();
            $("#rate-details").hide();
            $("#random-details").hide();
            $("#node-input-dr").hide();
          } else if (this.pauseType == "rate") {
            $("#delay-details").hide();
            $("#rate-details").show();
            $("#random-details").hide();
            $("#node-input-dr").show();
          } else if (this.pauseType == "random") {
            $("#delay-details").hide();
            $("#rate-details").hide();
            $("#random-details").show();
            $("#node-input-dr").hide();
          } else if (this.pauseType == "queue") {
            $("#delay-details").hide();
            $("#rate-details").show();
            $("#random-details").hide();
            $("#node-input-dr").hide();
          }
          if (!this.timeoutUnits) {
            $("#node-input-timeoutUnits option").filter(function() {
              return $(this).val() == 'seconds';
            }).attr('selected', true);
          }
          if (!this.randomUnits) {
            $("#node-input-randomUnits option").filter(function() {
               return $(this).val() == 'seconds';
            }).attr('selected', true);
          }
          $("#node-input-pauseType").on("change",function() {
            if (this.value == "delay") {
              $("#delay-details").show();
              $("#rate-details").hide();
              $("#random-details").hide();
              $("#node-input-dr").hide();
            } else if (this.value == "rate") {
              $("#delay-details").hide();
              $("#rate-details").show();
              $("#random-details").hide();
              $("#node-input-dr").show();
              } else if (this.value == "random") {
              $("#delay-details").hide();
              $("#rate-details").hide();
              $("#random-details").show();
              $("#node-input-dr").hide();
            } else if (this.value == "queue") {
              $("#delay-details").hide();
              $("#rate-details").show();
              $("#random-details").hide();
              $("#node-input-dr").hide();
            }
          });
        }
    });</script><script type="text/x-red" data-help-name="delay"><p>Introduces a delay into a flow or rate limits messages.</p>
    <p>Default delay is 5 seconds and rate limit of 1 msg/second, but both can be configured.</p>
    <p>If you select a rate limit you may optionally discard any intermediate messages that arrive.</p>
    <p>The "topic based fair queue" adds messages to a release queue tagged by their <b>msg.topic</b> property.
    At each "tick", derived from the rate, the next "topic" is released.
    Any messages arriving on the same topic before release replace those in that position in the queue.
    So each "topic" gets a turn - but the most recent value is always the one sent.</p></script><script type="text/x-red" data-template-name="trigger"><div class="form-row">
        Send
        <select id="node-input-op1type" style="width:200px !important">
            <option value="val">the string payload</option>
            <option value="pay">the existing message</option>
            <option value="nul">nothing</option>
        </select>
        <input style="width: 180px !important" type="text" id="node-input-op1">
    </div>
    <div class="form-row">
        then
        <select id="node-then-type" style="width:150px;">
            <option value="block">wait to be reset</option>
            <option value="wait">wait for</option>
        </select>
        <span class="node-type-wait">
            <input type="text" id="node-input-duration" style="width:70px !important">
            <select id="node-input-units" style="width:140px !important">
                <option value="ms">Milliseconds</option>
                <option value="s">Seconds</option>
                <option value="min">Minutes</option>
                <option value="hr">Hours</option>
            </select>
       </span>
    </div>
    <div class="form-row node-type-wait">
        then send
        <select id="node-input-op2type" style="width:200px !important">
            <option value="val">the string payload</option>
            <option value="pay">the existing message</option>
            <option value="nul">nothing</option>
        </select>
        <input style="width: 145px !important" type="text" id="node-input-op2">
    </div>
    <div class="form-row node-type-wait">
        <input type="checkbox" id="node-input-extend" style="margin-left: 5px; vertical-align: top; width: auto !important;"> <label style="width:auto !important;" for="node-input-extend">extend delay if new message arrives</label>
    </div>
    <br/>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="name">
    </div>
    <div class="form-tips">The node can be reset by sending a message with the <b>msg.reset</b> property set</div></script><script type="text/javascript">RED.nodes.registerType('trigger',{
        category: 'function',
        color:"#E6E0F8",
        defaults: {
            op1: {value:"1"},
            op2: {value:"0"},
            op1type: {value:"val"},
            op2type: {value:"val"},
            duration: {value:"250",required:true,validate:RED.validators.number()},
            extend: {value:"false"},
            units: {value: "ms"},
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "trigger.png",
        label: function() {
            if (this.duration > 0) {
                return this.name|| "trigger"+" "+this.duration+this.units;
            }
            else {
                return this.name|| "trigger & block";
            }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            $("#node-then-type").change(function() {
                if ($(this).val() == "block") {
                    $(".node-type-wait").hide();
                    $(".form-tips").show();
                } else {
                    $(".node-type-wait").show();
                    $(".form-tips").hide();
                }
            });
            $("#node-input-op1type").change(function() {
                if ($(this).val() == "val") {
                    $("#node-input-op1").show();
                } else {
                    $("#node-input-op1").hide();
                }
            });
            $("#node-input-op2type").change(function() {
                if ($(this).val() == "val") {
                    $("#node-input-op2").show();
                } else {
                    $("#node-input-op2").hide();
                }
            });
            if (this.duration == "0") {
                $("#node-then-type").val("block");
            } else {
                $("#node-then-type").val("wait");
            }
            $("#node-then-type").change();
            $("#node-input-op1type").change();
            $("#node-input-op2type").change();
            
            if (this.extend === "true" || this.extend === true) {
                $("#node-input-extend").prop("checked",true);
            } else {
                $("#node-input-extend").prop("checked",false);
            }
            
        },
        oneditsave: function() {
            if ($("#node-then-type").val() == "block") {
                $("#node-input-duration").val("0");
            }
        
        }
    });</script><script type="text/x-red" data-help-name="trigger"><p>Creates two messages on the output separated by a timeout whenever ANY <b>msg</b> arrives on the input.</p>
    <p>For example, this can be used to toggle a Raspberry PI GPIO pin on and off.</p>
    <p>The two output states can be specified as can the duration of the timer.
    Either output can be set to a value, or templated from the inbound
    <b>msg</b> using mustache syntax. <pre>The payload is {{payload}}</pre></p>
    <p>If the payload is an object then setting the output to <i>existing payload</i> will pass the complete payload object through.</p>
    <p>Optionally the timer can be extended by being retriggered... or not.</p>
    <p>By setting the first output to <i>nothing</i>, and selecting extend timer - a watchdog timer can be created.
    No output will happen as long as repeated inputs occur within the timeout period.</p>
    <p>Setting the timer to 0 creates an "infinite" timeout - the first output will happen but the second
    never will, and neither can the first be retriggered - so a true one shot.</p>
    <p>If a <b>msg.reset</b> property is present any timeout currently in progress
    will be cleared and the second output will not happen.</p></script><script type="text/x-red" data-template-name="comment"><div class="form-row">
        <label for="node-input-name"><i class="fa fa-comment"></i> Comment</label>
        <input type="text" id="node-input-name" placeholder="Comment">
    </div>
    <div class="form-row">
        <label for="node-input-info" style="width: 100% !important;"><i class="fa fa-comments"></i> More</label>
        <input type="hidden" id="node-input-info" autofocus="autofocus">
        <div style="height: 250px;" class="node-text-editor" id="node-input-info-editor" ></div>
    </div>
    <div class="form-tips">Tip: this isn't meant for "War and Peace" - but useful notes can be kept here.</div></script><script type="text/javascript">RED.nodes.registerType('comment',{
        category: 'function',
        color:"#ffffff",
        defaults: {
            name: {value:""},
            info: {value:""}
        },
        inputs:0,
        outputs:0,
        icon: "comment.png",
        label: function() {
            return this.name||"";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            $( "#node-input-outputs" ).spinner({
                min:1
            });
            function functionDialogResize(ev,ui) {
                $("#node-input-info-editor").css("height",(ui.size.height-235)+"px");
            };
            $( "#dialog" ).on("dialogresize", functionDialogResize);
            $( "#dialog" ).one("dialogopen", function(ev) {
                var size = $( "#dialog" ).dialog('option','sizeCache-function');
                if (size) {
                    functionDialogResize(null,{size:size});
                }
            });
            $( "#dialog" ).one("dialogclose", function(ev,ui) {
                var height = $( "#dialog" ).dialog('option','height');
                $( "#dialog" ).off("dialogresize",functionDialogResize);
            });
            var that = this;
            require(["orion/editor/edit"], function(edit) {
                that.editor = edit({
                    parent:document.getElementById('node-input-info-editor'),
                    lang:"text",
                    showLinesRuler:false,
                    showFoldingRuler:false,
                    contents: $("#node-input-info").val()
                });
                $("#node-input-name").focus();
            });
        },
        oneditsave: function() {
            $("#node-input-info").val(this.editor.getText());
            delete this.editor;
        }
    });</script><script type="text/x-red" data-help-name="comment"><p>Simple comment block.</p></script><script type="text/x-red" data-template-name="unknown"><div class="form-tips"><p>This node is a type unknown to your installation of Node-RED.</p>
    <p><i>If you deploy with the node in this state, it will lose all of its configuration.</i></p>
    <p>See the Info side bar for more help</p></div></script><script type="text/javascript">RED.nodes.registerType('unknown',{
        category: 'unknown',
        color:"#fff0f0",
        defaults: {
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "",
        label: function() {
            return "("+this.name+")"||"unknown";
        },
        labelStyle: function() {
            return "node_label_unknown";
        }
    });</script><script type="text/x-red" data-help-name="unknown"><p>This node is a type unknown to your installation of Node-RED.</p>
    <p><i>If you deploy with the node in this state, it will lose all of its configuration.</i></p>
    <p>It is possible this node type is already installed, but is missing a dependency. Check the Node-RED start-up log for
       any error messages associated with the missing node type. Use <b>npm install &lt;module&gt;</b> to install any missing modules
       and restart Node-RED and reimport the nodes.</p>
    <p>Otherwise, you should contact the author of the flow to obtain a copy of the missing node type.</p></script><script type="text/x-red" data-template-name="PID control"><div class="form-row">
        <label for="node-input-target" style="width:120px;"><i class="fa fa-dot-circle-o"></i> Set Point</label>
        <input type="text" id="node-input-target" placeholder="target value" style="width:60%;">
    </div>
    <div class="form-row">
        <label for="node-input-kp" style="width:120px;"><font size=+1>K<sub>proportional</sub></font></label>
        <input type="text" id="node-input-kp" placeholder="proportional gain constant - Kp" style="width:60%;">
    </div>
    <div class="form-row">
        <label for="node-input-ki" style="width:120px;"><font size=+1>K<sub>integral</sub></font></label>
        <input type="text" id="node-input-ki" placeholder="integral gain constant - Ki" style="width:60%;">
    </div>
    <div class="form-row">
        <label for="node-input-kd" style="width:120px;"><font size=+1>K<sub>differential</sub></font></label>
        <input type="text" id="node-input-kd" placeholder="differential gain constant - Kd" style="width:60%;">
    </div>
    <div class="form-row">
        <label for="node-input-name" style="width:120px;"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name" style="width:60%;">
    </div>
    <div class="form-tips"><b>Tip:</b> This node ONLY works on numbers<br>
    The damping factors are typically in the range 0 - 1.<br></div></script><script type="text/javascript">RED.nodes.registerType('PID control',{
        color:"#d6ba48",
        category: 'function',
        defaults: {
            name: {value:""},
            target: {value:"",validate:RED.validators.regex(/^(\d*|)$/)},
            kp: {value:"",required:true,validate:RED.validators.number()},
            ki: {value:"",required:true,validate:RED.validators.number()},
            kd: {value:"",required:true,validate:RED.validators.number()}
        },
        inputs:1,
        outputs:1,
        icon: "function.png",
        label: function() {
            return this.name||"PID";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-help-name="PID control"><p>A PID controller node.</p>
    <p>This node ONLY expects a numeric <b>msg.payload</b> containing the current reading.
    It will output the correction that needs to be applied in order to move to the preset <i>set point</i> value.</p>
    <p>See <a href="https://en.wikipedia.org/wiki/PID_controller" target="_new">Wikipedia</a> for more details.</p>
    <p>The <i>set point</i> may be overridden by <b>msg.setpoint</b>. If you do so the edit box value can be used as the initial value.</p></script><script type="text/x-red" data-template-name="random"><div class="form-row">
        <label for="node-input-inte"><i class="fa fa-random"></i> Generate</label>
        <select type="text" id="node-input-inte" style="width: 300px;">
            <option value="true">a whole number - integer</option>
            <option value="false">a real number - floating point</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-low"><i class="fa fa-arrow-down"></i> From</label>
        <input type="text" id="node-input-low" placeholder="lowest number"  style="width: 300px;">
    </div>
    <div class="form-row">
        <label for="node-input-high"><i class="fa fa-arrow-up"></i> To</label>
        <input type="text" id="node-input-high" placeholder="highest number"  style="width: 300px;">
    </div>
    <br/>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name" style="width: 300px;">
    </div></script><script type="text/javascript">RED.nodes.registerType('random',{
        category: 'function',
        color:"#E2D96E",
        defaults: {
            name: {value:""},
            low: {value:"1"},
            high: {value:"6"},
            inte: {value:"true"}
        },
        inputs:1,
        outputs:1,
        icon: "debug.png",
        label: function() {
            return this.name||"random";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-help-name="random"><p>Generates a random number between a low and high value.</p>
    <p>If you return an integer it can <i>include</i> both the low and high values.</p>
    <p>If you return a floating point value it will be <i>between</i> the low and high values.</p></script><script type="text/x-red" data-template-name="rbe"><div class="form-row">
        <label for="node-input-func"><i class="fa fa-wrench"></i> Mode</label>
        <select type="text" id="node-input-func" style="width:74%;">
            <option value="rbe">RBE - report if value changed</option>
            <option value="deadband">Deadband - report if changed more than</option>
        </select>
    </div>
    <div class="form-row" id="node-bandgap">
        <label for="node-input-gap"><i class="fa fa-random"></i> Band gap</label>
        <input type="text" id="node-input-gap" placeholder="e.g. 10 or 5%" style="width:71%;">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"/> Name</label>
        <input type="text" id="node-input-name" placeholder="Name" style="width:71%;">
    </div></script><script type="text/javascript">RED.nodes.registerType('rbe',{
        color:"#E2D96E",
        category: 'function',
        defaults: {
            name: {value:""},
            func: {value:"rbe"},
            gap: {value:"",validate:RED.validators.regex(/^(\d*|)(%|)$/)}
        },
        inputs:1,
        outputs:1,
        icon: "function.png",
        label: function() {
            return this.name||this.func||"rbe";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            $("#node-input-func").on("change",function() {
                if ($("#node-input-func").val() === "rbe") {
                    $("#node-bandgap").hide();
                } else {
                    $("#node-bandgap").show();
                }
            });
        }
    });</script><script type="text/x-red" data-help-name="rbe"><p>Report by Exception node - only passes on data if it has changed.</p>
    <p>In <b>RBE</b> mode this node only outputs the msg if the <b>msg.payload</b> is
    different to the previous one. Works on numbers and strings.</p>
    <p>In <b>deadband</b> mode the incoming payload should contain a parseable <i>number</i> and is
    output only if greater than + or - the <i>band gap</i> away from the previous output.</p>
    <p>Deadband also supports % - only sends if the input differs by more than x% of the original value.</p>
    <p><b>Note:</b> This works on a per <b>msg.topic</b> basis. This means that a single rbe node can
handle multiple topics at the same time.</p></script><script type="text/x-red" data-template-name="arduino in"><div class="form-row">
        <label for="node-input-arduino"><i class="fa fa-tasks"></i> Arduino</label>
        <input type="text" id="node-input-arduino">
    </div>
    <div class="form-row">
        <label for="node-input-pin"><i class="fa fa-circle"></i> Pin</label>
        <input type="text" id="node-input-pin" placeholder="2">
    </div>
    <div class="form-row">
        <label for="node-input-state"><i class="fa fa-wrench"></i> Type</label>
        <select type="text" id="node-input-state" style="width: 150px;">
            <option value="INPUT">Digital pin</option>
            <option value="ANALOG">Analogue pin</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips"><b>Note:</b> You cannot use the same pin for both output and input.</div></script><script type="text/javascript">RED.nodes.registerType('arduino in',{
        category: 'Arduino',
        color:"#3fadb5",
        defaults: {
            name: {value:""},
            pin: {value:"",required:true},
            state: {value:"INPUT",required:true},
            arduino: {type:"arduino-board"}
        },
        inputs:0,
        outputs:1,
        icon: "arduino.png",
        label: function() {
            var a = "";
            if (this.state == "ANALOG") a = "A";
            return this.name||"Pin: "+a+this.pin;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-template-name="arduino out"><div class="form-row">
        <label for="node-input-arduino"><i class="fa fa-tasks"></i> Arduino</label>
        <input type="text" id="node-input-arduino">
    </div>
    <div class="form-row">
        <label for="node-input-pin"><i class="fa fa-circle"></i> Pin</label>
        <input type="text" id="node-input-pin" placeholder="13">
    </div>
    <div class="form-row">
        <label for="node-input-state"><i class="fa fa-wrench"></i> Type</label>
        <select type="text" id="node-input-state" style="width: 200px;">
            <option value="OUTPUT">Digital (0/1)</option>
            <option value="PWM">Analogue (0-255)</option>
            <option value="SERVO">Servo (0-180)</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips"><b>Note:</b> You cannot use the same pin for both output and input.</div></script><script type="text/javascript">RED.nodes.registerType('arduino out',{
        category: 'Arduino',
        color:"#3fadb5",
        defaults: {
            name: {value:""},
            pin: {value:"",required:true},
            state: {value:"",required:true},
            arduino: {type:"arduino-board"}
        },
        inputs:1,
        outputs:0,
        icon: "arduino.png",
        align: "right",
        label: function() {
            return this.name||"Pin: "+this.pin;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-template-name="arduino-board"><div class="form-row">
        <label for="node-config-input-device"><i class="fa fa-random"></i> Port</label>
        <input type="text" id="node-config-input-device" style="width:60%;" placeholder="e.g. /dev/ttyUSB0  COM1"/>
        <a id="node-config-lookup-serial" class="btn"><i id="node-config-lookup-serial-icon" class="fa fa-search"></i></a>
    </div>
    <div class="form-tips"><b>Tip:</b> Use search to try to auto-detect serial port.</div></script><script type="text/javascript">RED.nodes.registerType('arduino-board',{
        category: 'config',
        defaults: {
            device: {value:"",required:true}
        },
        label: function() {
            return this.device||"arduino";
        },
        oneditprepare: function() {
            try {
                $("#node-config-input-device").autocomplete( "destroy" );
            } catch(err) { }
            $("#node-config-lookup-serial").click(function() {
                $("#node-config-lookup-serial-icon").removeClass('fa-search');
                $("#node-config-lookup-serial-icon").addClass('spinner');
                $("#node-config-lookup-serial").addClass('disabled');

                $.getJSON('arduinoports',function(data) {
                    $("#node-config-lookup-serial-icon").addClass('fa-search');
                    $("#node-config-lookup-serial-icon").removeClass('spinner');
                    $("#node-config-lookup-serial").removeClass('disabled');
                    var ports = [];
                    $.each(data, function(i, port){
                        ports.push(port);
                    });
                    $("#node-config-input-device").autocomplete({
                        source:ports,
                        minLength:0,
                        close: function( event, ui ) {
                            $("#node-config-input-device").autocomplete( "destroy" );
                        }
                    }).autocomplete("search","");
                });
            });
        }
    });</script><script type="text/x-red" data-help-name="arduino in"><p>Arduino input node. Connects to local Arduino and monitors the selected pin for changes. Uses <a href="http://firmata.org/" target="_new"><i>Firmata</i>.</a></p>
    <p>The Arduino must be loaded with the Standard Firmata sketch available in the Arduino examples.</p>
    <p>You can select either Digital or Analogue input. Outputs the value read as <b>msg.payload</b> and the pin number as <b>msg.topic</b>.</p>
    <p>It only outputs on a change of value - fine for digital inputs, but you can get a lot of data from analogue pins which you must then handle.</p>
    <p>You can set the sample rate in ms from 20 to 65535.</p></script><script type="text/x-red" data-help-name="arduino out"><p>Arduino output node. Connects to local Arduino and writes to the selected digital pin. Uses <a href="http://firmata.org/" target="_new"><i>Firmata</i>.</a></p>
    <p>The Arduino must be loaded with the Standard Firmata sketch available in the Arduino examples.</p>
    <p>You can select Digital, Analogue (PWM) or Servo type outputs. Expects a numeric value in <b>msg.payload</b>. The pin number is set in the properties panel.</p></script><script type="text/x-red" data-template-name="tls-config"><div class="form-row">
        <label style="width: 120px;" for="node-config-input-cert"><i class="fa fa-file-text-o"></i> <span data-i18n="tls.label.cert"></span></label>
        <input style="width: 60%;" type="text" id="node-config-input-cert" data-i18n="[placeholder]tls.placeholder.cert">
    </div>
    <div class="form-row">
        <label style="width: 120px;" for="node-config-input-key"><i class="fa fa-file-text-o"></i> <span data-i18n="tls.label.key"></span></label>
        <input style="width: 60%;" type="text" id="node-config-input-key" data-i18n="[placeholder]tls.placeholder.key">
    </div>
    <div class="form-row">
        <label style="width: 120px;" for="node-config-input-ca"><i class="fa fa-file-text-o"></i> <span data-i18n="tls.label.ca"></span></label>
        <input style="width: 60%;" type="text" id="node-config-input-ca" data-i18n="[placeholder]tls.placeholder.ca">
    </div>
    <div class="form-row">
        <input type="checkbox" id="node-config-input-verifyservercert" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-config-input-verifyservercert" style="width: 70%;" data-i18n="tls.label.verify-server-cert"></label>
    </div>
    <div class="form-row">
        <label style="width: 120px;" for="node-config-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input style="width: 60%;" type="text" id="node-config-input-name" data-i18n="[placeholder]common.label.name">
    </div></script><script type="text/javascript">RED.nodes.registerType('tls-config',{
        category: 'config',
        defaults: {
            name: {value:""},
            cert: {value:"", validate: function(v) {
                var currentKey = $("#node-config-input-key").val();
                if (currentKey === undefined) {
                    currentKey = this.key;
                }
                return currentKey === '' || v != '';
            }},
            key: {value:"", validate: function(v) {
                var currentCert = $("#node-config-input-cert").val();
                if (currentCert === undefined) {
                    currentCert = this.cert;
                }
                return currentCert === '' || v != '';
            }},
            ca: {value:""},
            verifyservercert: {value: true}
        },
        label: function() {
            return this.name || this._("tls.tls");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-help-name="tls-config"><p>Configuration options for TLS connections.</p></script><script type="text/x-red" data-template-name="mqtt in"><div class="form-row">
        <label for="node-input-broker"><i class="fa fa-globe"></i> <span data-i18n="mqtt.label.broker"></span></label>
        <input type="text" id="node-input-broker">
    </div>
    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
        <input type="text" id="node-input-topic" data-i18n="[placeholder]common.label.topic">
    </div>
    <div class="form-row">
        <label for="node-input-qos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
        <select id="node-input-qos" style="width:125px !important">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div></script><script type="text/javascript">RED.nodes.registerType('mqtt in',{
        category: 'input',
        defaults: {
            name: {value:""},
            topic: {value:"",required:true,validate: RED.validators.regex(/^(#$|(\+|[^+#]*)(\/(\+|[^+#]*))*(\/(\+|#|[^+#]*))?$)/)},
            qos: {value: "2"},
            broker: {type:"mqtt-broker", required:true}
        },
        color:"#d8bfd8",
        inputs:0,
        outputs:1,
        icon: "bridge.png",
        label: function() {
            return this.name||this.topic||"mqtt";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            if (this.qos === undefined) {
                $("#node-input-qos").val("2");
            }
        }
    });</script><script type="text/x-red" data-template-name="mqtt out"><div class="form-row">
        <label for="node-input-broker"><i class="fa fa-globe"></i> <span data-i18n="mqtt.label.broker"></span></label>
        <input type="text" id="node-input-broker">
    </div>
    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
        <input type="text" id="node-input-topic" data-i18n="[placeholder]common.label.topic">
    </div>
    <div class="form-row">
        <label for="node-input-qos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
        <select id="node-input-qos" style="width:125px !important">
            <option value=""></option>
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
        </select>
        &nbsp;&nbsp;<i class="fa fa-history"></i>&nbsp;<span data-i18n="mqtt.retain"></span> &nbsp;<select id="node-input-retain" style="width:125px !important">
            <option value=""></option>
            <option value="false" data-i18n="mqtt.false"></option>
            <option value="true" data-i18n="mqtt.true"></option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]common.label.name">
    </div>
    <div class="form-tips"><span data-i18n="mqtt.tip"></span></div></script><script type="text/javascript">RED.nodes.registerType('mqtt out',{
        category: 'output',
        defaults: {
            name: {value:""},
            topic: {value:""},
            qos: {value:""},
            retain: {value:""},
            broker: {type:"mqtt-broker", required:true}
        },
        color:"#d8bfd8",
        inputs:1,
        outputs:0,
        icon: "bridge.png",
        align: "right",
        label: function() {
            return this.name||this.topic||"mqtt";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-template-name="mqtt-broker"><div class="form-row">
        <ul style="background: #fff; min-width: 600px; margin-bottom: 20px;" id="node-config-mqtt-broker-tabs"></ul>
    </div>
    <div id="node-config-mqtt-broker-tabs-content" style="min-height: 170px;">
        <div id="mqtt-broker-tab-connection" style="display:none">
            <div class="form-row node-input-broker">
                <label for="node-config-input-broker"><i class="fa fa-globe"></i> <span data-i18n="mqtt.label.broker"></span></label>
                <input class="input-append-left" type="text" id="node-config-input-broker" placeholder="localhost" style="width: 40%;" >
                <label for="node-config-input-port" style="margin-left: 10px; width: 35px; "> <span data-i18n="mqtt.label.port"></span></label>
                <input type="text" id="node-config-input-port" data-i18n="[placeholder]mqtt.label.port" style="width:45px">
            </div>
            <div class="form-row">
                <input type="checkbox" id="node-config-input-usetls" style="display: inline-block; width: auto; vertical-align: top;">
                <label for="node-config-input-usetls" style="width: auto" data-i18n="mqtt.label.use-tls"></label>
                <div id="node-config-row-tls" class="hide">
                    <label style="width: auto; margin-left: 20px; margin-right: 10px;" for="node-config-input-tls"><span data-i18n="mqtt.label.tls-config"></span></label><input style="width: 300px;" type="text" id="node-config-input-tls">
                </div>
            </div>
            <div class="form-row">
                <label for="node-config-input-clientid"><i class="fa fa-tag"></i> <span data-i18n="mqtt.label.clientid"></span></label>
                <input type="text" id="node-config-input-clientid" data-i18n="[placeholder]mqtt.placeholder.clientid">
            </div>
            <div class="form-row">
                <label for="node-config-input-keepalive" style="width: auto"><i class="fa fa-clock-o"></i> <span data-i18n="mqtt.label.keepalive"></span></label>
                <input type="text" id="node-config-input-keepalive" style="width: 50px">
                <input type="checkbox" id="node-config-input-cleansession" style="margin-left: 30px; height: 1em;display: inline-block; width: auto; vertical-align: middle;">
                <label for="node-config-input-cleansession" style="width: auto;" data-i18n="mqtt.label.cleansession"></label>
            </div>
            <div class="form-row">
                <input type="checkbox" id="node-config-input-compatmode" style="display: inline-block; width: auto; vertical-align: top;">
                <label for="node-config-input-compatmode" style="width: auto;" data-i18n="mqtt.label.compatmode"></label>
            </div>
        </div>
        <div id="mqtt-broker-tab-security" style="display:none">
            <div class="form-row">
                <label for="node-config-input-user"><i class="fa fa-user"></i> <span data-i18n="common.label.username"></span></label>
                <input type="text" id="node-config-input-user">
            </div>
            <div class="form-row">
                <label for="node-config-input-password"><i class="fa fa-lock"></i> <span data-i18n="common.label.password"></span></label>
                <input type="password" id="node-config-input-password">
            </div>
        </div>
        <div id="mqtt-broker-tab-birth" style="display:none">
            <div class="form-row">
                <label for="node-config-input-birthTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
                <input type="text" id="node-config-input-birthTopic" data-i18n="[placeholder]mqtt.placeholder.birth-topic">
            </div>
            <div class="form-row">
                <label for="node-config-input-birthQos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
                <select id="node-config-input-birthQos" style="width:125px !important">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                </select>
                &nbsp;&nbsp;<i class="fa fa-history"></i>&nbsp;<span data-i18n="mqtt.retain"></span> &nbsp;<select id="node-config-input-birthRetain" style="width:125px !important">
                    <option value="false" data-i18n="mqtt.false"></option>
                    <option value="true" data-i18n="mqtt.true"></option>
                </select>
            </div>
            <div class="form-row">
                <label for="node-config-input-birthPayload"><i class="fa fa-envelope"></i> <span data-i18n="common.label.payload"></span></label>
                <input type="text" id="node-config-input-birthPayload" data-i18n="[placeholder]common.label.payload">
            </div>
        </div>
        <div id="mqtt-broker-tab-will" style="display:none">
            <div class="form-row">
                <label for="node-config-input-willTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
                <input type="text" id="node-config-input-willTopic" data-i18n="[placeholder]mqtt.placeholder.will-topic">
            </div>
            <div class="form-row">
                <label for="node-config-input-willQos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
                <select id="node-config-input-willQos" style="width:125px !important">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                </select>
                &nbsp;&nbsp;<i class="fa fa-history"></i>&nbsp;<span data-i18n="mqtt.retain"></span> &nbsp;<select id="node-config-input-willRetain" style="width:125px !important">
                    <option value="false" data-i18n="mqtt.false"></option>
                    <option value="true" data-i18n="mqtt.true"></option>
                </select>
            </div>
            <div class="form-row">
                <label for="node-config-input-willPayload"><i class="fa fa-envelope"></i> <span data-i18n="common.label.payload"></span></label>
                <input type="text" id="node-config-input-willPayload" data-i18n="[placeholder]common.label.payload">
            </div>
        </div>
    </div></script><script type="text/javascript">RED.nodes.registerType('mqtt-broker',{
        category: 'config',
        defaults: {
            broker: {value:"",required:true},
            port: {value:1883,required:true,validate:RED.validators.number()},
            tls: {type:"tls-config",required: false},
            clientid: {value:"", validate: function(v) {
                    if ($("#node-config-input-clientid").length) {
                        // Currently editing the node
                        return $("#node-config-input-cleansession").is(":checked") || v.length > 0;
                    } else {
                        return this.cleansession || v.length > 0;
                    }
                }},
            usetls: {value: false},
            verifyservercert: { value: false},
            compatmode: { value: true},
            keepalive: {value:60,validate:RED.validators.number()},
            cleansession: {value: true},
            willTopic: {value:""},
            willQos: {value:"0"},
            willRetain: {value:false},
            willPayload: {value:""},
            birthTopic: {value:""},
            birthQos: {value:"0"},
            birthRetain: {value:false},
            birthPayload: {value:""},
            user: {value:""},
            password: {value: ""}
        },
        // credentials: {
        //     user: {type:"text"},
        //     password: {type: "password"}
        // },
        label: function() {
            if (this.broker === "") { this.broker = "localhost"; }
            return (this.clientid?this.clientid+"@":"")+this.broker+":"+this.port;
        },
        oneditprepare: function () {
            var tabs = RED.tabs.create({
                id: "node-config-mqtt-broker-tabs",
                onchange: function(tab) {
                    $("#node-config-mqtt-broker-tabs-content").children().hide();
                    $("#" + tab.id).show();
                }
            });
            tabs.addTab({
                id: "mqtt-broker-tab-connection",
                label: this._("mqtt.tabs-label.connection")
            });
            tabs.addTab({
                id: "mqtt-broker-tab-security",
                label: this._("mqtt.tabs-label.security")
            });
            tabs.addTab({
                id: "mqtt-broker-tab-birth",
                label: this._("mqtt.tabs-label.birth")
            });
            tabs.addTab({
                id: "mqtt-broker-tab-will",
                label: this._("mqtt.tabs-label.will")
            });
            setTimeout(function() { tabs.resize()},0);
            if (typeof this.cleansession === 'undefined') {
                this.cleansession = true;
                $("#node-config-input-cleansession").prop("checked",true);
            }
            if (typeof this.usetls === 'undefined') {
                this.usetls = false;
                $("#node-config-input-usetls").prop("checked",false);
            }
            if (typeof this.compatmode === 'undefined') {
                this.compatmode = true;
                $("#node-config-input-compatmode").prop('checked', true);
            }
            if (typeof this.keepalive === 'undefined') {
                this.keepalive = 15;
                $("#node-config-input-keepalive").val(this.keepalive);
            }
            if (typeof this.willQos === 'undefined') {
                this.willQos = "0";
                $("#node-config-input-willQos").val("0");
            }
            if (typeof this.birthQos === 'undefined') {
                this.birthQos = "0";
                $("#node-config-input-birthQos").val("0");
            }
            function updateTLSOptions() {
                if ($("#node-config-input-usetls").is(':checked')) {
                    $("#node-config-row-tls").show();
                } else {
                    $("#node-config-row-tls").hide();
                }
            }
            updateTLSOptions();
            $("#node-config-input-usetls").on("click",function() {
                updateTLSOptions();
            });
            var node = this;
            function updateClientId() {
                if ($("#node-config-input-cleansession").is(":checked")) {
                    $("#node-config-input-clientid").attr("placeholder",node._("mqtt.placeholder.clientid"));
                } else {
                    $("#node-config-input-clientid").attr("placeholder",node._("mqtt.placeholder.clientid-nonclean"));
                }
                $("#node-config-input-clientid").change();
            }
            setTimeout(updateClientId,0);
            $("#node-config-input-cleansession").on("click",function() {
                updateClientId();
            });
        },
        oneditsave: function() {
            if (!$("#node-config-input-usetls").is(':checked')) {
                $("#node-config-input-tls").val("");
            }
        }
    });</script><script type="text/x-red" data-help-name="mqtt in"><p>Connects to a broker and subscribes to the specified topic.</p>
    <p>Outputs a message with the properties:</p>
    <ul>
       <li><code>msg.topic</code></li>
       <li><code>msg.payload</code></li>
       <li><code>msg.qos</code></li>
       <li><code>msg.retain</code></li>
    </ul>
    <p><code>msg.payload</code> will be a String, unless it is detected as a binary buffer.</p></script><script type="text/x-red" data-help-name="mqtt out"><p>Connects to a MQTT broker and publishes messages.</p>
    <p><code>msg.payload</code> is used as the payload of the published message.
    If it contains an Object it will be converted to JSON before being sent.
    </p>
    <p>The topic used can be configured in the node or, if left blank, can be set
       by <code>msg.topic</code>.</p>
    <p>Likewise the QoS and retain values can be configured in the node or, if left
       blank, set by <code>msg.qos</code> and <code>msg.retain</code> respectively.
       By default, messages are published at QoS 0 with the retain flag set to false.</p></script><script type="text/x-red" data-help-name="mqtt-broker"><p>A minimum MQTT broker connecton requires only a broker server address to be added to the default configuration.</p>
    <p>To secure the connection with SSL/TLS, a TLS Configuration must also be configured and selected.</p>
    <p>If you create a Client ID it must be unique to the broker you are connecting to.</p>
    <p>For more information about MQTT see the <a href="http://www.eclipse.org/paho/" target="_new">Eclipse Paho</a> site.</p></script><script type="text/x-red" data-template-name="watch"><div class="form-row node-input-filename">
         <label for="node-input-files"><i class="fa fa-file"></i> File(s)</label>
         <input type="text" id="node-input-files" placeholder="File(s) or Directory">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
     <div id="node-input-tip" class="form-tips">On Windows you must use double slashes \\ in any directory names.</div></script><script type="text/javascript">RED.nodes.registerType('watch',{
        category: 'advanced-input',
        defaults: {
            name: {value:""},
            files: {value:"",required:true}
        },
        color:"BurlyWood",
        inputs:0,
        outputs:1,
        icon: "watch.png",
        label: function() {
            return this.name||this.files;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-help-name="watch"><p>Watches a directory or file for any changes.</p>
    <p>You can enter a list of comma separated directories or files if you like. You will need to put " around any that have spaces in.</p>
    <p>On Windows you must use double slashes \\ in any directory names.</p>
    <p>The full filename of the file that actually changed is put into <b>msg.payload</b>, while a stringified version of the watched criteria is returned in <b>msg.topic</b>.</p>
    <p><b>msg.file</b> contains just the short filename of the file that changed.</p>
    <p>Of course in Linux, <i>everything</i> could be a file and thus watched...</p>
    <p><b>Note: </b>The directory or file must exist in order to be watched. If the file or directory gets deleted it may no longer be monitored even if it gets re-created.</p></script><script type="text/x-red" data-template-name="serial in"><div class="form-row node-input-serial">
        <label for="node-input-serial"><i class="fa fa-random"></i> Serial Port</label>
        <input type="text" id="node-input-serial">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('serial in',{
        category: 'input',
        defaults: {
            name: {name:""},
            serial: {type:"serial-port",required:true}
        },
        color:"BurlyWood",
        inputs:0,
        outputs:1,
        icon: "serial.png",
        label: function() {
            var serialNode = RED.nodes.node(this.serial);
            return this.name||(serialNode?serialNode.label().split(":")[0]:"serial");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-template-name="serial out"><div class="form-row node-input-serial">
        <label for="node-input-serial"><i class="fa fa-random"></i> Serial Port</label>
        <input type="text" id="node-input-serial">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('serial out',{
        category: 'output',
        defaults: {
            name: {name:""},
            serial: {type:"serial-port",required:true}
        },
        color:"BurlyWood",
        inputs:1,
        outputs:0,
        icon: "serial.png",
        align: "right",
        label: function() {
            var serialNode = RED.nodes.node(this.serial);
            return this.name||(serialNode?serialNode.label().split(":")[0]:"serial");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-template-name="serial-port"><div class="form-row">
        <label for="node-config-input-serialport"><i class="fa fa-random"></i> Serial Port</label>
        <input type="text" id="node-config-input-serialport" style="width:60%;" placeholder="/dev/ttyUSB0"/>
        <a id="node-config-lookup-serial" class="btn"><i id="node-config-lookup-serial-icon" class="fa fa-search"></i></a>
    </div>
    <div class="form-row">
        <table><tr>
            <td width="102px"><i class="fa fa-wrench"></i> Settings</td>
            <td width="100px">Baud Rate</td>
            <td width="80px">Data Bits</td>
            <td width="80px">Parity</td>
            <td width="80px">Stop Bits</td>
        </tr><tr><td>&nbsp;</td>
        <td>
        <select type="text" id="node-config-input-serialbaud" style="width: 100px;">
            <option value="115200">115200</option>
            <option value="57600">57600</option>
            <option value="38400">38400</option>
            <option value="19200">19200</option>
            <option value="9600">9600</option>
            <option value="4800">4800</option>
            <option value="2400">2400</option>
            <option value="1800">1800</option>
            <option value="1200">1200</option>
            <option value="600">600</option>
            <option value="300">300</option>
            <option value="200">200</option>
            <option value="150">150</option>
            <option value="134">134</option>
            <option value="110">110</option>
            <option value="75">75</option>
            <option value="50">50</option>
        </select>
        </td><td>
        <select type="text" id="node-config-input-databits" style="width: 80px;">
            <option value="8">8</option>
            <option value="7">7</option>
            <option value="6">6</option>
            <option value="5">5</option>
        </select>
        </td><td>
        <select type="text" id="node-config-input-parity" style="width: 80px;">
            <option value="none">None</option>
            <option value="even">Even</option>
            <option value="mark">Mark</option>
            <option value="odd">Odd</option>
            <option value="space">Space</option>
        </select>
        </td><td>
        <select type="text" id="node-config-input-stopbits" style="width: 80px;">
            <option value="2">2</option>
            <option value="1">1</option>
        </select>
    </td>
    </tr></table><br/>

    <div class="form-row">
        <label><i class="fa fa-sign-in"></i> Input</label>
    </div>
    <div class="form-row" style="padding-left: 10px;">
        Split input
        <select type="text" id="node-config-input-out" style="margin-left: 5px; width:200px;">
            <option value="char">on the character</option>
            <option value="time">after a timeout of</option>
            <option value="count">into fixed lengths of</option>
        </select>
        <input type="text" id="node-config-input-newline"  style="width:50px;">
        <span id="node-units"></span>
    </div>
    <div class="form-row" style="padding-left: 10px;">
        and deliver
        <select type="text" id="node-config-input-bin" style="margin-left: 5px; width: 150px;">
            <option value="false">ascii strings</option>
            <option value="bin">binary buffers</option>
        </select>
    </div>
    <br/>
    <div id="node-config-addchar">
        <div class="form-row">
            <label><i class="fa fa-sign-out"></i> Output</label>
        </div>
        <div class="form-row">
            <input style="width: 30px;margin-left: 10px; vertical-align: top;" type="checkbox" id="node-config-input-addchar"><label style="width: auto;" for="node-config-input-addchar">add split character to output messages</label>
        </div>
    </div>
    <div class="form-tips" id="tip-split">Tip: the "Split on" character is used to split the input into separate messages. It can also be added to every message sent out to the serial port.</div>
    <div class="form-tips" id="tip-bin" hidden>Tip: In timeout mode timeout starts from arrival of first character.</div></script><script type="text/javascript">RED.nodes.registerType('serial-port',{
        category: 'config',
        defaults: {
            serialport: {value:"",required:true},
            serialbaud: {value:57600,required:true},
            databits: {value:8,required:true},
            parity: {value:"none",required:true},
            stopbits: {value:1,required:true},
            newline: {value:"\\n"},
            bin: {value:"false"},
            out: {value:"char"},
            addchar: {value:false}
        },
        label: function() {
            this.serialbaud = this.serialbaud || 57600;
            this.databits = this.databits || 8;
            this.parity = this.parity || 'none';
            this.stopbits = this.stopbits || 1;
            return this.serialport+":"+this.serialbaud+"-"+this.databits+this.parity.charAt(0).toUpperCase()+this.stopbits;
        },
        oneditprepare: function() {
            var previous = null;
            $("#node-config-input-out").on('focus', function () { previous = this.value; }).change(function() {
                if (previous == null) { previous = $("#node-config-input-out").val(); }
                if ($("#node-config-input-out").val() == "char") {
                    if (previous != "char") { $("#node-config-input-newline").val("\\n"); }
                    $("#node-units").text("");
                    $("#node-config-addchar").show();
                    $("#tip-split").show();
                    $("#tip-bin").hide();
                }
                else if ($("#node-config-input-out").val() == "time") {
                    if (previous != "time") { $("#node-config-input-newline").val("0"); }
                    $("#node-units").text("ms");
                    $("#node-config-addchar").hide();
                    $("#node-config-input-addchar").val("false");
                    $("#tip-split").hide();
                    $("#tip-bin").show();
                }
                else {
                    if (previous != "count") { $("#node-config-input-newline").val(""); }
                    $("#node-units").text("chars");
                    $("#node-config-addchar").hide();
                    $("#node-config-input-addchar").val("false");
                    $("#tip-split").hide();
                    $("#tip-bin").hide();
                }
            });

            try {
                $("#node-config-input-serialport").autocomplete( "destroy" );
            } catch(err) {
            }
            $("#node-config-lookup-serial").click(function() {
                $("#node-config-lookup-serial").addClass('disabled');
                $.getJSON('serialports',function(data) {
                    $("#node-config-lookup-serial").removeClass('disabled');
                    var ports = [];
                    $.each(data, function(i, port){
                        ports.push(port.comName);
                    });
                    $("#node-config-input-serialport").autocomplete({
                        source:ports,
                        minLength:0,
                        close: function( event, ui ) {
                            $("#node-config-input-serialport").autocomplete( "destroy" );
                        }
                    }).autocomplete("search","");
                });
            });
        }
    });</script><script type="text/x-red" data-help-name="serial in"><p>Reads data from a local serial port.</p>
    <p>Can either <ul><li>wait for a "split" character (default \n). Also accepts hex notation (0x0a).</li>
    <li>Wait for a timeout in milliseconds for the first character received</li>
    <li>Wait to fill a fixed sized buffer</li></ul></p>
    <p>It then outputs <b>msg.payload</b> as either a UTF8 ascii string or a binary Buffer object.</p>
    <p>If no split character is specified, or a timeout or buffer size of 0, then a stream of single characters is sent - again either as ascii chars or size 1 binary buffers.</p></script><script type="text/x-red" data-help-name="serial out"><p>Provides a connection to an outbound serial port.</p>
    <p>Only the <b>msg.payload</b> is sent.</p>
    <p>Optionally the new line character used to split the input can be appended to every message sent out to the serial port.</p></script><script type="text/x-red" data-template-name="tcp in"><div class="form-row">
        <label for="node-input-server"><i class="fa fa-dot-circle-o"></i> Type</label>
        <select id="node-input-server" style="width:120px; margin-right:5px;">
            <option value="server">Listen on</option>
            <option value="client">Connect to</option>
        </select>
        port <input type="text" id="node-input-port" style="width: 50px">
    </div>
    <div class="form-row hidden" id="node-input-host-row" style="padding-left: 110px;">
        at host <input type="text" id="node-input-host" placeholder="localhost" style="width: 60%;">
    </div>

    <div class="form-row">
        <label><i class="fa fa-sign-out"></i> Output</label>
        a
        <select id="node-input-datamode" style="width:110px;">
            <option value="stream">stream of</option>
            <option value="single">single</option>
        </select>
        <select id="node-input-datatype" style="width:140px;">
            <option value="buffer">Buffer</option>
            <option value="utf8">String</option>
            <option value="base64">Base64 String</option>
        </select>
        payload<span id="node-input-datamode-plural">s</span>
    </div>

    <div id="node-row-newline" class="form-row hidden" style="padding-left: 110px;">
        delimited by <input type="text" id="node-input-newline" style="width: 110px;">
    </div>

    <div class="form-row">
        <label for="node-input-topic"><i class="fa fa-tasks"></i> Topic</label>
        <input type="text" id="node-input-topic" placeholder="Topic">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('tcp in',{
        category: 'input',
        color:"Silver",
        defaults: {
            server: {value:"server",required:true},
            host: {value:"",validate:function(v) { return (this.server == "server")||v.length > 0;} },
            port: {value:"",required:true,validate:RED.validators.number()},
            datamode:{value:"stream"},
            datatype:{value:"buffer"},
            newline:{value:""},
            topic: {value:""},
            name: {value:""},
            base64: {/*deprecated*/ value:false,required:true}
        },
        inputs:0,
        outputs:1,
        icon: "bridge-dash.png",
        label: function() {
            return this.name || "tcp:"+(this.host?this.host+":":"")+this.port;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var updateOptions = function() {
                var sockettype = $("#node-input-server option:selected").val();
                if (sockettype == "client") {
                    $("#node-input-host-row").show();
                } else {
                    $("#node-input-host-row").hide();
                }
                var datamode = $("#node-input-datamode option:selected").val();
                var datatype = $("#node-input-datatype option:selected").val();
                if (datamode == "stream") {
                    $("#node-input-datamode-plural").show();
                    if (datatype == "utf8") {
                        $("#node-row-newline").show();
                    } else {
                        $("#node-row-newline").hide();
                    }
                } else {
                    $("#node-input-datamode-plural").hide();
                    $("#node-row-newline").hide();
                }
            };
            updateOptions();
            $("#node-input-server").change(updateOptions);
            $("#node-input-datatype").change(updateOptions);
            $("#node-input-datamode").change(updateOptions);
        }
    });</script><script type="text/x-red" data-template-name="tcp out"><div class="form-row">
        <label for="node-input-beserver"><i class="fa fa-dot-circle-o"></i> Type</label>
        <select id="node-input-beserver" style="width:150px; margin-right:5px;">
            <option value="server">Listen on</option>
            <option value="client">Connect to</option>
            <option value="reply">Reply to TCP</option>
        </select>
        <span id="node-input-port-row">port <input type="text" id="node-input-port" style="width: 50px"></span>
    </div>

    <div class="form-row hidden" id="node-input-host-row" style="padding-left: 110px;">
        at host <input type="text" id="node-input-host" placeholder="localhost" style="width: 60%;">
    </div>

    <div class="form-row hidden" id="node-input-end-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-end" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-end" style="width: 70%;">Close connection after each message is sent ?</label>
    </div>

    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-base64" placeholder="base64" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-base64" style="width: 70%;">Decode Base64 message ?</label>
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

    <div class="form-tips hidden" id="fin-tip">
        <b>Note:</b> Closing the connection after each message is generally not a good thing - but is useful to indicate an end-of-file for example.
    </div>
    <div class="form-tips hidden" id="fin-tip2">
        <b>Note:</b> Closing the connection after each message is generally not a good thing - but is useful to indicate an end-of-file for example. The receiving client will need to reconnect.
    </div></script><script type="text/javascript">RED.nodes.registerType('tcp out',{
        category: 'output',
        color:"Silver",
        defaults: {
            host: {value:"",validate:function(v) { return (this.beserver != "client")||v.length > 0;} },
            port: {value:"",validate:function(v) { return (this.beserver == "reply")||RED.validators.number()(v) } },
            beserver: {value:"client",required:true},
            base64: {value:false,required:true},
            end: {value:false,required:true},
            name: {value:""}
        },
        inputs:1,
        outputs:0,
        icon: "bridge-dash.png",
        align: "right",
        label: function() {
            return this.name || "tcp:"+(this.host?this.host+":":"")+this.port;
        },
        labelStyle: function() {
            return (this.name)?"node_label_italic":"";
        },
        oneditprepare: function() {
            var updateOptions = function() {
                var sockettype = $("#node-input-beserver option:selected").val();
                if (sockettype == "reply") {
                    $("#node-input-port-row").hide();
                    $("#node-input-host-row").hide();
                    $("#node-input-end-row").hide();
                } else {
                    $("#node-input-port-row").show();
                    $("#node-input-end-row").show();
                }

                if (sockettype == "client") {
                    $("#node-input-host-row").show();
                    $("#fin-tip").show();
                } else {
                    $("#node-input-host-row").hide();
                    $("#fin-tip").hide();
                }

                if (sockettype == "server") {
                    $("#fin-tip2").show();
                }
                else {
                    $("#fin-tip2").hide();
                }
            };
            updateOptions();
            $("#node-input-beserver").change(updateOptions);
        }
    });</script><script type="text/x-red" data-template-name="tcp request"><div class="form-row">
        <label for="node-input-server"><i class="fa fa-globe"></i> Server</label>
        <input type="text" id="node-input-server" placeholder="ip.address" style="width:45%">
        &nbsp;port <input type="text" id="node-input-port" placeholder="number" style="width:60px">
    </div>
    <div class="form-row">
        <label for="node-input-out"><i class="fa fa-sign-out"></i> Return</label>
        <select type="text" id="node-input-out" style="width:52%;">
            <option value="time">after a fixed timeout of</option>
            <option value="char">when character received is</option>
            <option value="count">a fixed number of characters</option>
            <option value="sit">never. Keep connection open</option>
        </select>
        <input type="text" id="node-input-splitc"  style="width:50px;">
        <span id="node-units"></span>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips"><b>Tip:</b> Outputs a binary <b>Buffer</b>, so you may want to .toString() it.</br/>
    <b>Tip:</b> Leave host and port blank if you want to overide with msg.host and msg.port properties.</div>
    <script>
        var previous = null;
        $("#node-input-out").on('focus', function () { previous = this.value; }).change(function() {
            if (previous == null) { previous = $("#node-input-out").val(); }
            if ($("#node-input-out").val() == "char") {
                if (previous != "char") $("#node-input-splitc").val("\\n");
                $("#node-units").text("");
            }
            else if ($("#node-input-out").val() == "time") {
                if (previous != "time") $("#node-input-splitc").val("0");
                $("#node-units").text("ms");
            }
            else if ($("#node-input-out").val() == "count") {
                if (previous != "count") $("#node-input-splitc").val("12");
                $("#node-units").text("chars");
            }
            else {
                if (previous != "sit") $("#node-input-splitc").val("0");
                $("#node-units").text("");
            }
        });</script><script type="text/javascript">RED.nodes.registerType('tcp request',{
        category: 'function',
        color:"Silver",
        defaults: {
            server: {value:""},
            port: {value:"",validate:RED.validators.regex(/^(\d*|)$/)},
            out: {value:"time",required:true},
            splitc: {value:"0",required:true},
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "bridge-dash.png",
        label: function() {
            return this.name || "tcp:"+(this.server?this.server+":":"")+this.port;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-help-name="tcp in"><p>Provides a choice of tcp inputs. Can either connect to a remote tcp port,
       or accept incoming connections.</p></script><script type="text/x-red" data-help-name="tcp out"><p>Provides a choice of tcp outputs. Can either connect to a remote tcp port,
    accept incoming connections, or reply to messages received from a TCP In node.</p>
    <p>Only <b>msg.payload</b> is sent.</p>
    <p>If <b>msg.payload</b> is a string containing a Base64 encoding of binary
    data, the Base64 decoding option will cause it to be converted back to binary
    before being sent.</p></script><script type="text/x-red" data-help-name="tcp request"><p>A simple TCP request node - sends the <b>msg.payload</b> to a server tcp port and expects a response.</p>
    <p>Connects, sends the "request", reads the "response". It can either count a number of
    returned characters into a fixed buffer, match a specified character before returning,
    wait a fixed timeout from first reply and then return, or just sit and wait for data.</p>
    <p>The response will be output in <b>msg.payload</b> as a buffer, so you may want to .toString() it.</p>
    <p>If you leave tcp host or port blank they must be set by using the <b>msg.host</b> and <b>msg.port</b> properties.</p></script><script type="text/x-red" data-template-name="udp in"><div class="form-row">
        <label for="node-input-port"><i class="fa fa-sign-in"></i> Listen</label>
        on port <input type="text" id="node-input-port" placeholder="Port" style="width: 45px">
        for <select id="node-input-multicast" style='width:40%'>
          <option value="false">udp messages</option>
          <option value="true">multicast messages</option>
        </select>
    </div>
    <div class="form-row node-input-group">
        <label for="node-input-group"><i class="fa fa-list"></i> Group</label>
        <input type="text" id="node-input-group" placeholder="225.0.18.83">
    </div>
    <div class="form-row node-input-iface">
        <label for="node-input-iface"><i class="fa fa-random"></i> Interface</label>
        <input type="text" id="node-input-iface" placeholder="(optional) ip address of eth0">
    </div>
    <div class="form-row">
        <label for="node-input-datatype"><i class="fa fa-sign-out"></i> Output</label>
        <select id="node-input-datatype" style="width: 70%;">
            <option value="buffer">a Buffer</option>
            <option value="utf8">a String</option>
            <option value="base64">a Base64 encoded string</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips">Tip: Make sure your firewall will allow the data in.</div>
    <script>
        $("#node-input-multicast").change(function() {
            var id = $("#node-input-multicast option:selected").val();
            if (id == "false") {
                $(".node-input-group").hide();
                $(".node-input-iface").hide();
            }
            else {
                $(".node-input-group").show();
                $(".node-input-iface").show();
            }
        });</script><script type="text/javascript">RED.nodes.registerType('udp in',{
        category: 'input',
        color:"Silver",
        defaults: {
            name: {value:""},
            iface: {value:""},
            port: {value:"",required:true,validate:RED.validators.number()},
            datatype: {value:"buffer",required:true},
            multicast: {value:"false"},
            group: {value:"",validate:function(v) { return (this.multicast !== "true")||v.length > 0;} }
        },
        inputs:0,
        outputs:1,
        icon: "bridge-dash.png",
        label: function() {
            if (this.multicast=="false") {
                return this.name||"udp "+this.port;
            }
            else return this.name||"udp "+(this.group+":"+this.port);
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-template-name="udp out"><div class="form-row">
        <label for="node-input-port"><i class="fa fa-envelope"></i> Send a</label>
        <select id="node-input-multicast" style='width:40%'>
          <option value="false">udp message</option>
          <option value="broad">broadcast message</option>
          <option value="multi">multicast message</option>
        </select>
        to port <input type="text" id="node-input-port" placeholder="port" style="width: 70px">
    </div>
    <div class="form-row node-input-addr">
        <label for="node-input-addr" id="node-input-addr-label"><i class="fa fa-list"></i> Address</label>
        <input type="text" id="node-input-addr" placeholder="destination ip" style="width: 70%;">
    </div>
    <div class="form-row node-input-iface">
        <label for="node-input-iface"><i class="fa fa-random"></i> Interface</label>
        <input type="text" id="node-input-iface" placeholder="(optional) ip address of eth0">
    </div>
    <div class="form-row">
        <label for="node-input-outport-type">&nbsp;</label>
        <select id="node-input-outport-type">
          <option id="node-input-outport-type-random" value="random">use random local port</option>
          <option value="fixed">bind to local port</option>
        </select>
        <input type="text" id="node-input-outport"  style="width: 70px;" placeholder="port">
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-base64" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-base64" style="width: 70%;">Decode Base64 encoded payload ?</label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips">Tip: leave address and port blank if you want to set using <b>msg.ip</b> and <b>msg.port</b>.</div>
    <script>
        $("#node-input-multicast").change(function() {
            var id = $("#node-input-multicast option:selected").val();
            if (id !== "multi") {
                $(".node-input-iface").hide();
                $("#node-input-addr-label").html('<i class="fa fa-list"></i> Address');
                $("#node-input-addr")[0].placeholder = 'destination ip';
            }
            else {
                $(".node-input-iface").show();
                $("#node-input-addr-label").html('<i class="fa fa-list"></i> Group');
                $("#node-input-addr")[0].placeholder = '225.0.18.83';
            }
            if (id === "broad") {
                $("#node-input-addr")[0].placeholder = '255.255.255.255';
            }
        });</script><script type="text/javascript">RED.nodes.registerType('udp out',{
        category: 'output',
        color:"Silver",
        defaults: {
            name: {value:""},
            addr: {value:""},
            iface: {value:""},
            port: {value:""},
            outport: {value:""},
            base64: {value:false,required:true},
            multicast: {value:"false"}
        },
        inputs:1,
        outputs:0,
        icon: "bridge-dash.png",
        align: "right",
        label: function() {
            return this.name||"udp "+(this.addr+":"+this.port);
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            var type = this.outport==""?"random":"fixed";
            $("#node-input-outport-type option").filter(function() {
                return $(this).val() == type;
            }).attr('selected',true);

            $("#node-input-outport-type").change(function() {
                var type = $(this).children("option:selected").val();
                if (type == "random") {
                    $("#node-input-outport").val("").hide();
                } else {
                    $("#node-input-outport").show();
                }
            });

            $("#node-input-outport-type").change();

            $("#node-input-multicast").change(function() {
                var type = $(this).children("option:selected").val();
                if (type == "false") {
                    $("#node-input-outport-type-random").html("bind to random local port");
                } else {
                    $("#node-input-outport-type-random").html("bind to target port");
                }
            });
            $("#node-input-multicast").change();
        }
    });</script><script type="text/x-red" data-help-name="udp in"><p>A udp input node, that produces a <b>msg.payload</b> containing a <i>BUFFER</i>, string, or base64 encoded string. Supports multicast.</p>
    <p>It also provides <b>msg.ip</b> and <b>msg.port</b> to the ip address and port from which the message was received.</p>
    <p>On some systems you may need to be root to use ports below 1024 and/or broadcast.</p></script><script type="text/x-red" data-help-name="udp out"><p>This node sends <b>msg.payload</b> to the designated udp host and port. Supports multicast.</p>
    <p>You may also use <b>msg.ip</b> and <b>msg.port</b> to set the destination values.<br/><b>Note</b>: the statically configured values have precedence.</p>
    <p>If you select broadcast either set the address to the local broadcast ip address, or maybe try 255.255.255.255, which is the global broadcast address.</p>
    <p>On some systems you may need to be root to use ports below 1024 and/or broadcast.</p></script><script type="text/x-red" data-template-name="switch"><div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        If msg.<input type="text" id="node-input-property" style="width: 200px;"/>
    </div>
    <div class="form-row node-input-rule-container-row" style="margin-bottom: 0px;">
        <div id="node-input-rule-container-div" style="box-sizing: border-box; border-radius: 5px; height: 310px; padding: 5px; border: 1px solid #ccc; overflow-y:scroll;">
            <ol id="node-input-rule-container" style=" list-style-type:none; margin: 0;"></ol>
        </div>
    </div>
    <div class="form-row">
        <a href="#" class="btn btn-mini" id="node-input-add-rule" style="margin-top: 4px;"><i class="fa fa-plus"></i> rule</a>
    </div>
    <div class="form-row">
        <select id="node-input-checkall" style="width:100%; margin-right:5px;">
            <option value="true">checking all rules</option>
            <option value="false">stopping after first match</option>
        </select>
    </div></script><script type="text/javascript">RED.nodes.registerType('switch', {
        color: "#E2D96E",
        category: 'function',
        defaults: {
            name: {value:""},
            property: {value:"payload", required:true},
            rules: {value:[{t:"eq", v:""}]},
            checkall: {value:"true", required:true},
            outputs: {value:1}
        },
        inputs: 1,
        outputs: 1,
        icon: "switch.png",
        label: function() {
            return this.name||"switch";
        },
        oneditprepare: function() {
            var operators = [
                {v:"eq",t:"=="},
                {v:"neq",t:"!="},
                {v:"lt",t:"<"},
                {v:"lte",t:"<="},
                {v:"gt",t:">"},
                {v:"gte",t:">="},
                {v:"btwn",t:"is between"},
                {v:"cont",t:"contains"},
                {v:"regex",t:"matches regex"},
                {v:"true",t:"is true"},
                {v:"false",t:"is false"},
                {v:"null",t:"is null"},
                {v:"nnull",t:"is not null"},
                {v:"else",t:"otherwise"}
            ];
            function generateRule(i,rule) {
                var container = $('<li/>',{style:"background: #fff; margin:0; padding:8px 0px; border-bottom: 1px solid #ccc;"});
                var row = $('<div/>').appendTo(container);
                var row2 = $('<div/>',{style:"padding-top: 5px; text-align: right;"}).appendTo(container);
                $('<i style="color: #eee; cursor: move;" class="node-input-rule-handle fa fa-bars"></i>').appendTo(row);
                var selectField = $('<select/>',{style:"width:120px; margin-left: 5px; text-align: center;"}).appendTo(row);
                for (var d in operators) {
                    selectField.append($("<option></option>").val(operators[d].v).text(operators[d].t));
                }
                var valueField = $('<input/>',{class:"node-input-rule-value",type:"text",style:"margin-left: 5px; width: 145px;"}).appendTo(row);
                var btwnField = $('<span/>').appendTo(row);
                var btwnValueField = $('<input/>',{class:"node-input-rule-btwn-value",type:"text",style:"margin-left: 5px; width: 50px;"}).appendTo(btwnField);
                btwnField.append(" and ");
                var btwnValue2Field = $('<input/>',{class:"node-input-rule-btwn-value2",type:"text",style:"width: 50px;margin-left:2px;"}).appendTo(btwnField);
                var finalspan = $('<span/>',{style:"float: right; margin-top: 3px;margin-right: 10px;"}).appendTo(row);
                finalspan.append(' &#8594; <span class="node-input-rule-index">'+i+'</span> ');
                var deleteButton = $('<a/>',{href:"#",class:"btn btn-mini", style:"margin-left: 5px;"}).appendTo(finalspan);
                $('<i/>',{class:"fa fa-remove"}).appendTo(deleteButton);
                selectField.change(function() {
                    var type = selectField.children("option:selected").val();
                    if (type.length < 4) {
                        selectField.css({"width":"60px"});
                    } else if (type === "regex") {
                        selectField.css({"width":"147px"});
                    } else {
                        selectField.css({"width":"120px"});
                    }
                    if (type === "btwn") {
                        valueField.hide();
                        btwnField.show();
                    } else {
                        btwnField.hide();
                        if (type === "true" || type === "false" || type === "null" || type === "nnull" || type === "else") {
                            valueField.hide();
                        } else {
                            valueField.show();
                        }
                    }
                });
                deleteButton.click(function() {
                    container.css({"background":"#fee"});
                    container.fadeOut(300, function() {
                        $(this).remove();
                        $("#node-input-rule-container").children().each(function(i) {
                            $(this).find(".node-input-rule-index").html(i+1);
                        });
                    });
                });
                $("#node-input-rule-container").append(container);
                selectField.find("option").filter(function() {return $(this).val() == rule.t;}).attr('selected',true);
                if (rule.t == "btwn") {
                    btwnValueField.val(rule.v);
                    btwnValue2Field.val(rule.v2);
                } else if (typeof rule.v != "undefined") {
                    valueField.val(rule.v);
                }
                selectField.change();
            }
            $("#node-input-add-rule").click(function() {
                generateRule($("#node-input-rule-container").children().length+1,{t:"",v:"",v2:""});
                $("#node-input-rule-container-div").scrollTop($("#node-input-rule-container-div").get(0).scrollHeight);
            });
            for (var i=0;i<this.rules.length;i++) {
                var rule = this.rules[i];
                generateRule(i+1,rule);
            }
            function switchDialogResize() {
                var rows = $("#dialog-form>div:not(.node-input-rule-container-row)");
                var height = $("#dialog-form").height();
                for (var i=0;i<rows.size();i++) {
                    height -= $(rows[i]).outerHeight(true);
                }
                var editorRow = $("#dialog-form>div.node-input-rule-container-row");
                height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
                $("#node-input-rule-container-div").css("height",height+"px");
            };
            
            $( "#node-input-rule-container" ).sortable({
                axis: "y",
                update: function( event, ui ) {
                    var rules = $("#node-input-rule-container").children();
                    rules.each(function(i) {
                        $(this).find(".node-input-rule-index").html(i+1);
                    });
                },
                handle:".node-input-rule-handle",
                cursor: "move"
            });
            $( "#node-input-rule-container .node-input-rule-handle" ).disableSelection();
            $( "#dialog" ).on("dialogresize", switchDialogResize);
            $( "#dialog" ).one("dialogopen", function(ev) {
                var size = $( "#dialog" ).dialog('option','sizeCache-switch');
                if (size) {
                    $("#dialog").dialog('option','width',size.width);
                    $("#dialog").dialog('option','height',size.height);
                    switchDialogResize();
                }
            });
            $( "#dialog" ).one("dialogclose", function(ev,ui) {
                $( "#dialog" ).off("dialogresize",switchDialogResize);
            });
        },
        oneditsave: function() {
            var rules = $("#node-input-rule-container").children();
            var ruleset;
            var node = this;
            node.rules= [];
            rules.each(function(i) {
                var rule = $(this);
                var type = rule.find("select option:selected").val();
                var r = {t:type};
                if (!(type === "true" || type === "false" || type === "null" || type === "nnull" || type === "else")) {
                    if (type === "btwn") {
                        r.v = rule.find(".node-input-rule-btwn-value").val();
                        r.v2 = rule.find(".node-input-rule-btwn-value2").val();
                    } else {
                        r.v = rule.find(".node-input-rule-value").val();
                    }
                }
                node.rules.push(r);
            });
            node.outputs = node.rules.length;
        }
    });</script><script type="text/x-red" data-help-name="switch"><p>A simple function node to route messages based on its properties.</p>
    <p>When a message arrives, the selected property is evaluated against each
    of the defined rules. The message is then sent to the output of <i>all</i>
    rules that pass.</p>
    <p>Note: the <i>otherwise</i> rule applies as a "not any of" the rules preceding it.</p></script><script type="text/x-red" data-template-name="change"><div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row" style="margin-bottom:0;">
        <label><i class="fa fa-list"></i> Rules</label>
    </div>
    <div class="form-row node-input-rule-container-row" style="margin-bottom: 0px;">
        <div id="node-input-rule-container-div" style="box-sizing: border-box; border-radius: 5px; height: 300px; padding: 5px; border: 1px solid #ccc; overflow-y:scroll;">
            <ol id="node-input-rule-container" style=" list-style-type:none; margin: 0;"></ol>
        </div>
    </div>
    <div class="form-row">
        <a href="#" class="btn btn-mini" id="node-input-add-rule" style="margin-top: 4px;"><i class="fa fa-plus"></i> rule</a>
    </div></script><script type="text/javascript">RED.nodes.registerType('change', {
        color: "#E2D96E",
        category: 'function',
        defaults: {
            name: {value:""},
            rules:{value:[{t:"set",p:"payload",to:""}]},
            action: {value:""},
            property: {value:""},
            from: {value:""},
            to: {value:""},
            reg: {value:false}
        },
        inputs: 1,
        outputs: 1,
        icon: "swap.png",
        label: function() {
            if (this.name) {
                return this.name;
            }
            if (!this.rules) {
                if (this.action === "replace") {
                    return "set msg."+this.property;
                } else if (this.action === "change") {
                    return "change msg."+this.property;
                } else {
                    return this.action+" msg."+this.property
                }
            } else {
                if (this.rules.length == 1) {
                    if (this.rules[0].t === "set") {
                        return "set msg."+this.rules[0].p;
                    } else if (this.rules[0].t === "change") {
                        return "change msg."+this.rules[0].p;
                    } else {
                        return "delete msg."+this.rules[0].p;
                    }
                } else {
                    return "change: "+(this.rules.length||"no")+" rules";
                }
            }
        },
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        },
        oneditprepare: function() {
            if (this.reg === null) { $("#node-input-reg").prop('checked', true); }
            $("#node-input-action").change();
            
            function generateRule(rule) {
                var container = $('<li/>',{style:"background: #fff; margin:0; padding:8px 0px; border-bottom: 1px solid #ccc;"});
                
                var row1 = $('<div/>').appendTo(container);
                
                var row2 = $('<div/>',{style:"margin-top:8px;"}).appendTo(container);
                var row3 = $('<div/>',{style:"margin-top:8px;"}).appendTo(container);
                var selectField = $('<select/>',{class:"node-input-rule-type",style:"width: 100px"}).appendTo(row1);
                var selectOptions = [{v:"set",l:"Set"},{v:"change",l:"Change"},{v:"delete",l:"Delete"}];
                for (var i=0;i<3;i++) {
                    selectField.append($("<option></option>").val(selectOptions[i].v).text(selectOptions[i].l));
                }
                
                $('<div/>',{style:"display:inline-block; width: 50px; text-align: right;"}).text("msg.").appendTo(row1);
                var propertyName = $('<input/>',{style:"width: 220px",class:"node-input-rule-property-name",type:"text"}).appendTo(row1);
                
                var finalspan = $('<span/>',{style:"float: right; margin-top: 3px;margin-right: 10px;"}).appendTo(row1);
                var deleteButton = $('<a/>',{href:"#",class:"btn btn-mini", style:"margin-left: 5px;"}).appendTo(finalspan);
                $('<i/>',{class:"fa fa-remove"}).appendTo(deleteButton);
                
                $('<div/>',{style:"display: inline-block;text-align:right; width:150px;padding-right: 10px; box-sizing: border-box;"}).text("to").appendTo(row2);
                var propertyValue = $('<input/>',{style:"width: 220px",class:"node-input-rule-property-value",type:"text"}).appendTo(row2);
                
                var row3_1 = $('<div/>').appendTo(row3);
                $('<div/>',{style:"display: inline-block;text-align:right; width:150px;padding-right: 10px; box-sizing: border-box;"}).text("Search for").appendTo(row3_1);
                var fromValue = $('<input/>',{style:"width: 220px",class:"node-input-rule-property-search-value",type:"text"}).appendTo(row3_1);
                
                var row3_2 = $('<div/>',{style:"margin-top:8px;"}).appendTo(row3);
                $('<div/>',{style:"display: inline-block;text-align:right; width:150px;padding-right: 10px; box-sizing: border-box;"}).text("replace with").appendTo(row3_2);
                var toValue = $('<input/>',{style:"width: 220px",class:"node-input-rule-property-replace-value",type:"text"}).appendTo(row3_2);
                
                var row3_3 = $('<div/>',{style:"margin-top:8px;"}).appendTo(row3);
                var id = "node-input-rule-property-regex-"+Math.floor(Math.random()*10000);
                var useRegExp = $('<input/>',{id:id,class:"node-input-rule-property-re",type:"checkbox", style:"margin-left: 150px; margin-right: 10px; display: inline-block; width: auto; vertical-align: top;"}).appendTo(row3_3);
                $('<label/>',{for:id,style:"width: auto;"}).text("Use regular expressions").appendTo(row3_3);
                
                selectField.change(function() {
                    var type = $(this).val();
                    
                    if (type == "set") {
                        row2.show();
                        row3.hide();
                    } else if (type == "change") {
                        row2.hide();
                        row3.show();
                    } else if (type == "delete") {
                        row2.hide();
                        row3.hide();
                        $("#node-tip").hide();
                    }
                });
                deleteButton.click(function() {
                    container.css({"background":"#fee"});
                    container.fadeOut(300, function() {
                        $(this).remove();
                    });
                });
                
                selectField.find("option").filter(function() {return $(this).val() == rule.t;}).attr('selected',true);
                propertyName.val(rule.p);
                propertyValue.val(rule.to);
                fromValue.val(rule.from);
                toValue.val(rule.to);
                useRegExp.prop('checked', rule.re);
                selectField.change();
                
                $("#node-input-rule-container").append(container);
            }
            $("#node-input-add-rule").click(function() {
                generateRule({t:"replace",p:"payload"});
            });
            
            if (!this.rules) {
                var rule = {
                    t:(this.action=="replace"?"set":this.action),
                    p:this.property
                }
                
                if (rule.t === "set") {
                    rule.to = this.to;
                } else if (rule.t === "change") {
                    rule.from = this.from;
                    rule.to = this.to;
                    rule.re = this.reg;
                }
                
                delete this.to;
                delete this.from;
                delete this.reg;
                delete this.action;
                delete this.property;
                
                this.rules = [rule];
            }
            
            for (var i=0;i<this.rules.length;i++) {
                generateRule(this.rules[i]);
            }
            
            function changeDialogResize() {
                var rows = $("#dialog-form>div:not(.node-input-rule-container-row)");
                var height = $("#dialog-form").height();
                for (var i=0;i<rows.size();i++) {
                    height -= $(rows[i]).outerHeight(true);
                }
                var editorRow = $("#dialog-form>div.node-input-rule-container-row");
                height -= (parseInt(editorRow.css("marginTop"))+parseInt(editorRow.css("marginBottom")));
                $("#node-input-rule-container-div").css("height",height+"px");
            };
            $( "#dialog" ).on("dialogresize", changeDialogResize);
            $( "#dialog" ).one("dialogopen", function(ev) {
                var size = $( "#dialog" ).dialog('option','sizeCache-change');
                if (size) {
                    $("#dialog").dialog('option','width',size.width);
                    $("#dialog").dialog('option','height',size.height);
                    changeDialogResize();
                }
            });
            $( "#dialog" ).one("dialogclose", function(ev,ui) {
                $( "#dialog" ).off("dialogresize",changeDialogResize);
            });
        },
        oneditsave: function() {
            var rules = $("#node-input-rule-container").children();
            var ruleset;
            var node = this;
            node.rules= [];
            rules.each(function(i) {
                var rule = $(this);
                var type = rule.find(".node-input-rule-type option:selected").val();
                var r = {
                    t:type,
                    p:rule.find(".node-input-rule-property-name").val()
                };
                if (type === "set") {
                    r.to = rule.find(".node-input-rule-property-value").val();
                } else if (type === "change") {
                    r.from = rule.find(".node-input-rule-property-search-value").val();
                    r.to = rule.find(".node-input-rule-property-replace-value").val();
                    r.re = rule.find(".node-input-rule-property-re").prop('checked');
                }
                node.rules.push(r);
            });
        }
    });</script><script type="text/x-red" data-help-name="change"><p>Set, change or delete properties of a message.</p>
    <p>The node can specify multiple rules that will be applied to the message in turn.</p>
    <p>The available operations are:</p>
    <ul>
        <li><b>Set</b> - set a property. The <b>to</b> property can either be a string value, or reference
         another message property by name, for example: <code>msg.topic</code>.</li>
        <li><b>Change</b> - search &amp; replace parts of the property. If regular expressions
            are enabled, the <b>replace with</b> property can include capture groups, for example <code>$1</code></li>
        <li><b>Delete</b> - delete a property.</li>
    </ul></script><script type="text/x-red" data-template-name="range"><div class="form-row">
        <label for="node-input-action"><i class="fa fa-dot-circle-o"></i> Action</label>
        <select id="node-input-action" style="width:70%; margin-right:5px;">
            <option value="scale">Scale msg.payload</option>
            <option value="clamp">Scale and limit to the target range</option>
            <option value="roll">Scale and wrap within the target range</option>
        </select>
    </div>
    <br/>
    <div class="form-row"><i class="fa fa-sign-in"></i> Map the input range:</div>
    <div class="form-row"><label></label>
        from: <input type="text" id="node-input-minin" placeholder="e.g. 0" style="width:100px;"/>
        &nbsp;&nbsp;to: <input type="text" id="node-input-maxin" placeholder="e.g. 99" style="width:100px;"/>
    </div>
    <div class="form-row"><i class="fa fa-sign-out"></i> to the result range:</div>
    <div class="form-row"><label></label>
        from: <input type="text" id="node-input-minout" placeholder="e.g. 0" style="width:100px;"/>
        &nbsp;&nbsp;to: <input type="text" id="node-input-maxout" placeholder="e.g. 255" style="width:100px;"/>
    </div>
    <br/>
    <div class="form-row"><label></label>
        <input type="checkbox" id="node-input-round" style="display: inline-block; width: auto; vertical-align: top;">
        <label style="width: auto;" for="node-input-round">Round result to the nearest integer?</label></input>
    </div>
    <br/>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips" id="node-tip">Tip: This node ONLY works with numbers.</div></script><script type="text/javascript">RED.nodes.registerType('range', {
        color: "#E2D96E",
        category: 'function',
        defaults: {
            minin: {value:"",required:true,validate:RED.validators.number()},
            maxin: {value:"",required:true,validate:RED.validators.number()},
            minout: {value:"",required:true,validate:RED.validators.number()},
            maxout: {value:"",required:true,validate:RED.validators.number()},
            action: {value:"scale"},
            round: {value:false},
            name: {value:""}
        },
        inputs: 1,
        outputs: 1,
        icon: "range.png",
        label: function() {
            return this.name || "range";
        },
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        }
    });</script><script type="text/x-red" data-help-name="range"><p>A simple function node to remap numeric input values to another scale.</p>
    <p>Currently only does a linear scaling.</p>
    <p><b>Note:</b> This only operates on <b>numbers</b>. Anything else will try to be made into a number and rejected if that fails.</p>
    <p><i>Scale and limit to target range</i> means that the result will never be outside the range specified within the result range.</p>
    <p><i>Scale and wrap within the target range</i> means that the result will essentially be a "modulo-style" wrap-around within the result range.</p></script><script type="text/x-red" data-template-name="csv"><div class="form-row">
        <label for="node-input-temp"><i class="fa fa-list"></i> Columns</label>
        <input type="text" id="node-input-temp" placeholder="comma-separated column names">
    </div>
    <div class="form-row">
        <label for="node-input-select-sep"><i class="fa fa-text-width"></i> Separator</label>
            <select style="width: 150px" id="node-input-select-sep">
                <option value=",">comma</option>
                <option value="\t">tab</option>
                <option value=" ">space</option>
                <option value=";">semicolon</option>
                <option value=":">colon</option>
                <option value="">other...</option>
           </select>
           <input style="width: 40px;" type="text" id="node-input-sep" pattern=".">
    </div>

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <hr align="middle"/>
    <div class="form-row">
        <label style="width: 100%;"><i class="fa fa-gears"></i> CSV-to-Object options</label>
        <label style="margin-left: 10px; margin-right: -10px;"><i class="fa fa-sign-in"></i> Input</label>
        <input style="width: 30px" type="checkbox" id="node-input-hdrin"><label style="width: auto;" for="node-input-hdrin">first row contains column names</span>
    </div>
    <div class="form-row">
        <label style="margin-left: 10px; margin-right: -10px;"><i class="fa fa-sign-out"></i> Output</label>
        <select type="text" id="node-input-multi" style="width: 250px;">
            <option value="one">a message per row</option>
            <option value="mult">a single message [array]</option>
        </select>
    </div>
    <hr align="middle"/>
    <div class="form-row">
        <label style="width: 100%;"><i class="fa fa-gears"></i> Object-to-CSV options</label>
        <label style="margin-left: 10px; margin-right: -10px;"><i class="fa fa-sign-in"></i> Output</label>
        <input style="width: 30px" type="checkbox" id="node-input-hdrout"><label style="width: auto;" for="node-input-hdrout">include column name row</span>
    </div>
    <div class="form-row">
        <label style="margin-left: 10px; margin-right: -10px;"><i class="fa fa-align-left"></i> Newline</label>
        <select style="width: 150px" id="node-input-ret">
            <option value='\n'>Linux (\n)</option>
            <option value='\r'>Mac (\r)</option>
            <option value='\r\n'>Windows (\r\n)</option>
       </select>
    </div></script><script type="text/javascript">RED.nodes.registerType('csv',{
        category: 'function',
        color:"#DEBD5C",
        defaults: {
            name: {value:""},
            sep: {value:',',required:true,validate:RED.validators.regex(/^.{1,2}$/)},
            hdrin: {value:""},
            hdrout: {value:""},
            multi: {value:"one",required:true},
            ret: {value:'\\n'},
            temp: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "arrow-in.png",
        label: function() {
            return this.name||"csv";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            if (this.sep == "," || this.sep == "\\t" || this.sep == ";" || this.sep == ":" || this.sep == " ") {
                $("#node-input-select-sep").val(this.sep);
                $("#node-input-sep").hide();
            } else {
                $("#node-input-select-sep").val("");
                $("#node-input-sep").val(this.sep);
                $("#node-input-sep").show();
            }
            $("#node-input-select-sep").change(function() {
                var v = $("#node-input-select-sep option:selected").val();
                $("#node-input-sep").val(v);
                if (v == "") {
                    $("#node-input-sep").val("");
                    $("#node-input-sep").show().focus();
                } else {
                    $("#node-input-sep").hide();
                }
            });
        }
    });</script><script type="text/x-red" data-help-name="csv"><p>A function that parses the <b>msg.payload</b> to convert csv to/from a javascript object.
    Places the result in the payload.</p>
    <p>If the input is a string it tries to parse it as CSV and creates a javascript object.</p>
    <p>If the input is a javascript object it tries to build a CSV string.</p>
    <p>The columns template should contain an ordered list of column headers. For csv input these become the property names.
    For csv output these specify the properties to extract from the object and the order for the csv.</p>
    <p><b>Note:</b> the columns should always be specified comma separated - even if another separator is chosen for the data.</p></script><script type="text/x-red" data-template-name="html"><div class="form-row">
        <label for="node-input-tag"><i class="fa fa-filter"></i> Select</label>
        <input type="text" id="node-input-tag" placeholder="h1">
    </div>
    <div class="form-row">
        <label for="node-input-ret"><i class="fa fa-sign-out"></i> Output</label>
        <select id="node-input-ret" style="width:73% !important">
            <option value="html">the html content of the elements</option>
            <option value="text">only the text content of the elements</option>
            <!-- <option value="attr">an object of any attributes</option> -->
            <!-- <option value="val">return the value from a form element</option> -->
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-as">&nbsp;</label>
        <select id="node-input-as" style="width:73% !important">
            <option value="single">as a single message containing an array</option>
            <option value="multi">as multiple messages, one for each element</option>
        </select>
    </div>
    <br/>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips">Tip: The <b>Select</b> value is a <a href="http://api.jquery.com/category/selectors/" target="_new"><i><u>jQuery</u></i></a> style selector.</div></script><script type="text/javascript">RED.nodes.registerType('html',{
        category: 'function',
        color:"#DEBD5C",
        defaults: {
            tag: {value:""},
            ret: {value:"html"},
            as: {value:"single"},
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "arrow-in.png",
        label: function() {
            return this.name||this.tag||"html";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-help-name="html"><p>Extracts elements from an html document held in <b>msg.payload</b> using a selector.</p>
    <p>The selector uses the <a href="http://api.jquery.com/category/selectors/" target="_new">jQuery syntax</a>.</p>
    <p>The result is either a single message with a payload containing an array of the matched elements, or multiple
       messages that each contain a matched element.</p></script><script type="text/x-red" data-template-name="json"><div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('json',{
        category: 'function',
        color:"#DEBD5C",
        defaults: {
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "arrow-in.png",
        label: function() {
            return this.name||"json";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-help-name="json"><p>A function that parses the <b>msg.payload</b> to convert a JSON string to/from a javascript object. Places the result back into the payload.</p>
    <p>If the input is a JSON string it tries to parse it to a javascript object.</p>
    <p>If the input is a javascript object it creates a JSON string.</p></script><script type="text/x-red" data-template-name="xml"><div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('xml',{
        category: 'function',
        color:"#DEBD5C",
        defaults: {
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "arrow-in.png",
        label: function() {
            return this.name||"xml";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-help-name="xml"><p>A function that parses the <b>msg.payload</b> to convert xml to/from a javascript object. Places the result in the payload.</p>
    <p>If the input is a string it tries to parse it as XML and creates a javascript object.</p>
    <p>If the input is a javascript object it tries to build an XML string.</p>
    <p>See <a href="https://github.com/Leonidas-from-XIV/node-xml2js/blob/master/README.md" target="_new">the xml2js docs <i>here</i></a> for more information.</p></script><script type="text/x-red" data-template-name="base64"><div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('base64',{
        category: 'function',
        color:"#DEBD5C",
        defaults: {
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "arrow-in.png",
        label: function() {
            return this.name||"base64";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-help-name="base64"><p>A function that converts the <b>msg.payload</b> to and from base64 format.</p>
    <p>If the input is a buffer it converts it to a Base64 encoded string.</p>
    <p>If the input is a Base64 string it converts it back to a binary buffer.</p></script><script type="text/x-red" data-template-name="msgpack"><div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('msgpack',{
        category: 'function',
        color:"#DEBD5C",
        defaults: {
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "arrow-in.png",
        label: function() {
            return this.name||"msgpack";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-help-name="msgpack"><p>A function that converts the <b>msg.payload</b> to and from <a href = "https://github.com/msgpack/msgpack-node"><i>msgpack</i></a> format.</p>
    <p>If the input is NOT a buffer it tries to convert it to a msgpack buffer.</p>
    <p>If the input is a msgpack buffer it tries to decode it back.</p></script><script type="text/x-red" data-template-name="twitter-credentials"><div class="form-row">
        <label for="node-config-input-screen_name"><i class="icon-bookmark"></i> Screen Name</label>
        <input type="text" id="node-config-input-screen_name">
    </div>
    <div class="form-row">
        <label for="node-config-input-consumer_key"> Consumer Key</label>
        <input type="text" id="node-config-input-consumer_key">
    </div>
    <div class="form-row">
        <label for="node-config-input-consumer_secret"> Consumer Secret</label>
        <input type="password" id="node-config-input-consumer_secret">
    </div>
    <div class="form-row">
        <label for="node-config-input-access_token"> Access Token</label>
        <input type="text" id="node-config-input-access_token">
    </div>
    <div class="form-row">
        <label for="node-config-input-access_token_secret"> Token Secret</label>
        <input type="password" id="node-config-input-access_token_secret">
    </div></script><script type="text/javascript">RED.nodes.registerType('twitter-credentials',{
        category: 'config',
        defaults: {
            screen_name: {value:""},
            consumer_key: {value:""},
            consumer_secret: {value:""},
            access_token: {value:""},
            access_token_secret: {value:""}
        },
            
        label: function() {
            return this.screen_name;
        },
        exportable: false,
    });</script><script type="text/x-red" data-template-name="twitter in"><div class="form-row">
        <label for="node-input-twitter"><i class="fa fa-user"></i> Log in as</label>
        <input type="text" id="node-input-twitter">
    </div>
    <div class="form-row">
        <label for="node-input-user"><i class="fa fa-search"></i> Search</label>
        <select type="text" id="node-input-user" style="display: inline-block; vertical-align: middle; width:60%;">
            <option value="false">all public tweets</option>
            <option value="true">the tweets of who you follow</option>
            <option value="user">the tweets of specific users</option>
            <option value="dm">your direct messages</option>
        </select>
    </div>
    <div class="form-row" id="node-input-tags-row">
        <label for="node-input-tags"><i class="fa fa-tags"></i> <span id="node-input-tags-label">for</span></label>
        <input type="text" id="node-input-tags" placeholder="comma-separated words, @ids, #tags">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips">Tip: Use commas without spaces between multiple search terms. Comma = OR, Space = AND.
    <br/>The Twitter API WILL NOT deliver 100% of all tweets.
    <br/>Tweets of who you follow will include their retweets and favourites.</div></script><script type="text/javascript">RED.nodes.registerType('twitter in',{
        category: 'social-input',
        color:"#C0DEED",
        defaults: {
            twitter: {type:"twitter-credentials",required:true},
            tags: {value:"",validate:function(v) { return this.user == "dm" || v.length > 0;}},
            user: {value:"false",required:true},
            name: {value:""},
            topic: {value:"tweets"}
        },
        inputs:0,
        outputs:1,
        icon: "twitter.png",
        label: function() {
            if (this.name) {
                return this.name;
            }
            if (this.user == "dm") {
                var user = RED.nodes.node(this.twitter);
                return (user?user.label()+" ":"")+"DMs";
            } else if (this.user == "user") {
                return this.tags+" tweets";
            }
            return this.tags;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            $("#node-input-user").change(function() {
                var type = $("#node-input-user option:selected").val();
                if (type == "user") {
                    $("#node-input-tags-row").show();
                    $("#node-input-tags-label").html("User");
                    $("#node-input-tags").attr("placeholder","comma-separated @twitter handles");
                } else if (type == "dm") {
                    $("#node-input-tags-row").hide();
                } else {
                    $("#node-input-tags-row").show();
                    $("#node-input-tags-label").html("for");
                    $("#node-input-tags").attr("placeholder","comma-separated words, @ids, #hashtags");
                }                

            });
            $("#node-input-user").change();
        
        }
    });</script><script type="text/x-red" data-template-name="twitter out"><div class="form-row">
        <label for="node-input-twitter"><i class="fa fa-user"></i> Twitter</label>
        <input type="text" id="node-input-twitter">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('twitter out',{
        category: 'social-output',
        color:"#C0DEED",
        defaults: {
            twitter: {type:"twitter-credentials",required:true},
            name: {value:"Tweet"}
        },
        inputs:1,
        outputs:0,
        icon: "twitter.png",
        align: "right",
        label: function() {
            return this.name;
        }
    });</script><script type="text/x-red" data-help-name="twitter in"><p>Twitter input node. Can be used to search either:
    <ul><li>the public or a user's stream for tweets containing the configured search term</li>
        <li>all tweets by specific users</li>
        <li>direct messages received by the authenticated user</li>
    </ul></p>
    <p>Use space for <i>and</i> and comma , for <i>or</i> when searching for multiple terms.</p>
    <p>Sets the <b>msg.topic</b> to <i>tweets/</i> and then appends the senders screen name.</p>
    <p>Sets <b>msg.location</b> to the tweeters location if known.</p>
    <p>Sets <b>msg.tweet</b> to the full tweet object as documented by <a href="https://dev.twitter.com/docs/platform-objects/tweets">Twitter</a>.
    <p><b>Note:</b> when set to a specific user's tweets, or your direct messages, the node is subject to
      Twitter's API rate limiting. If you deploy the flows multiple times within a 15 minute window, you may
      exceed the limit and will see errors from the node. These errors will clear when the current 15 minute window
      passes.</p></script><script type="text/x-red" data-help-name="twitter out"><p>Twitter out node. Tweets the <b>msg.payload</b>.</p>
    <p>If <b>msg.media</b> exists and is a Buffer object, this node will treat it
       as an image and attach it to the tweet.</p></script><script type="text/x-red" data-template-name="feedparse"><div class="form-row">
        <label for="node-input-url"><i class="fa fa-globe"></i> Feed url</label>
        <input type="text" id="node-input-url">
    </div>
    <div class="form-row">
        <label for="node-input-interval"><i class="fa fa-repeat"></i> Repeat <span style="font-size: 0.9em;">(M)</span></label>
        <input type="text" id="node-input-interval" placeholder="minutes">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <!-- <div class="form-tips"></div> --></script><script type="text/javascript">RED.nodes.registerType('feedparse',{
        category: 'advanced-input',
        color:"#C0DEED",
        defaults: {
            name: {value:""},
            url: {value:"", required:true},
            interval: { value:15, required: true,validate:RED.validators.number()}
        },
        inputs:0,
        outputs:1,
        icon: "feed.png",
        label: function() {
            return this.name||this.url;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-help-name="feedparse"><p>Monitors an RSS/atom feed for new entries.</p></script><script type="text/x-red" data-template-name="twilio sms"><div class="form-row" id="node-input-credentials-row">
        <label for="node-input-creds"><i class="fa fa-folder-o"></i> Credentials</label>
        <select id="node-input-creds">
            <option value="global">Use global credentials</option>
            <option value="local">Use local credentials</option>
        </select>
    </div>
    <div class="form-row" id="node-input-twilio-row">
        <label for="node-input-twilio"><i class="fa fa-user"></i> Twilio</label>
        <input type="text" id="node-input-twilio">
    </div>
    <div class="form-row">
        <label for="node-input-number"><i class="fa fa-envelope-o"></i> SMS to</label>
        <input type="text" id="node-input-number" placeholder="01234 5678901">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="twilio call out"><div class="form-row" id="node-input-credentials-row">
        <label for="node-input-creds"><i class="fa fa-folder-o"></i> Credentials</label>
        <select id="node-input-creds">
            <option value="global">Use global credentials</option>
            <option value="local">Use local credentials</option>
        </select>
    </div>
    <div class="form-row" id="node-input-twilio-row">
        <label for="node-input-twilio"><i class="fa fa-user"></i> Twilio</label>
        <input type="text" id="node-input-twilio">
    </div>
    <div class="form-row">
        <label for="node-input-number"><i class="fa fa-envelope-o"></i> Call to</label>
        <input type="text" id="node-input-number" placeholder="01234 5678901">
    </div>
    <div class="form-row" id="node-input-twilio-row">
        <label for="node-input-language"><i class="fa fa-folder-o"></i> Language</label>
        <select id="node-input-language">
            <option value="en-US">English</option>
            <option value="fr-FR">French</option>
            <option value="de-DE">German</option>
            <option value="nl-NL">Dutch</option>
            <option value="ro-RO">Romanian</option>
            <option value="hu-HU">Hungarian</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="twilio-api"><div class="form-row">
        <label for="node-config-input-sid">Account SID</label>
        <input type="text" id="node-config-input-sid">
    </div>
    <div class="form-row">
        <label for="node-config-input-from"><i class="fa fa-envelope"></i> From</label>
        <input type="text" id="node-config-input-from" placeholder="01234 5678901">
    </div>
    <div class="form-row">
        <label for="node-config-input-token"><i class="fa fa-lock"></i> Token</label>
        <input type="password" id="node-config-input-token">
    </div>
    <div class="form-row">
        <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-config-input-name" placeholder="Name">
    </div></script><script type="text/javascript">(function() {
        var hasGlobal = false;
        RED.nodes.registerType('twilio-api',{
            category: 'config',
            defaults: {
                sid: {value:"",required:true},
                from: {value:"",required:true},
                token: {value:"",required:true},
                name: { value: ""}
            },
            label: function() {
                return this.name||this.from;
            },
            oneditprepare: function() {
                
            },
            oneditsave: function() {
                
            },
            ondelete: function() {
               
            }
        });
        RED.nodes.registerType('twilio sms',{
            category: 'output',
            defaults: {
                twilio:{type:"twilio-api",validate:function(v) {
                    return hasGlobal || (v && v!="_ADD_");
                }},
                number: {value:""},
                name: {value:""}
            },
            color:"#FF595F",
            inputs:1,
            outputs:0,
            icon: "twilio.png",
            align: "right",
            label: function() {
                return this.name||this.title||"SMS "+this.number;
            },
            labelStyle: function() {
                return this.name?"node_label_italic":"";
            },
            oneditprepare: function() {
                if (hasGlobal) {
                    $("#node-input-creds").change(function() {
                        var val = $(this).val();
                        if (val == "global") {
                            $("#node-input-twilio-row").hide();
                        } else {
                            $("#node-input-twilio-row").show();
                        }
                    });
                    $("#node-input-credentials-row").show();
                    if (!this.twilio) {
                        $("#node-input-creds").val("global");
                    } else {
                        $("#node-input-creds").val("local");
                    }
                    $("#node-input-creds").change();
                } else {
                    $("#node-input-credentials-row").hide();
                }
            }
        });
        RED.nodes.registerType('twilio call out',{
            category: 'output',
            defaults: {
                twilio:{type:"twilio-api",validate:function(v) {
                    return hasGlobal || (v && v!="_ADD_");
                }},
                number: {value:""},
                name: {value:""}
            },
            color:"#FF595F",
            inputs:1,
            outputs:0,
            icon: "twilio.png",
            align: "right",
            label: function() {
                return this.name||this.title||"Call "+this.number;
            },
            labelStyle: function() {
                return this.name?"node_label_italic":"";
            },
            oneditprepare: function() {
                if (hasGlobal) {
                    $("#node-input-creds").change(function() {
                        var val = $(this).val();
                        if (val == "global") {
                            $("#node-input-twilio-row").hide();
                        } else {
                            $("#node-input-twilio-row").show();
                        }
                    });
                    $("#node-input-credentials-row").show();
                    if (!this.twilio) {
                        $("#node-input-creds").val("global");
                    } else {
                        $("#node-input-creds").val("local");
                    }
                    $("#node-input-creds").change();
                } else {
                    $("#node-input-credentials-row").hide();
                }
            }
        });
    })();</script><script type="text/x-red" data-help-name="twilio sms"><p>Sends an SMS message using the Twilio service.</p>
    <p><code>msg.payload</code> is used as the body of the message. The node can be configured with the number
    to send the message to. Alternatively, if the number is left blank, it can be set using <code>msg.topic</code>.</p>
    <p>You must have an account with Twilio to use this node. You can register for one <a href="https://www.twilio.com/">here</a>.</p></script><script type="text/x-red" data-help-name="twilio call out"><p>Sends a call message using the Twilio service.</p>
    <p><code>msg.payload</code> is used as the body of the message. The node can be configured with the number
    to send the message to. Alternatively, if the number is left blank, it can be set using <code>msg.topic</code>.</p>
    <p>You must have an account with Twilio to use this node. You can register for one <a href="https://www.twilio.com/">here</a>.</p></script><script type="text/x-red" data-template-name="e-mail"><div class="form-row">
        <label for="node-input-name"><i class="fa fa-envelope"></i> To</label>
        <input type="text" id="node-input-name" placeholder="email@address.com">
    </div>
    <!-- <div class="form-row">
        <label for="node-input-pin"><i class="fa fa-asterisk"></i> Service</label>
        <select type="text" id="node-input-pin" style="width: 150px;">
            <option value="-" disabled> </option>
            <option value="DynectEmail">DynectEmail</option>
            <option value="Gmail">Gmail</option>
            <option value="hot.ee">hot.ee</option>
            <option value="Hotmail">Hotmail</option>
            <option value="iCloud">iCloud</option>
            <option value="mail.ee">mail.ee</option>
            <option value="Mail.Ru">Mail.Ru</option>
            <option value="Mailgun">Mailgun</option>
            <option value="Mailjet">Mailjet</option>
            <option value="Mandrill">Mandrill</option>
            <option value="Postmark">Postmark</option>
            <option value="QQ">QQ</option>
            <option value="QQex">QQex</option>
            <option value="SendGrid">SendGrid</option>
            <option value="SendCloud">SendCloud</option>
            <option value="SES">SES</option>
            <option value="Yahoo">Yahoo</option>
            <option value="yandex">yandex</option>
            <option value="Zoho">Zoho</option>
         </select>
    </div> -->
    <div class="form-row">
        <label for="node-input-server"><i class="fa fa-globe"></i> Server</label>
        <input type="text" id="node-input-server" placeholder="smtp.gmail.com">
    </div>
    <div class="form-row">
        <label for="node-input-port"><i class="fa fa-random"></i> Port</label>
        <input type="text" id="node-input-port" placeholder="465">
    </div>
    <div class="form-row">
        <label for="node-input-userid"><i class="fa fa-user"></i> Userid</label>
        <input type="text" id="node-input-userid">
    </div>
    <div class="form-row">
        <label for="node-input-password"><i class="fa fa-lock"></i> Password</label>
        <input type="password" id="node-input-password">
    </div>
    <br/>
    <div class="form-row">
        <label for="node-input-dname"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-dname" placeholder="Name">
    </div></script><script type="text/javascript">(function() {
    RED.nodes.registerType('e-mail',{
        category: 'social-output',
        color:"#c7e9c0",
        defaults: {
            server: {value:"smtp.gmail.com",required:true},
            port: {value:"465",required:true},
            name: {value:"",required:true},
            dname: {value:""},
            userid: {value:""},
            password: {value: ""}
        },
        inputs:1,
        outputs:0,
        icon: "envelope.png",
        align: "right",
        label: function() {
            return this.dname||this.name||"email";
        },
        labelStyle: function() {
            return (this.dname||!this.topic)?"node_label_italic":"";
        },
        oneditprepare: function() {



        }
    });
})();</script><script type="text/x-red" data-template-name="e-mail in"><div class="form-row node-input-repeat">
        <label for="node-input-repeat"><i class="fa fa-repeat"></i> Check Repeat (S)</label>
        <input type="text" id="node-input-repeat" placeholder="300">
    </div>
    <div class="form-row">
        <label for="node-input-server"><i class="fa fa-globe"></i> Server</label>
        <input type="text" id="node-input-server" placeholder="imap.gmail.com">
    </div>
    <div class="form-row">
        <label for="node-input-port"><i class="fa fa-random"></i> Port</label>
        <input type="text" id="node-input-port" placeholder="993">
    </div>
    <div class="form-row">
        <label for="node-input-userid"><i class="fa fa-user"></i> Userid</label>
        <input type="text" id="node-input-userid">
    </div>
    <div class="form-row">
        <label for="node-config-input-password"><i class="fa fa-lock"></i> Password</label>
        <input type="password" id="node-input-password">
    </div>
    <br/>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div id="node-input-tip" class="form-tips">Tip: <b>ONLY</b> retrieves the single most recent email.</div></script><script type="text/javascript">(function() {
    RED.nodes.registerType('e-mail in',{
        category: 'social-input',
        color:"#c7e9c0",
        defaults: {
            repeat: {value:"300",required:true},
            server: {value:"imap.gmail.com",required:true},
            port: {value:"993",required:true},
            name: {value:""},
            userid: {value:""},
            password: {value: ""}
        },
        inputs:0,
        outputs:1,
        icon: "envelope.png",
        label: function() {
            return this.name||"email";
        },
        labelStyle: function() {
            return (this.name||!this.topic)?"node_label_italic":"";
        },
        oneditprepare: function() {
            





        }
    });
})();</script><script type="text/x-red" data-help-name="e-mail"><p>Sends the <b>msg.payload</b> as an email, with a subject of <b>msg.topic</b>.</p>
    <!-- <p>It sends the message to the configured recipient <i>only</i>.</p> -->
    <p>You may dynamically overide the default recipient by setting a <b>msg.to</b> property.</p>
    <!-- <p><b>msg.topic</b> is used to set the subject of the email, and <b>msg.payload</b> is the body text.</p> --></script><script type="text/x-red" data-help-name="e-mail in"><p>Repeatedly gets a <b>single email</b> from an IMAP server and forwards on as a msg if not already seen.</p>
    <p>The subject is loaded into <b>msg.topic</b> and <b>msg.payload</b> is the plain text body.
       If there is text/html then that is returned in <b>msg.html</b>. <b>msg.from</b> and <b>msg.date</b> are also set if you need them.</p>
    <p>Uses the imap module.</p>
    <p><b>Note:</b> this node <i>only</i> gets the most recent single email from the inbox, so set the repeat (polling) time appropriately.</p></script><script type="text/x-red" data-template-name="irc in"><div class="form-row">
        <label for="node-input-ircserver"><i class="fa fa-globe"></i> IRC Server</label>
        <input type="text" id="node-input-ircserver">
    </div>
    <div class="form-row">
        <label for="node-input-channel"><i class="fa fa-random"></i> Channel</label>
        <input type="text" id="node-input-channel" placeholder="#nodered">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips">The channel to join must start with a # (as per normal irc rules...)<br/>
    You may join multiple channels by comma separating a list - #chan1,#chan2,etc.</div></script><script type="text/javascript">RED.nodes.registerType('irc in',{
        category: 'social-input',
        defaults: {
            name: {value:""},
            ircserver: {type:"irc-server", required:true},
            channel: {value:"",required:true,validate:RED.validators.regex(/^#/)}
        },
        color:"Silver",
        inputs:0,
        outputs:2,
        icon: "hash.png",
        label: function() {
            var ircNode = RED.nodes.node(this.ircserver);
            return this.name || (ircNode ? ircNode.label() : "irc");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            if ((this.ircserver !== undefined) && (this.ircserver !== "")) {
                this.channel = this.channel || RED.nodes.node(this.ircserver).channel;
                $("#node-input-channel").val(this.channel);
            }
            else { this.channel = this.channel; }
            $("#node-input-channel").val(this.channel);
        }
    });</script><script type="text/x-red" data-template-name="irc out"><div class="form-row">
        <label for="node-input-ircserver"><i class="fa fa-globe"></i> IRC Server</label>
        <input type="text" id="node-input-ircserver">
    </div>
    <div class="form-row">
        <label for="node-input-channel"><i class="fa fa-random"></i> Channel</label>
        <input type="text" id="node-input-channel" placeholder="#nodered">
    </div>
    <div class="form-row">
        <label for="node-input-sendObject"><i class="fa fa-arrows"></i> Action</label>
        <select type="text" id="node-input-sendObject" style="display: inline-block; vertical-align: middle; width:70%;">
            <option value="pay">Send payload to channel(s)</option>
            <option value="true">Use msg.topic to set nickname or channel(s)</option>
            <option value="false">Send complete msg object to channel(s)</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips">The channel to join must start with a # (as per normal irc rules...)<br/>
    Sending the complete object will stringify the whole msg object before sending.</div></script><script type="text/javascript">RED.nodes.registerType('irc out',{
        category: 'social-output',
        defaults: {
            name: {value:""},
            sendObject: {value:"pay", required:true},
            ircserver: {type:"irc-server", required:true},
            channel: {value:"",required:true,validate:RED.validators.regex(/^#/)}
        },
        color:"Silver",
        inputs:1,
        outputs:0,
        icon: "hash.png",
        align: "right",
        label: function() {
            return this.name || (this.ircserver ? RED.nodes.node(this.ircserver).label() : "irc");
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
            if ((this.ircserver !== undefined) && (this.ircserver !== "")) {
                this.channel = this.channel || RED.nodes.node(this.ircserver).channel;
                $("#node-input-channel").val(this.channel);
            }
            else { this.channel = this.channel; }
        }
    });</script><script type="text/x-red" data-template-name="irc-server"><div class="form-row">
        <label for="node-config-input-server"><i class="fa fa-globe"></i> IRC Server</label>
        <input type="text" id="node-config-input-server" placeholder="irc.freenode.net">
    </div>
    <div class="form-row">
        <label for="node-config-input-nickname"><i class="fa fa-user"></i> Nickname</label>
        <input type="text" id="node-config-input-nickname" placeholder="joe123">
    </div></script><script type="text/javascript">RED.nodes.registerType('irc-server',{
        category: 'config',
        defaults: {
            server: {value:"",required:true},
            nickname: {value:"",required:true}
        },
        label: function() {
            return this.server;
        }
    });</script><script type="text/x-red" data-help-name="irc in"><p>Connects to a channel on an IRC server.</p>
    <p>You may join multiple channels by comma separating a list - #chan1,#chan2,#etc.</p>
    <p>Any messages on that channel will appear on the <code>msg.payload</code> at the output,
    while <code>msg.topic</code> will contain who it is from.
    <code>msg.to</code> contains either the name of the channel or PRIV in the case of a pm.</p>
    <p>The second output provides a <code>msg.payload</code> that has any status messages such as joins, parts, kicks etc.</p>
    <p>The type of the status message is set as <code>msg.payload.type</code>.</p>
    <p>The possible status types are: <br />
    <table border="1" cellpadding="1" cellspacing="1">
    <thead>
        <tr>
            <th scope="col">Type</th>
            <th scope="col">Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>message</td>
            <td>message is sent into the channel</td>
        </tr>
        <tr>
            <td>pm</td>
            <td>private message to the bot</td>
        </tr>
        <tr>
            <td>join</td>
            <td>a user joined the channel (also triggered when the bot joins a channel)</td>
        </tr>
        <tr>
            <td>invite</td>
            <td>the bot is being invited to a channel</td>
        </tr>
        <tr>
            <td>part</td>
            <td>a user leaves a channel</td>
        </tr>
        <tr>
            <td>quit</td>
            <td>a user quits a channel</td>
        </tr>
        <tr>
            <td>kick</td>
            <td>a user is kicked from a channel</td>
        </tr>
        <tr>
            <td>names</td>
            <td>retrieves the list of users when the bot joins a channel</td>
        </tr>
    </tbody>
</table>
</p></script><script type="text/x-red" data-help-name="irc out"><p>Sends messages to a channel on an IRC server</p>
    <p>You can send just the <code>msg.payload</code>, or the complete <code>msg</code> object to the selected channel,
    or you can select to use <code>msg.topic</code> to send the <code>msg.payload</code> to a specific user (private message) or channel.</p>
    <p>If multiple output channels are listed (eg. #chan1,#chan2), then the message will be sent to all of them.</p>
    <p><b>Note:</b> you can only send to channels you have previously joined so they MUST be specified in the node - even if you then decide to use a subset in msg.topic</p>
    <p>You may send RAW commands using <code>msg.raw</code> - This must contain an array of parameters - eg. <pre>["privmsg","#nodered","Hello world"]</pre></p></script><script type="text/x-red" data-template-name="tail"><div class="form-row node-input-filename">
         <label for="node-input-filename"><i class="fa fa-file"></i> Filename</label>
         <input type="text" id="node-input-filename" placeholder="Filename">
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-split" placeholder="Name" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-split" style="width: 70%;">Split lines if we see \n ?</label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <!-- <div class="form-tips">WON'T work on Windows.</div> --></script><script type="text/javascript">RED.nodes.registerType('tail',{
        category: 'storage-input',
        defaults: {
            name: {value:""},
            split: {value:false},
            filename: {value:"",required:true}
        },
        color:"BurlyWood",
        inputs:0,
        outputs:1,
        icon: "file.png",
        label: function() {
            return this.name||this.filename;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-help-name="tail"><p>Tails (watches for things to be added) to the configured file. (Linux/Mac ONLY)</p>
    <p>This won't work on Windows filesystems, as it relies on the tail -F command.</p></script><script type="text/x-red" data-template-name="file"><div class="form-row node-input-filename">
         <label for="node-input-filename"><i class="fa fa-file"></i> Filename</label>
         <input type="text" id="node-input-filename" placeholder="Filename">
    </div>
    <div class="form-row">
        <label for="node-input-overwriteFile"><i class="fa fa-random"></i> Action</label>
        <select type="text" id="node-input-overwriteFile" style="display: inline-block; width: 250px; vertical-align: top;">
            <option value="false">append to file</option>
            <option value="true">overwrite file</option>
            <option value="delete">delete file</option>
        </select>
    </div>
    <div class="form-row" id="node-appline">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-appendNewline" placeholder="Name" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-appendNewline" style="width: 70%;">Add newline (\n) to each payload ?</label>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/x-red" data-template-name="file in"><div class="form-row">
         <label for="node-input-filename"><i class="fa fa-file"></i> Filename</label>
         <input type="text" id="node-input-filename" placeholder="Filename">
    </div>
    <div class="form-row">
        <label for="node-input-format"><i class="fa fa-sign-out"></i> Output as</label>
        <select id="node-input-format">
            <option value="utf8">a utf8 string</option>
            <option value="">a Buffer</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('file',{
        category: 'storage-output',
        defaults: {
            name: {value:""},
            filename: {value:""},
            appendNewline: {value:true},
            overwriteFile: {value:"false"}
        },
        color:"BurlyWood",
        inputs:1,
        outputs:0,
        icon: "file.png",
        align: "right",
        label: function() {
            if (this.overwriteFile === "delete") { return this.name||"delete "+this.filename; }
            else { return this.name||this.filename; }
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function() {
          $("#node-input-overwriteFile").on("change",function() {
            if (this.value === "delete") { $("#node-appline").hide(); }
            else { $("#node-appline").show(); }
          });
        }
    });

    RED.nodes.registerType('file in',{
        category: 'storage-input',
        defaults: {
            name: {value:""},
            filename: {value:""},
            format: {value:"utf8"},
        },
        color:"BurlyWood",
        inputs:1,
        outputs:1,
        icon: "file.png",
        label: function() {
            return this.name||this.filename;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-help-name="file"><p>Writes <b>msg.payload</b> to the file specified, e.g. to create a log.</p>
    <p>The filename can be configured in the node, if left blank it should be set in an incoming message on <b>msg.filename</b>.</p>
    <p>A newline is added to every message. But this can be turned off if required, for example, to allow binary files to be written.</p>
    <p>The default behaviour is to append to the file. This can be changed to overwrite the file each time, for example if you want to output a "static" web page or report.</p>
    <p>This node can also be configured to delete a file if required. <i>Note:</i> Using msg.delete is now deprecated.</p></script><script type="text/x-red" data-help-name="file in"><p>Reads the specified file and sends the content as <b>msg.payload</b>, and the filename as <b>msg.filename</b>.</p>
    <p>The filename can be configured in the node, if left blank it should be set in an incoming message on <b>msg.filename</b>.</p></script><script type="text/x-red" data-template-name="redis out"><div class="form-row node-input-hostname">
        <label for="node-input-hostname"><i class="fa fa-bookmark"></i> Host</label>
        <input class="input-append-left" type="text" id="node-input-hostname" placeholder="127.0.0.1" style="width: 40%;" ><button id="node-input-hostname-lookup" class="btn input-append-right"><span class="caret"></span></button>
        <label for="node-input-port" style="margin-left: 10px; width: 35px; "> Port</label>
        <input type="text" id="node-input-port" placeholder="6379" style="width:45px">
    </div>
    <div class="form-row">
        <label for="node-input-key"><i class="fa fa-key"></i> Key</label>
        <input type="text" id="node-input-key" placeholder="Redis Key">
    </div>
    <div class="form-row">
        <label for="node-input-type"><i class="fa fa-th"></i> Type</label>
        <select type="text" id="node-input-structtype" style="width: 150px;">
        <option value="string">String</option>
        <option value="hash">Hash</option>
        <option value="set">Set</option>
        <option value="list">List</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-tips">
        If key is blank, the topic will be used as the key.<br>
        If type is hash, payload should be an object or field=value string.
    </div></script><script type="text/javascript">RED.nodes.registerType('redis out',{
        category: 'storage-output',
        color:"#ffaaaa",
        defaults: {
            hostname: { value:"127.0.0.1",required:true},
            port: { value: 6379,required:true},
            name: {value:""},
            key: {value:""},
            structtype: {value:"",required:true}
        },
        inputs:1,
        outputs:0,
        icon: "redis.png",
        align: "right",
        label: function() {
            return this.name||this.key+" ("+this.structtype+")";
        },
        oneditprepare: function() {
            var availableServers = [];
            var matchedServers = {};
            RED.nodes.eachNode(function(node) {
                if (node.type == "redis out" && node.hostname && node.port && !matchedServers[node.hostname+":"+node.port]) {
                    var label = node.hostname+":"+node.port;
                    matchedServers[label] = true;
                    availableServers.push({
                        label:label,
                        value:node.hostname,
                        port:node.port
                    });
                }
            });
            $( "#node-input-hostname" ).autocomplete({
                minLength: 0,
                source: availableServers,
                select: function( event, ui ) {
                    $("#node-input-port").val(ui.item.port);
                }
            });
            var tt = this;
            tt._acOpen = false;
            $( "#node-input-hostname" ).on( "autocompleteclose", function( event, ui ) { tt._acOpen = false;} );
            $( "#node-input-hostname-lookup" ).click(function(e) {
                if (tt._acOpen) {
                    $( "#node-input-hostname" ).autocomplete( "close");
                } else {
                    $( "#node-input-hostname" ).autocomplete( "search", "" );
                }
                tt._acOpen = !tt._acOpen;
                e.preventDefault();
            });
        }
    });</script><script type="text/x-red" data-help-name="redis out"><p>A Redis output node. Options include Hash, Set, List and String.</p>
    <p>To run this you need a local Redis server running. For details see <a href="http://redis.io/" target="_new">the Redis site</a>.</p></script><script type="text/x-red" data-template-name="MySQLdatabase"><div class="form-row">
        <label for="node-config-input-host"><i class="fa fa-globe"></i> Host</label>
        <input type="text" id="node-config-input-host">
    </div>
    <div class="form-row">
        <label for="node-config-input-port"><i class="fa fa-random"></i> Port</label>
        <input type="text" id="node-config-input-port">
    </div>
        <div class="form-row">
        <label for="node-config-input-user"><i class="fa fa-user"></i> User</label>
        <input type="text" id="node-config-input-user">
    </div>
        <div class="form-row">
        <label for="node-config-input-pass"><i class="fa fa-lock"></i> Password</label>
        <input type="password" id="node-config-input-password">
    </div>
    <div class="form-row">
        <label for="node-config-input-db"><i class="fa fa-database"></i> Database</label>
        <input type="text" id="node-config-input-db">
    </div>
    <div class="form-row">
        <label for="node-config-input-tz"><i class="fa fa-clock-o"></i> Timezone</label>
        <input type="text" id="node-config-input-tz">
    </div></script><script type="text/javascript">RED.nodes.registerType('MySQLdatabase',{
        category: 'config',
        defaults: {
            host: {value:"127.0.0.1",required:true},
            port: {value:"3306",required:true},
            user: {value:"",required:true},
            pass: {value:"",required:true},
            db: {value:"",required:true},
            tz: {value:""}
        },
        label: function() {
            return this.db;
        }
    });</script><script type="text/x-red" data-template-name="mysql"><div class="form-row">
        <label for="node-input-mydb"><i class="fa fa-database"></i> Database</label>
        <input type="text" id="node-input-mydb">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('mysql',{
        category: 'storage-input',
        color:"#e97b00",
        defaults: {
            mydb: {type:"MySQLdatabase",required:true},
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "db.png",
        label: function() {
            var levelNode = RED.nodes.node(this.mydb);
            return this.name||(levelNode?levelNode.label():"mysql");
        },
            labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-help-name="mysql"><p>Allows basic access to a MySQL database.</p>
    <p>This node uses the <b>query</b> operation against the configured database. This does allow both INSERTS and DELETES.
    By it's very nature it allows SQL injection... so <i>be careful out there...</i></p>
    <p><b>msg.topic</b> must hold the <i>query</i> for the database, and the result is returned in <b>msg.payload</b>.</p>
    <p><b>msg.payload</b> can contain an array of values to bind to the topic.</p>
    <p>Typically the returned payload will be an array of the result rows.</p>
    <p>If nothing is found for the key then <i>null</i> is returned,</p>
    <p>The reconnect timeout in milliseconds can be changed by adding a line to <b>settings.js</b>
    <pre>mysqlReconnectTime: 30000,</pre></p></script><script type="text/x-red" data-template-name="sqlitedb"><div class="form-row">
        <label for="node-config-input-db"><i class="fa fa-database"></i> Database</label>
        <input type="text" id="node-config-input-db" placeholder="/tmp/sqlite">
    </div></script><script type="text/javascript">RED.nodes.registerType('sqlitedb',{
        category: 'config',
        defaults: {
            db: {value:"",required:true}
        },
        label: function() {
            return this.db;
        }
    });</script><script type="text/x-red" data-template-name="sqlite"><div class="form-row">
        <label for="node-input-mydb"><i class="fa fa-database"></i> Database</label>
        <input type="text" id="node-input-mydb">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('sqlite',{
        category: 'storage-input',
        color:"#e97b00",
        defaults: {
            mydb: {type:"sqlitedb",required:true},
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "sqlite.png",
        label: function() {
            var dbNode = RED.nodes.node(this.mydb);
            return this.name||(dbNode?dbNode.label():"sqlite");
        },
            labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-help-name="sqlite"><p>Allows basic access to a Sqlite database.</p>
    <p>This node uses the <b>db.all</b> operation against the configured database. This does allow INSERTS, UPDATES and DELETES.
    By it's very nature it is SQL injection... so <i>be careful out there...</i></p>
    <p><b>msg.topic</b> must hold the <i>query</i> for the database, and the result is returned in <b>msg.payload</b>.</p>
    <p><b>msg.payload</b> can contain an array of values to bind to the topic.</p>
    <p>Typically the returned payload will be an array of the result rows, (or an error).</p>
    <p>The reconnect timeout in milliseconds can be changed by adding a line to <b>settings.js</b>
    <pre>sqliteReconnectTime: 20000,</pre></p></script><script type="text/x-red" data-template-name="daemon"><div class="form-row">
        <label for="node-input-command"><i class="fa fa-file"></i> Command</label>
        <input type="text" id="node-input-command" placeholder="command">
    </div>
    <div class="form-row">
        <label for="node-input-args"><i class="fa fa-list"></i> Args</label>
        <input type="text" id="node-input-args" placeholder="space separated arguments">
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-cr" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-cr" style="width: 70%;">Add [enter] to every message ?</label>
    </div>
        <div class="form-row">
        <label>&nbsp;</label>
        <input type="checkbox" id="node-input-redo" style="display: inline-block; width: auto; vertical-align: top;">
        <label for="node-input-redo" style="width: 70%;">Relaunch command on exit or error ?</label>
    </div>
    <div class="form-row">
        <label for="node-input-op"> and</label>
        <select id="node-input-op" style='width:70%'>
          <option value="string">format reply as a string</option>
          <option value="buffer">leave reply as a buffer</option>
          <option value="number">try to convert reply to a number</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div></script><script type="text/javascript">RED.nodes.registerType('daemon',{
        category: 'advanced-function',
        color:"darksalmon",
        defaults: {
            command: {value:"",required:true},
            args: {value:""},
            cr: {value:false},
            redo: {value:true},
            op: {value:"string"},
            name: {value:""}
        },
        inputs:1,
        outputs:3,
        icon: "arrow-in.png",
        align: "right",
        label: function() {
            return this.name||this.command;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });</script><script type="text/x-red" data-help-name="daemon"><p>Calls out to a long running system command. Sends <b>msg.payload</b> to stdin of the process.</p>
    <p>Provides 3 outputs... stdout, stderr, and return code , from the running command.</p>
    <p>If the called program stops (i.e. a return code is produced), this node can attempt to restart the command.</p>
    <p><b>Note :</b> when you stop Node-RED running we may not get a chance to kill the called program so it may remain running. You <i>may</i> have to kill it manually.</p></script>