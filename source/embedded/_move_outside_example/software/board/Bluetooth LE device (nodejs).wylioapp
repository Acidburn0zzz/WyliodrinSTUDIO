{"main":"\nvar bleno = require('bleno');\n\nvar BlenoPrimaryService = bleno.PrimaryService;\n\nvar util = require('util');\n\nvar BlenoCharacteristic = bleno.Characteristic;\n\nvar EchoCharacteristic = function() {\n  EchoCharacteristic.super_.call(this, {\n    uuid: 'ec0e',\n    properties: ['read', 'write', 'notify'],\n    value: null\n  });\n\n  this._value = new Buffer(0);\n  this._updateValueCallback = null;\n};\n\nutil.inherits(EchoCharacteristic, BlenoCharacteristic);\n\nEchoCharacteristic.prototype.onReadRequest = function(offset, callback) {\n  console.log('EchoCharacteristic - onReadRequest: value = ' + this._value.toString('hex'));\n\n  callback(this.RESULT_SUCCESS, this._value);\n};\n\nEchoCharacteristic.prototype.onWriteRequest = function(data, offset, withoutResponse, callback) {\n  this._value = data;\n\n  console.log('EchoCharacteristic - onWriteRequest: value = ' + this._value.toString('hex'));\n\n  if (this._updateValueCallback) {\n    console.log('EchoCharacteristic - onWriteRequest: notifying');\n\n    this._updateValueCallback(this._value);\n  }\n\n  callback(this.RESULT_SUCCESS);\n};\n\nEchoCharacteristic.prototype.onSubscribe = function(maxValueSize, updateValueCallback) {\n  console.log('EchoCharacteristic - onSubscribe');\n\n  this._updateValueCallback = updateValueCallback;\n};\n\nEchoCharacteristic.prototype.onUnsubscribe = function() {\n  console.log('EchoCharacteristic - onUnsubscribe');\n\n  this._updateValueCallback = null;\n};\n\nconsole.log('bleno - echo');\n\nbleno.on('stateChange', function(state) {\n  console.log('on -> stateChange: ' + state);\n\n  if (state === 'poweredOn') {\n    bleno.startAdvertising('echo', ['ec00']);\n  } else {\n    bleno.stopAdvertising();\n  }\n});\n\nbleno.on('advertisingStart', function(error) {\n  console.log('on -> advertisingStart: ' + (error ? 'error ' + error : 'success'));\n\n  if (!error) {\n    bleno.setServices([\n      new BlenoPrimaryService({\n        uuid: 'ec00',\n        characteristics: [\n          new EchoCharacteristic()\n        ]\n      })\n    ]);\n  }\n});","language":"nodejs","title":"Bluetooth LE device","date":1457011257695}